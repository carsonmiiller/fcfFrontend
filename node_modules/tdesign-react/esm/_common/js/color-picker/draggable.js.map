{"version":3,"file":"draggable.js","sources":["../../../../src/_common/js/color-picker/draggable.ts"],"sourcesContent":["/* eslint-disable no-use-before-define */\nexport interface Coordinate {\n  x: number;\n  y: number;\n}\n\nexport type DraggableEvent = MouseEvent;\n\ninterface DraggableCallback {\n  (coordinate: Coordinate, event?: DraggableEvent): void;\n}\n\nexport interface DraggableProps {\n  start?: DraggableCallback;\n  drag?: DraggableCallback;\n  end?: DraggableCallback;\n}\n\ninterface DraggableHandles {\n  start: (this: Draggable, event: DraggableEvent) => {};\n  drag: (this: Draggable, event: DraggableEvent) => {};\n  end: (this: Draggable, event: DraggableEvent) => {};\n}\n\n// 配置项\nconst defaultsOptions: DraggableProps = {\n  start: (coordinate: Coordinate, event: DraggableEvent) => {},\n  drag: (coordinate: Coordinate, event: DraggableEvent) => {},\n  end: (coordinate: Coordinate, event: DraggableEvent) => {},\n};\n\nexport class Draggable {\n  private dragging = false;\n\n  private $el: HTMLElement;\n\n  private props: DraggableProps;\n\n  private handles: DraggableHandles;\n\n  constructor(el: HTMLElement, options?: DraggableProps) {\n    this.$el = el;\n    this.props = { ...defaultsOptions, ...options };\n    this.handles = {\n      start: this.#dragStart.bind(this),\n      drag: this.#drag.bind(this),\n      end: this.#dragEnd.bind(this),\n    };\n    this.$el.addEventListener('mousedown', this.handles.start, false);\n  }\n\n  #dragStart(event: DraggableEvent) {\n    if (this.dragging) {\n      return;\n    }\n    // event.preventDefault();\n    window.addEventListener('mousemove', this.handles.drag, false);\n    window.addEventListener('mouseup', this.handles.end, false);\n    window.addEventListener('contextmenu', this.handles.end, false);\n    this.dragging = true;\n    this.props.start(this.#getCoordinate(event), event);\n  }\n\n  #drag(event: DraggableEvent) {\n    if (!this.dragging) {\n      return;\n    }\n    this.props.drag(this.#getCoordinate(event), event);\n  }\n\n  #dragEnd(event: DraggableEvent) {\n    setTimeout(() => {\n      this.dragging = false;\n      this.props.end(this.#getCoordinate(event), event);\n    }, 0);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n\n  #getCoordinate(event: DraggableEvent) {\n    const rect = this.$el.getBoundingClientRect();\n    const mouseEvent = event;\n    const left = mouseEvent.clientX - rect.left;\n    const top = mouseEvent.clientY - rect.top;\n    return {\n      y: Math.min(Math.max(0, top), rect.height),\n      x: Math.min(Math.max(0, left), rect.width),\n    };\n  }\n\n  destroy() {\n    this.$el.removeEventListener('mousedown', this.handles.start, false);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n}\n\nexport default Draggable;\n"],"names":["defaultsOptions","start","coordinate","event","drag","end","Draggable","el","options","$el","props","handles","bind","addEventListener","removeEventListener","window","dragging","setTimeout","rect","getBoundingClientRect","mouseEvent","left","clientX","top","clientY","y","Math","min","max","height","x","width"],"mappings":"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"}
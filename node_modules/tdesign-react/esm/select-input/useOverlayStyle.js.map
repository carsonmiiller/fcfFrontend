{"version":3,"file":"useOverlayStyle.js","sources":["../../src/select-input/useOverlayStyle.ts"],"sourcesContent":["import React, { useMemo, useState } from 'react';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\n\nexport type overlayStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n\nexport default function useOverlayStyle(props: overlayStyleProps) {\n  const { popupProps, autoWidth, readonly, onPopupVisibleChange } = props;\n  const [innerPopupVisible, setInnerPopupVisible] = useState(false);\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    if (!triggerElement || !popupElement) return;\n    // 避免因滚动条出现文本省略，预留宽度 8\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? 8 : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayStyle: React.CSSProperties = {};\n    if (popupProps && typeof popupProps.overlayStyle === 'object' && !popupProps.overlayStyle.width) {\n      otherOverlayStyle = popupProps.overlayStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n    if (readonly) return;\n    // 如果点击触发元素（输入框），则永久显示下拉框\n    const newVisible = context.trigger === 'trigger-element-click' ? true : visible;\n    setInnerPopupVisible(newVisible);\n    onPopupVisibleChange?.(newVisible, context);\n  };\n\n  const tOverlayStyle = useMemo(() => {\n    let result: TdPopupProps['overlayStyle'] = {};\n    const overlayStyle = popupProps?.overlayStyle || {};\n    if (isFunction(overlayStyle) || (isObject(overlayStyle) && overlayStyle.width)) {\n      result = overlayStyle;\n    } else if (!autoWidth) {\n      result = matchWidthFunc;\n    }\n    return result;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autoWidth, popupProps?.overlayStyle]);\n\n  return {\n    tOverlayStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"names":["MAX_POPUP_WIDTH","useOverlayStyle","props","popupProps","autoWidth","readonly","onPopupVisibleChange","useState","innerPopupVisible","setInnerPopupVisible","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayStyle","overlayStyle","Math","min","onInnerPopupVisibleChange","visible","context","newVisible","trigger","tOverlayStyle","useMemo","result","isFunction","isObject"],"mappings":"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"}
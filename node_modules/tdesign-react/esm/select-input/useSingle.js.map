{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import React, { useRef, MouseEvent, FormEvent, useMemo } from 'react';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport classNames from 'classnames';\nimport { SelectInputCommonProperties } from './interface';\nimport Input, { InputValue } from '../input';\nimport { TdSelectInputProps } from './type';\nimport { Loading } from '../loading';\nimport useConfig from '../_util/useConfig';\nimport useControlled from '../hooks/useControlled';\n\nexport interface RenderSelectSingleInputParams {\n  tPlaceholder: string;\n}\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onEnter',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS: TdSelectInputProps['keys'] = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps) {\n  const { value, keys, loading, disabled } = props;\n  const { classPrefix } = useConfig();\n  const inputRef = useRef();\n  const [inputValue, setInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n\n  const showLoading = useMemo(() => !disabled && loading, [loading, disabled]);\n\n  const commonInputProps: SelectInputCommonProperties = {\n    ...pick(props, COMMON_PROPERTIES),\n    suffixIcon: showLoading ? <Loading loading size=\"small\" /> : props.suffixIcon,\n  };\n\n  const onInnerClear = (context: { e: MouseEvent<SVGElement> }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange = (\n    value: InputValue,\n    context: { e: FormEvent<HTMLInputElement> | MouseEvent<HTMLElement | SVGElement> },\n  ) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    // 单选，值的呈现方式\n    const singleValueDisplay = !props.multiple ? props.valueDisplay : null;\n    const displayedValue = popupVisible && props.allowInput ? inputValue : getInputValue(value, keys);\n    return (\n      <Input\n        ref={inputRef}\n        {...commonInputProps}\n        autoWidth={props.autoWidth}\n        placeholder={singleValueDisplay ? '' : props.placeholder}\n        value={singleValueDisplay ? undefined : displayedValue}\n        label={\n          <>\n            {props.label}\n            {singleValueDisplay}\n          </>\n        }\n        onChange={onInnerInputChange}\n        readonly={!props.allowInput}\n        onClear={onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(value, { ...context, inputValue: val });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(value, { ...context, inputValue: val });\n          !popupVisible && setInputValue(getInputValue(value, keys), { ...context, trigger: 'input' });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(value, { ...context, inputValue: val });\n        }}\n        {...props.inputProps}\n        inputClass={classNames(props.inputProps?.className, {\n          [`${classPrefix}-input--focused`]: popupVisible,\n        })}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","loading","disabled","useConfig","classPrefix","inputRef","useRef","useControlled","onInputChange","inputValue","setInputValue","showLoading","useMemo","commonInputProps","pick","suffixIcon","React","createElement","Loading","size","onInnerClear","context","e","stopPropagation","onClear","trigger","onInnerInputChange","value2","allowInput","renderSelectSingle","popupVisible","singleValueDisplay","multiple","valueDisplay","displayedValue","Input","ref","autoWidth","placeholder","Fragment","onChange","readonly","onBlur","val","onFocus","onEnter","inputProps","inputClass","classNames","className"],"mappings":"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"}
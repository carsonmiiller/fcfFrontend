{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport isObject from 'lodash/isObject';\nimport classNames from 'classnames';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport TagInput, { TagInputValue } from '../tag-input';\nimport { SelectInputCommonProperties } from './interface';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../_util/useConfig';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps) {\n  const { value } = props;\n  const { classPrefix } = useConfig();\n  const tagInputRef = useRef();\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n  const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\n\n  const getTags = () => {\n    if (!(value instanceof Array)) {\n      return isObject(value) ? [value[iKeys.label]] : [value];\n    }\n    return value.map((item) => (isObject(item) ? item[iKeys.label] : item));\n  };\n  const tags = getTags();\n\n  const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\n    <TagInput\n      ref={tagInputRef}\n      {...p.commonInputProps}\n      readonly={!props.allowInput || props.readonly}\n      autoWidth={props.autoWidth}\n      minCollapsedNum={props.minCollapsedNum}\n      collapsedItems={props.collapsedItems}\n      tag={props.tag}\n      valueDisplay={props.valueDisplay}\n      placeholder={tPlaceholder}\n      value={tags}\n      inputValue={tInputValue || ''}\n      onChange={onTagInputChange}\n      onInputChange={(val, context) => {\n        // 筛选器统一特性：筛选器按下回车时不清空输入框\n        if (context?.trigger === 'enter') return;\n        setTInputValue(val, { trigger: context.trigger, e: context.e });\n      }}\n      tagProps={props.tagProps}\n      onClear={p.onInnerClear}\n      onBlur={(val, context) => {\n        props.onBlur?.(props.value, { ...context, tagInputValue: val });\n      }}\n      onFocus={(val, context) => {\n        props.onFocus?.(props.value, { ...context, tagInputValue: val });\n      }}\n      {...props.tagInputProps}\n      inputProps={{\n        inputClass: classNames(props.tagInputProps?.className, {\n          [`${classPrefix}-input--focused`]: p.popupVisible,\n        }),\n      }}\n    />\n  );\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","useConfig","classPrefix","tagInputRef","useRef","useControlled","onInputChange","tInputValue","setTInputValue","iKeys","keys","getTags","Array","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","trigger","e","stopPropagation","onTagChange","renderSelectMultiple","p","React","createElement","TagInput","ref","commonInputProps","readonly","allowInput","autoWidth","minCollapsedNum","collapsedItems","tag","valueDisplay","inputValue","onChange","tagProps","onClear","onInnerClear","onBlur","tagInputValue","onFocus","tagInputProps","inputProps","inputClass","classNames","className","popupVisible"],"mappings":"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"}
{"version":3,"file":"TimeRangePicker.js","sources":["../../src/time-picker/TimeRangePicker.tsx"],"sourcesContent":["import React, { FC, useState, useEffect } from 'react';\nimport classNames from 'classnames';\n\nimport { TimeIcon } from 'tdesign-icons-react';\nimport noop from '../_util/noop';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../_util/useConfig';\nimport { RangeInputPopup, RangeInputPosition } from '../range-input';\nimport TimePickerPanel from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\nimport { TIME_PICKER_EMPTY } from '../_common/js/time-picker/const';\n\nimport { TdTimeRangePickerProps, TimeRangeValue, TimeRangePickerPartial } from './type';\nimport { StyledProps } from '../common';\nimport { timeRangePickerDefaultProps } from './defaultProps';\n\nexport interface TimeRangePickerProps extends TdTimeRangePickerProps, StyledProps {}\n\nconst defaultArrVal = [undefined, undefined];\n\nconst TimeRangePicker: FC<TimeRangePickerProps> = (props) => {\n  const TEXT_CONFIG = useTimePickerTextConfig();\n\n  const {\n    allowInput,\n    clearable,\n    disabled,\n    format,\n    hideDisabledTime,\n    placeholder = TEXT_CONFIG.rangePlaceholder,\n    size,\n    steps,\n    disableTime,\n    onBlur = noop,\n    onFocus = noop,\n    onInput = noop,\n    style,\n    className,\n  } = props;\n\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { classPrefix } = useConfig();\n  const [isPanelShowed, setPanelShow] = useState(false);\n  const [currentPanelIdx, setCurrentPanelIdx] = useState(undefined);\n  const [currentValue, setCurrentValue] = useState(['', '']);\n\n  const name = `${classPrefix}-time-picker`;\n\n  const inputClasses = classNames(`${name}__group`, {\n    [`${classPrefix}-is-focused`]: isPanelShowed,\n  });\n\n  const handleShowPopup = (visible: boolean) => {\n    setPanelShow(visible);\n  };\n\n  const handleClear = (context: { e: React.MouseEvent }) => {\n    const { e } = context;\n    e.stopPropagation();\n    onChange(undefined);\n  };\n\n  const handleClick = ({ position }: { position: 'first' | 'second' }) => {\n    setCurrentPanelIdx(position === 'first' ? 0 : 1);\n  };\n\n  const handleTimeChange = (newValue: string) => {\n    if (currentPanelIdx === 0) {\n      setCurrentValue([newValue, currentValue[1] ?? newValue]);\n    } else {\n      setCurrentValue([currentValue[0] ?? newValue, newValue]);\n    }\n  };\n\n  const handleInputBlur = (value: TimeRangeValue, { e }: { e: React.FocusEvent<HTMLInputElement> }) => {\n    if (allowInput) {\n      const isValidTime = validateInputValue(currentValue[currentPanelIdx], format);\n      if (isValidTime) {\n        const formattedVal = formatInputValue(currentValue[currentPanelIdx], format);\n        currentPanelIdx === 0\n          ? setCurrentValue([formattedVal, currentValue[1] ?? formattedVal])\n          : setCurrentValue([currentValue[0] ?? formattedVal, formattedVal]);\n      }\n    }\n    onBlur({ value, e });\n  };\n\n  const handleInputChange = (\n    inputVal: TimeRangeValue,\n    { e, position }: { e: React.FocusEvent<HTMLInputElement>; position: RangeInputPosition },\n  ) => {\n    setCurrentValue(inputVal);\n    onInput({ value, e, position: position as TimeRangePickerPartial });\n  };\n\n  const handleClickConfirm = () => {\n    const isValidTime = !currentValue.find((v) => !validateInputValue(v, format));\n    if (isValidTime) onChange(currentValue);\n    setPanelShow(false);\n  };\n\n  const handleFocus = (\n    value: TimeRangeValue,\n    { e, position }: { e: React.FocusEvent<HTMLInputElement>; position: RangeInputPosition },\n  ) => {\n    onFocus({ value, e, position: position as TimeRangePickerPartial });\n  };\n\n  useEffect(() => {\n    setCurrentValue(isPanelShowed ? value ?? TIME_PICKER_EMPTY : defaultArrVal);\n    if (!isPanelShowed) setCurrentPanelIdx(undefined);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPanelShowed]);\n\n  return (\n    <div className={classNames(name, className)} style={style}>\n      <RangeInputPopup\n        style={style}\n        disabled={disabled}\n        popupVisible={isPanelShowed}\n        onPopupVisibleChange={handleShowPopup}\n        popupProps={{\n          overlayStyle: {\n            width: 'auto',\n          },\n          ...props.popupProps,\n        }}\n        onInputChange={handleInputChange}\n        inputValue={isPanelShowed ? currentValue : value ?? defaultArrVal}\n        rangeInputProps={{\n          size,\n          clearable,\n          className: inputClasses,\n          value: isPanelShowed ? currentValue : value ?? undefined,\n          placeholder,\n          suffixIcon: <TimeIcon />,\n          onClear: handleClear,\n          onClick: handleClick,\n          onFocus: handleFocus,\n          onBlur: handleInputBlur,\n          readonly: !allowInput,\n          activeIndex: currentPanelIdx,\n          ...props.rangeInputProps,\n        }}\n        panel={\n          <TimePickerPanel\n            steps={steps}\n            format={format}\n            disableTime={disableTime}\n            hideDisabledTime={hideDisabledTime}\n            isFooterDisplay={true}\n            value={currentValue[currentPanelIdx || 0]}\n            onChange={handleTimeChange}\n            handleConfirmClick={handleClickConfirm}\n            position={currentPanelIdx === 0 ? 'start' : 'end'}\n          />\n        }\n      />\n    </div>\n  );\n};\n\nTimeRangePicker.displayName = 'TimeRangePicker';\nTimeRangePicker.defaultProps = timeRangePickerDefaultProps;\n\nexport default TimeRangePicker;\n"],"names":["defaultArrVal","TimeRangePicker","props","TEXT_CONFIG","useTimePickerTextConfig","allowInput","clearable","disabled","format","hideDisabledTime","placeholder","rangePlaceholder","size","steps","disableTime","onBlur","noop","onFocus","onInput","style","className","useControlled","onChange","value","useConfig","classPrefix","useState","isPanelShowed","setPanelShow","currentPanelIdx","setCurrentPanelIdx","currentValue","setCurrentValue","name","inputClasses","classNames","handleShowPopup","visible","handleClear","context","e","stopPropagation","handleClick","position","handleTimeChange","newValue","handleInputBlur","value2","isValidTime","validateInputValue","formattedVal","formatInputValue","handleInputChange","inputVal","handleClickConfirm","find","v","handleFocus","useEffect","TIME_PICKER_EMPTY","React","createElement","RangeInputPopup","popupVisible","onPopupVisibleChange","popupProps","overlayStyle","width","onInputChange","inputValue","rangeInputProps","suffixIcon","TimeIcon","onClear","onClick","readonly","activeIndex","panel","TimePickerPanel","isFooterDisplay","handleConfirmClick","displayName","defaultProps","timeRangePickerDefaultProps"],"mappings":"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"}
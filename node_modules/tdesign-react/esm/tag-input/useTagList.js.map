{"version":3,"file":"useTagList.js","sources":["../../src/tag-input/useTagList.tsx"],"sourcesContent":["import React, { useState, MouseEvent, KeyboardEvent, ReactNode, Fragment } from 'react';\nimport { isFunction } from 'lodash';\nimport { TagInputChangeContext, TagInputValue, TdTagInputProps } from './type';\nimport { InputValue } from '../input';\nimport Tag from '../tag';\nimport useConfig from '../_util/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport { DragSortInnerProps } from '../_util/useDragSorter';\n\nexport type ChangeParams = [TagInputChangeContext];\n\ninterface TagInputProps extends TdTagInputProps, DragSortInnerProps {}\n\n// handle tag add and remove\nexport default function useTagList(props: TagInputProps) {\n  const { classPrefix: prefix } = useConfig();\n  const { onRemove, max, minCollapsedNum, size, disabled, readonly, tagProps, tag, collapsedItems, getDragProps } =\n    props;\n  // handle controlled property and uncontrolled property\n  const [tagValue, setTagValue] = useControlled(props, 'value', props.onChange);\n  const [oldInputValue, setOldInputValue] = useState<InputValue>();\n\n  // 点击标签关闭按钮，删除标签\n  const onClose = (p: { e?: MouseEvent<SVGElement>; index: number; item: string | number }) => {\n    const arr = [...tagValue];\n    arr.splice(p.index, 1);\n    setTagValue(arr, { trigger: 'tag-remove', ...p });\n    onRemove?.({ ...p, trigger: 'tag-remove', value: arr });\n  };\n\n  const clearAll = (context: { e: MouseEvent<SVGElement> }) => {\n    setTagValue([], { trigger: 'clear', e: context.e });\n  };\n\n  // 按下 Enter 键，新增标签\n  const onInnerEnter = (value: InputValue, context: { e: KeyboardEvent<HTMLDivElement> }) => {\n    const valueStr = value ? String(value).trim() : '';\n    if (!valueStr) return;\n    const isLimitExceeded = max && tagValue?.length >= max;\n    let newValue: TagInputValue = tagValue;\n    if (!isLimitExceeded) {\n      newValue = tagValue instanceof Array ? tagValue.concat(String(valueStr)) : [valueStr];\n      setTagValue(newValue, {\n        trigger: 'enter',\n        index: newValue.length - 1,\n        item: valueStr,\n        e: context.e,\n      });\n    }\n    props?.onEnter?.(newValue, { ...context, inputValue: value });\n  };\n\n  // 按下回退键，删除标签\n  const onInputBackspaceKeyUp = (value: InputValue, context: { e: KeyboardEvent<HTMLDivElement> }) => {\n    const { e } = context;\n    if (!tagValue || !tagValue.length) return;\n    // 回车键删除，输入框值为空时，才允许 Backspace 删除标签\n    if (!oldInputValue && ['Backspace', 'NumpadDelete'].includes(e.code)) {\n      const index = tagValue.length - 1;\n      const item = tagValue[index];\n      const trigger = 'backspace';\n      setTagValue(tagValue.slice(0, -1), { e, index, item, trigger });\n      onRemove?.({ e, index, item, trigger, value: tagValue });\n    }\n    setOldInputValue(value);\n  };\n\n  const renderLabel = ({ displayNode, label }: { displayNode: ReactNode; label: ReactNode }) => {\n    const newList = minCollapsedNum ? tagValue.slice(0, minCollapsedNum) : tagValue;\n    const list = displayNode\n      ? [displayNode]\n      : newList?.map((item, index) => {\n          const tagContent = isFunction(tag) ? tag({ value: item }) : tag;\n          return (\n            <Tag\n              key={index}\n              size={size}\n              disabled={disabled}\n              onClose={(context) => onClose({ e: context.e, item, index })}\n              closable={!readonly && !disabled}\n              {...getDragProps?.(index, item)}\n              {...tagProps}\n            >\n              {tagContent ?? item}\n            </Tag>\n          );\n        });\n    if (label) {\n      list?.unshift(\n        <div className={`${prefix}-tag-input__prefix`} key=\"label\">\n          {label}\n        </div>,\n      );\n    }\n    // 超出省略\n    if (newList.length !== tagValue.length) {\n      const len = tagValue.length - newList.length;\n      const params = {\n        value: tagValue,\n        count: tagValue.length,\n        collapsedTags: tagValue.slice(minCollapsedNum, tagValue.length),\n      };\n      const more = isFunction(collapsedItems) ? collapsedItems(params) : collapsedItems;\n      list.push(<Fragment key=\"more\">{more ?? <Tag>+{len}</Tag>}</Fragment>);\n    }\n    return list;\n  };\n\n  return {\n    tagValue,\n    clearAll,\n    onClose,\n    onInnerEnter,\n    onInputBackspaceKeyUp,\n    renderLabel,\n  };\n}\n"],"names":["useTagList","props","useConfig","prefix","classPrefix","onRemove","max","minCollapsedNum","size","disabled","readonly","tagProps","tag","collapsedItems","getDragProps","useControlled","onChange","tagValue","setTagValue","useState","oldInputValue","setOldInputValue","onClose","p","arr","splice","index","trigger","value","clearAll","context","e","onInnerEnter","valueStr","String","trim","isLimitExceeded","length","newValue","Array","concat","item","onEnter","inputValue","onInputBackspaceKeyUp","includes","code","slice","renderLabel","displayNode","label","newList","list","map","tagContent","isFunction","React","createElement","Tag","key","closable","unshift","className","len","params","count","collapsedTags","more","push","Fragment"],"mappings":"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"}
{"version":3,"file":"useTagScroll.js","sources":["../../src/tag-input/useTagScroll.ts"],"sourcesContent":["/**\n * 当标签数量过多时，输入框显示不下，则需要滚动查看，以下为滚动逻辑\n * 如果标签过多时的处理方式，是标签省略，则不需要此功能\n */\n\nimport { useRef, useEffect, RefObject, useState, WheelEvent } from 'react';\nimport { TdTagInputProps } from './type';\n\nlet mouseEnterTimer = null;\n\nexport default function useTagScroll(props: TdTagInputProps) {\n  const tagInputRef: RefObject<{ currentElement: HTMLDivElement }> = useRef();\n  const { excessTagsDisplayType = 'scroll', readonly, disabled } = props;\n  // 允许向右滚动的最大距离\n  const [scrollDistance, setScrollDistance] = useState(0);\n  const [scrollElement, setScrollElement] = useState<HTMLDivElement>();\n\n  const updateScrollElement = (element: HTMLDivElement) => {\n    const scrollElement = element.children[0] as HTMLDivElement;\n    setScrollElement(scrollElement);\n  };\n\n  const updateScrollDistance = () => {\n    setScrollDistance(scrollElement.scrollWidth - scrollElement.clientWidth);\n  };\n\n  const scrollTo = (distance: number) => {\n    scrollElement?.scroll({ left: distance, behavior: 'smooth' });\n  };\n\n  const scrollToRight = () => {\n    updateScrollDistance();\n    scrollTo(scrollDistance);\n  };\n\n  const scrollToLeft = () => {\n    scrollTo(0);\n  };\n\n  // TODO：MAC 电脑横向滚动，Windows 纵向滚动。当前只处理了横向滚动\n  const onWheel = ({ e }: { e: WheelEvent<HTMLDivElement> }) => {\n    if (readonly || disabled) return;\n    if (!scrollElement) return;\n    if (e.deltaX > 0) {\n      const distance = Math.min(scrollElement.scrollLeft + 120, scrollDistance);\n      scrollTo(distance);\n    } else {\n      const distance = Math.max(scrollElement.scrollLeft - 120, 0);\n      scrollTo(distance);\n    }\n  };\n\n  // 鼠标 hover，自动滑动到最右侧，以便输入新标签\n  const scrollToRightOnEnter = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    // 一闪而过的 mousenter 不需要执行\n    mouseEnterTimer = setTimeout(() => {\n      scrollToRight();\n      clearTimeout(mouseEnterTimer);\n    }, 100);\n  };\n\n  const scrollToLeftOnLeave = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    scrollTo(0);\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const clearScroll = () => {\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const initScroll = (element: HTMLDivElement) => {\n    if (!element) return;\n    updateScrollElement(element);\n  };\n\n  useEffect(() => {\n    initScroll(tagInputRef?.current.currentElement);\n    return clearScroll;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return {\n    initScroll,\n    clearScroll,\n    tagInputRef,\n    scrollElement,\n    scrollDistance,\n    scrollTo,\n    scrollToRight,\n    scrollToLeft,\n    updateScrollElement,\n    updateScrollDistance,\n    onWheel,\n    scrollToRightOnEnter,\n    scrollToLeftOnLeave,\n  };\n}\n"],"names":["mouseEnterTimer","useTagScroll","props","tagInputRef","useRef","excessTagsDisplayType","readonly","disabled","useState","scrollDistance","setScrollDistance","scrollElement","setScrollElement","updateScrollElement","element","scrollElement2","children","updateScrollDistance","scrollWidth","clientWidth","scrollTo","distance","scroll","left","behavior","scrollToRight","scrollToLeft","onWheel","e","deltaX","Math","min","scrollLeft","max","scrollToRightOnEnter","setTimeout","clearTimeout","scrollToLeftOnLeave","clearScroll","initScroll","useEffect","current","currentElement"],"mappings":"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"}
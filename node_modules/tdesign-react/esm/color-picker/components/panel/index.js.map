{"version":3,"file":"index.js","sources":["../../../../src/color-picker/components/panel/index.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, forwardRef, MutableRefObject, useCallback } from 'react';\nimport classNames from 'classnames';\nimport tinyColor from 'tinycolor2';\n\nimport useCommonClassName from '../../../_util/useCommonClassName';\nimport useControlled from '../../../hooks/useControlled';\nimport { useLocaleReceiver } from '../../../locale/LocalReceiver';\nimport useClassname from '../../hooks/useClassname';\nimport PanelHeader from './header';\nimport Color, { getColorObject } from '../../../_common/js/color-picker/color';\nimport { GradientColorPoint } from '../../../_common/js/color-picker/gradient';\nimport {\n  DEFAULT_COLOR,\n  DEFAULT_LINEAR_GRADIENT,\n  TD_COLOR_USED_COLORS_MAX_SIZE,\n  DEFAULT_SYSTEM_SWATCH_COLORS,\n} from '../../const';\nimport { ColorPickerProps, TdColorModes, TdColorSaturationData } from '../../interface';\nimport { ColorPickerChangeTrigger, TdColorPickerProps } from '../../type';\nimport LinearGradient from './linear-gradient';\nimport SaturationPanel from './saturation';\nimport HUESlider from './hue';\nimport AlphaSlider from './alpha';\nimport FormatPanel from './format';\nimport SwatchesPanel from './swatches';\n\nconst mathRound = Math.round;\n\nconst Panel = forwardRef((props: ColorPickerProps, ref: MutableRefObject<HTMLDivElement>) => {\n  const baseClassName = useClassname();\n  const { STATUS } = useCommonClassName();\n  const [local, t] = useLocaleReceiver('colorPicker');\n  const {\n    value,\n    disabled,\n    onChange,\n    enableAlpha = false,\n    format,\n    onPaletteBarChange,\n    swatchColors,\n    className,\n    style = {},\n    togglePopup,\n    closeBtn,\n    colorModes = ['linear-gradient', 'monochrome'],\n  } = props;\n  const [innerValue, setInnerValue] = useControlled(props, 'value', onChange);\n  const colorInstanceRef = useRef<Color>(new Color(innerValue || DEFAULT_COLOR));\n  const getmodeByColor = colorInstanceRef.current.isGradient ? 'linear-gradient' : 'monochrome';\n  const [mode, setMode] = useState<TdColorModes>(colorModes?.length === 1 ? colorModes[0] : getmodeByColor);\n\n  const formatValue = useCallback(() => {\n    // 渐变模式下直接输出css样式\n    if (mode === 'linear-gradient') {\n      return colorInstanceRef.current.linearGradient;\n    }\n\n    return colorInstanceRef.current.getFormatsColorMap()[format] || colorInstanceRef.current.css;\n  }, [format, mode]);\n\n  const emitColorChange = useCallback(\n    (trigger?: ColorPickerChangeTrigger) => {\n      setInnerValue(formatValue(), {\n        color: getColorObject(colorInstanceRef.current),\n        trigger: trigger || 'palette-saturation-brightness',\n      });\n    },\n    [formatValue, setInnerValue],\n  );\n\n  useEffect(() => {\n    if (typeof value === 'undefined' || mode === 'linear-gradient') {\n      return;\n    }\n\n    // common Color new 的时候使用 hsv ，一个 rgba 可以对应两个 hsv ，这里先直接用 tinycolor 比较下颜色是否修改了\n    const newUniqColor = tinyColor(value).toRgb();\n    const { r, g, b, a } = newUniqColor;\n    const newUniqRgbaColor = `rgba(${mathRound(r)}, ${mathRound(g)}, ${mathRound(b)}, ${a})`;\n\n    const newColor = new Color(value);\n    const formattedColor = newUniqRgbaColor || DEFAULT_COLOR;\n    const currentColor = colorInstanceRef.current.rgba;\n\n    const isInRightMode = mode === 'monochrome' && !newColor.isGradient;\n\n    if (formattedColor !== currentColor && isInRightMode) {\n      colorInstanceRef.current.update(formattedColor);\n      setInnerValue(formatValue(), {\n        color: newColor,\n        trigger: 'input',\n      });\n    }\n  }, [value, formatValue, setInnerValue, mode]);\n\n  useEffect(() => {\n    if (colorModes.length === 1) {\n      setMode(colorModes[0]);\n    } else {\n      setMode(getmodeByColor);\n    }\n  }, [colorModes, getmodeByColor]);\n\n  const formatRef = useRef<TdColorPickerProps['format']>(colorInstanceRef.current.isGradient ? 'CSS' : 'RGB');\n\n  const { onRecentColorsChange } = props;\n  const [recentlyUsedColors, setRecentlyUsedColors] = useControlled<TdColorPickerProps['recentColors'], any>(\n    props,\n    'recentColors',\n    onRecentColorsChange,\n  );\n\n  const baseProps = {\n    color: colorInstanceRef.current,\n    disabled,\n    baseClassName,\n  };\n\n  const handleModeChange = (value: TdColorModes) => {\n    setMode(value);\n    const { rgba, gradientColors, linearGradient } = colorInstanceRef.current;\n    if (value === 'linear-gradient') {\n      colorInstanceRef.current = new Color(gradientColors.length > 0 ? linearGradient : DEFAULT_LINEAR_GRADIENT);\n      return;\n    }\n    colorInstanceRef.current = new Color(rgba);\n  };\n\n  // 最近使用颜色变更时触发\n  const handleRecentlyUsedColorsChange = (colors: string[]) => {\n    setRecentlyUsedColors(colors);\n  };\n\n  // 添加最近使用颜色\n  const addRecentlyUsedColor = () => {\n    if (recentlyUsedColors === null || !recentlyUsedColors) {\n      return;\n    }\n    const colors = [...((recentlyUsedColors as string[]) || [])];\n    const { isGradient, linearGradient, rgba } = colorInstanceRef.current;\n    const currentColor = isGradient ? linearGradient : rgba;\n    const index = colors.indexOf(currentColor);\n    if (index > -1) {\n      colors.splice(index, 1);\n    }\n    colors.unshift(currentColor);\n    if (colors.length > TD_COLOR_USED_COLORS_MAX_SIZE) {\n      colors.length = TD_COLOR_USED_COLORS_MAX_SIZE;\n    }\n    handleRecentlyUsedColorsChange(colors);\n  };\n\n  // 饱和度变化\n  const handleSaturationChange = ({ saturation, value }: TdColorSaturationData) => {\n    const { saturation: sat, value: val } = colorInstanceRef.current;\n    let changeTrigger: ColorPickerChangeTrigger = 'palette-saturation-brightness';\n    if (value !== val && saturation !== sat) {\n      changeTrigger = 'palette-saturation-brightness';\n      colorInstanceRef.current.saturation = saturation;\n      colorInstanceRef.current.value = value;\n    } else if (saturation !== sat) {\n      changeTrigger = 'palette-saturation';\n      colorInstanceRef.current.saturation = saturation;\n    } else if (value !== val) {\n      changeTrigger = 'palette-brightness';\n      colorInstanceRef.current.value = value;\n    } else {\n      return;\n    }\n\n    emitColorChange(changeTrigger);\n  };\n\n  // hue色相变化\n  const handleHUEChange = (hue: number) => {\n    colorInstanceRef.current.hue = hue;\n    emitColorChange('palette-hue-bar');\n    onPaletteBarChange?.({\n      color: getColorObject(colorInstanceRef.current),\n    });\n  };\n\n  /**\n   * 透明度变化\n   * @param alpha\n   */\n  const handleAlphaChange = (alpha: number) => {\n    colorInstanceRef.current.alpha = alpha;\n    emitColorChange('palette-alpha-bar');\n    onPaletteBarChange?.({\n      color: getColorObject(colorInstanceRef.current),\n    });\n  };\n\n  /**\n   * 渐变改变\n   * @param param0\n   */\n  const handleGradientChange = ({\n    key,\n    payload,\n  }: {\n    key: 'degree' | 'selectedId' | 'colors';\n    payload: number | string | GradientColorPoint[];\n    addUsedColor?: boolean;\n  }) => {\n    let trigger: ColorPickerChangeTrigger = 'palette-saturation-brightness';\n    switch (key) {\n      case 'degree':\n        colorInstanceRef.current.gradientDegree = payload as number;\n        trigger = 'input';\n        break;\n      case 'selectedId':\n        colorInstanceRef.current.gradientSelectedId = payload as string;\n        break;\n      case 'colors':\n        colorInstanceRef.current.gradientColors = payload as GradientColorPoint[];\n        break;\n    }\n    emitColorChange(trigger);\n  };\n\n  // format选择格式变化\n  const handleFormatModeChange = (format: TdColorPickerProps['format']) => (formatRef.current = format);\n\n  // format输入变化\n  const handleInputChange = (input: string, alpha?: number) => {\n    colorInstanceRef.current.update(input);\n    colorInstanceRef.current.alpha = alpha;\n    emitColorChange('input');\n  };\n\n  // 渲染预设颜色区域\n  const SwatchesArea = React.memo(() => {\n    // 最近使用颜色\n    const showUsedColors = recentlyUsedColors !== null && recentlyUsedColors !== false;\n    // 系统颜色\n    let systemColors = swatchColors;\n    if (systemColors === undefined) {\n      systemColors = [...DEFAULT_SYSTEM_SWATCH_COLORS];\n    }\n    const showSystemColors = systemColors?.length > 0;\n\n    if (!showSystemColors && !showUsedColors) {\n      return null;\n    }\n\n    // 色块点击\n    const handleSetColor = (value: string) => {\n      const isGradientValue = Color.isGradientColor(value);\n      const color = colorInstanceRef.current;\n      if (isGradientValue) {\n        if (colorModes.includes('linear-gradient')) {\n          setMode('linear-gradient');\n          color.update(value);\n          color.updateCurrentGradientColor();\n        } else {\n          console.warn('该模式不支持渐变色');\n        }\n      } else if (mode === 'linear-gradient') {\n        color.updateStates(value);\n        color.updateCurrentGradientColor();\n      } else {\n        color.update(value);\n      }\n      emitColorChange();\n    };\n\n    return (\n      <>\n        <div className={`${baseClassName}__swatches-wrap`}>\n          {showUsedColors && (\n            <SwatchesPanel\n              {...baseProps}\n              title={t(local.recentColorTitle)}\n              editable\n              handleAddColor={addRecentlyUsedColor}\n              colors={recentlyUsedColors as string[]}\n              onSetColor={(color: string) => handleSetColor(color)}\n              onChange={handleRecentlyUsedColorsChange}\n            />\n          )}\n          {showSystemColors && (\n            <SwatchesPanel\n              {...baseProps}\n              title={t(local.swatchColorTitle)}\n              colors={systemColors}\n              onSetColor={(color: string) => handleSetColor(color)}\n            />\n          )}\n        </div>\n      </>\n    );\n  });\n\n  return (\n    <div\n      className={classNames(`${baseClassName}__panel`, disabled ? STATUS.disabled : false, className)}\n      onClick={(e) => e.stopPropagation()}\n      style={{ ...style }}\n      ref={ref}\n    >\n      <PanelHeader\n        baseClassName={baseClassName}\n        mode={mode}\n        colorModes={colorModes}\n        closeBtn={closeBtn}\n        togglePopup={togglePopup}\n        onModeChange={handleModeChange}\n      />\n      <div className={`${baseClassName}__body`}>\n        {mode === 'linear-gradient' && <LinearGradient {...baseProps} onChange={handleGradientChange} />}\n        <SaturationPanel {...baseProps} onChange={handleSaturationChange} />\n        <HUESlider {...baseProps} onChange={handleHUEChange} />\n        {enableAlpha && <AlphaSlider {...baseProps} onChange={handleAlphaChange} />}\n        <FormatPanel\n          {...props}\n          {...baseProps}\n          format={formatRef.current}\n          onModeChange={handleFormatModeChange}\n          onInputChange={handleInputChange}\n        />\n        <SwatchesArea />\n      </div>\n    </div>\n  );\n});\n\nexport default React.memo(Panel);\n"],"names":["mathRound","Math","round","Panel","forwardRef","props","ref","baseClassName","useClassname","useCommonClassName","STATUS","useLocaleReceiver","local","t","value","disabled","onChange","enableAlpha","format","onPaletteBarChange","swatchColors","className","style","togglePopup","closeBtn","colorModes","useControlled","innerValue","setInnerValue","colorInstanceRef","useRef","Color","DEFAULT_COLOR","getmodeByColor","current","isGradient","useState","length","mode","setMode","formatValue","useCallback","linearGradient","getFormatsColorMap","css","emitColorChange","trigger","color","getColorObject","useEffect","newUniqColor","tinyColor","toRgb","r","g","b","a","newUniqRgbaColor","newColor","formattedColor","currentColor","rgba","isInRightMode","update","formatRef","onRecentColorsChange","recentlyUsedColors","setRecentlyUsedColors","baseProps","handleModeChange","value2","gradientColors","DEFAULT_LINEAR_GRADIENT","handleRecentlyUsedColorsChange","colors","addRecentlyUsedColor","index","indexOf","splice","unshift","TD_COLOR_USED_COLORS_MAX_SIZE","handleSaturationChange","saturation","sat","val","changeTrigger","handleHUEChange","hue","handleAlphaChange","alpha","handleGradientChange","key","payload","gradientDegree","gradientSelectedId","handleFormatModeChange","format2","handleInputChange","input","SwatchesArea","React","memo","showUsedColors","systemColors","DEFAULT_SYSTEM_SWATCH_COLORS","showSystemColors","handleSetColor","isGradientValue","isGradientColor","includes","updateCurrentGradientColor","console","warn","updateStates","createElement","Fragment","SwatchesPanel","title","recentColorTitle","editable","handleAddColor","onSetColor","swatchColorTitle","classNames","onClick","e","stopPropagation","PanelHeader","onModeChange","LinearGradient","SaturationPanel","HUESlider","AlphaSlider","FormatPanel","onInputChange"],"mappings":"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"}
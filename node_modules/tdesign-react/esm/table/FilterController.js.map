{"version":3,"file":"FilterController.js","sources":["../../src/table/FilterController.tsx"],"sourcesContent":["import React, { useState, useRef, ReactNode } from 'react';\nimport { FilterIcon } from 'tdesign-icons-react';\n\nimport isEmpty from 'lodash/isEmpty';\nimport classNames from 'classnames';\n\nimport Popup from '../popup';\nimport Checkbox from '../checkbox';\nimport Radio from '../radio';\nimport Input from '../input';\nimport TButton from '../button';\nimport { PrimaryTableCol, FilterValue, TableRowData } from './type';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\n\nconst CheckboxGroup = Checkbox.Group;\nconst RadioGroup = Radio.Group;\nexport interface TableFilterControllerProps {\n  filterIcon: ReactNode;\n  tFilterValue: FilterValue;\n  innerFilterValue: FilterValue;\n  tableFilterClasses: {\n    filterable: string;\n    popup: string;\n    icon: string;\n    popupContent: string;\n    result: string;\n    inner: string;\n    bottomButtons: string;\n    contentInner: string;\n    iconWrap: string;\n  };\n  isFocusClass: string;\n  column: PrimaryTableCol;\n  primaryTableElement: HTMLElement;\n  onVisibleChange: (val: boolean) => void;\n  onReset: (column: PrimaryTableCol<TableRowData>) => void;\n  onConfirm: (column: PrimaryTableCol<TableRowData>) => void;\n  onInnerFilterChange: (val: any, column: PrimaryTableCol<TableRowData>) => void;\n}\n\nexport default function TableFilterController(props: TableFilterControllerProps) {\n  const { tFilterValue, innerFilterValue, tableFilterClasses, isFocusClass, column } = props;\n\n  const triggerElementRef = useRef<HTMLDivElement>(null);\n  const [locale, t] = useLocaleReceiver('table');\n  const [filterPopupVisible, setFilterPopupVisible] = useState(false);\n\n  const onFilterPopupVisibleChange = (visible: boolean) => {\n    setFilterPopupVisible(visible);\n    props.onVisibleChange?.(visible);\n  };\n\n  const getFilterContent = (column: PrimaryTableCol) => {\n    const types = ['single', 'multiple', 'input'];\n    if (column.type && !types.includes(column.filter.type)) {\n      console.error(`TDesign Table Error: column.filter.type must be the following: ${JSON.stringify(types)}`);\n      return;\n    }\n    const Component = {\n      single: RadioGroup,\n      multiple: CheckboxGroup,\n      input: Input,\n    }[column.filter.type];\n    if (!Component && !column?.filter?.component) return;\n    const filterComponentProps: { [key: string]: any } = {\n      options: ['single', 'multiple'].includes(column.filter.type) ? column.filter?.list : undefined,\n      ...(column.filter?.props || {}),\n      value: innerFilterValue?.[column.colKey],\n      onChange: (val: any) => {\n        props.onInnerFilterChange?.(val, column);\n      },\n    };\n\n    const FilterComponent = column?.filter?.component || Component;\n    return (\n      <div className={tableFilterClasses.contentInner}>\n        <FilterComponent value={innerFilterValue?.[column.colKey]} {...filterComponentProps} />\n      </div>\n    );\n  };\n\n  const getBottomButtons = (column: PrimaryTableCol) => {\n    if (!column.filter.showConfirmAndReset) return;\n    return (\n      <div className={tableFilterClasses.bottomButtons}>\n        <TButton\n          theme=\"default\"\n          size=\"small\"\n          onClick={() => {\n            setFilterPopupVisible(false);\n            props.onReset?.(column);\n          }}\n        >\n          {locale.resetText}\n        </TButton>\n        <TButton\n          theme=\"primary\"\n          size=\"small\"\n          onClick={() => {\n            setFilterPopupVisible(false);\n            props.onConfirm?.(column);\n          }}\n        >\n          {locale.confirmText}\n        </TButton>\n      </div>\n    );\n  };\n\n  if (!column.filter || (column.filter && !Object.keys(column.filter).length)) return null;\n  const defaultFilterIcon = t(locale.filterIcon) || <FilterIcon />;\n  return (\n    <Popup\n      // attach={primaryTableElement ? () => primaryTableElement : undefined}\n      visible={filterPopupVisible}\n      destroyOnClose\n      trigger=\"click\"\n      placement=\"bottom-right\"\n      showArrow\n      overlayClassName={tableFilterClasses.popup}\n      onVisibleChange={(val: boolean) => onFilterPopupVisibleChange(val)}\n      className={classNames([tableFilterClasses.icon, { [isFocusClass]: !isEmpty(tFilterValue?.[column.colKey]) }])}\n      content={\n        <div className={tableFilterClasses.popupContent}>\n          {getFilterContent(column)}\n          {getBottomButtons(column)}\n        </div>\n      }\n    >\n      <div ref={triggerElementRef}>{props.filterIcon || defaultFilterIcon}</div>\n    </Popup>\n  );\n}\n"],"names":["CheckboxGroup","Checkbox","Group","RadioGroup","Radio","TableFilterController","props","tFilterValue","innerFilterValue","tableFilterClasses","isFocusClass","column","triggerElementRef","useRef","useLocaleReceiver","locale","t","useState","filterPopupVisible","setFilterPopupVisible","onFilterPopupVisibleChange","visible","onVisibleChange","getFilterContent","column2","types","type","includes","filter","console","error","JSON","stringify","Component","single","multiple","input","Input","component","filterComponentProps","options","list","value","colKey","onChange","val","onInnerFilterChange","FilterComponent","React","createElement","className","contentInner","getBottomButtons","showConfirmAndReset","bottomButtons","TButton","theme","size","onClick","onReset","resetText","onConfirm","confirmText","Object","keys","length","defaultFilterIcon","filterIcon","FilterIcon","Popup","destroyOnClose","trigger","placement","showArrow","overlayClassName","popup","classNames","icon","isEmpty","content","popupContent","ref"],"mappings":"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"}
{"version":3,"file":"dragger.js","sources":["../../src/upload/dragger.tsx"],"sourcesContent":["import React, { DragEvent, FC, useState } from 'react';\nimport classNames from 'classnames';\nimport { TNode } from '../common';\nimport { TriggerContext, UploadFile, UploadRemoveContext } from './type';\nimport { CustomDraggerRenderProps } from './types';\nimport useConfig from '../_util/useConfig';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport DraggerProgress from './themes/dragger-progress';\n\nexport interface DraggerProps {\n  file?: UploadFile;\n  display?: string;\n  trigger?: string | TNode<TriggerContext>;\n  customDraggerRender?: (props: CustomDraggerRenderProps) => TNode;\n  onCancel?: () => void;\n  onTrigger?: () => void;\n  onRemove?: (context: UploadRemoveContext) => void;\n  onUpload?: (uploadFile: UploadFile) => void;\n  onChange?: (files: FileList) => void;\n  onDragenter?: (e: DragEvent) => void;\n  onDragleave?: (e: DragEvent) => void;\n  onDrop?: (e: DragEvent) => void;\n}\n\nconst Dragger: FC<DraggerProps> = (props) => {\n  const { file, display, onUpload, onRemove, customDraggerRender, onCancel } = props;\n  const { classPrefix } = useConfig();\n  const [locale, t] = useLocaleReceiver('upload');\n  const [dragActive, setDragActive] = useState(false);\n  const target = React.useRef();\n  const { draggingText, dragDropText } = locale.dragger;\n  const dragTriggerText = t(locale.triggerUploadText.normal);\n  const classes = classNames(\n    `${classPrefix}-upload__dragger`,\n    !file ? `${classPrefix}-upload__dragger-center` : '',\n    file?.status === 'fail' ? `${classPrefix}-upload__dragger-error` : '',\n  );\n\n  const defaultDragElement = React.useMemo(() => {\n    const unActiveElement = (\n      <div>\n        <span className={`${classPrefix}-upload--highlight`}>{dragTriggerText}</span>\n        <span>&nbsp;&nbsp;/&nbsp;&nbsp;{t(draggingText)}</span>\n      </div>\n    );\n    const activeElement = <div>{t(dragDropText)}</div>;\n    return dragActive ? activeElement : unActiveElement;\n  }, [classPrefix, dragActive, dragDropText, dragTriggerText, draggingText, t]);\n\n  const dragElement = React.useMemo(() => {\n    let content: React.ReactNode;\n    if (file && display !== 'custom') {\n      content = (\n        <DraggerProgress\n          onRemove={onRemove}\n          display={display}\n          onTrigger={props.onTrigger}\n          file={file}\n          onUpload={() => {\n            onUpload?.(file);\n          }}\n          onCancel={onCancel}\n        />\n      );\n    } else {\n      content = (\n        <div className={`${classPrefix}-upload__trigger`} onClick={props.onTrigger}>\n          {customDraggerRender?.({ dragActive }) || defaultDragElement}\n        </div>\n      );\n    }\n\n    return content;\n  }, [\n    file,\n    display,\n    onRemove,\n    props.onTrigger,\n    onCancel,\n    onUpload,\n    classPrefix,\n    customDraggerRender,\n    dragActive,\n    defaultDragElement,\n  ]);\n\n  const handleDrop = (event: DragEvent) => {\n    event.preventDefault();\n    props.onChange?.(event.dataTransfer.files);\n    props.onDrop?.(event);\n    setDragActive(false);\n  };\n\n  const handleDragenter = (event: DragEvent) => {\n    event.preventDefault();\n    props.onDragenter?.(event);\n    setDragActive(true);\n  };\n\n  const handleDragleave = (event: DragEvent) => {\n    if (!target.current) return;\n    event.preventDefault();\n    props.onDragleave?.(event);\n    setDragActive(false);\n  };\n\n  const handleDragover = (event: DragEvent) => {\n    event.preventDefault();\n  };\n\n  return (\n    <div\n      ref={target}\n      className={classes}\n      onDrop={handleDrop}\n      onDragEnter={handleDragenter}\n      onDragOver={handleDragover}\n      onDragLeave={handleDragleave}\n    >\n      {dragElement}\n    </div>\n  );\n};\n\nexport default Dragger;\n"],"names":["Dragger","props","file","display","onUpload","onRemove","customDraggerRender","onCancel","useConfig","classPrefix","useLocaleReceiver","locale","t","useState","dragActive","setDragActive","target","React","useRef","dragger","draggingText","dragDropText","dragTriggerText","triggerUploadText","normal","classes","classNames","status","defaultDragElement","useMemo","unActiveElement","createElement","className","activeElement","dragElement","content","DraggerProgress","onTrigger","onClick","handleDrop","event","preventDefault","onChange","dataTransfer","files","onDrop","handleDragenter","onDragenter","handleDragleave","current","onDragleave","handleDragover","ref","onDragEnter","onDragOver","onDragLeave"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,IAAMA,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,EAAW;AACzB,EAAA,IAAQC,IAAR,GAA6ED,KAA7E,CAAQC,IAAR;AAAA,MAAcC,OAAd,GAA6EF,KAA7E,CAAcE,OAAd;AAAA,MAAuBC,SAAvB,GAA6EH,KAA7E,CAAuBG,QAAvB;AAAA,MAAiCC,QAAjC,GAA6EJ,KAA7E,CAAiCI,QAAjC;AAAA,MAA2CC,mBAA3C,GAA6EL,KAA7E,CAA2CK,mBAA3C;AAAA,MAAgEC,QAAhE,GAA6EN,KAA7E,CAAgEM,QAAhE,CAAA;;AACA,EAAA,IAAA,UAAA,GAAwBC,SAAS,EAAjC;MAAQC,WAAR,cAAQA,WAAR,CAAA;;EACA,IAAoBC,kBAAAA,GAAAA,iBAAiB,CAAC,QAAD,CAArC;AAAA,MAAA,mBAAA,GAAA,cAAA,CAAA,kBAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,MAAP,GAAA,mBAAA,CAAA,CAAA,CAAA;AAAA,MAAeC,CAAf,GAAA,mBAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAoCC,SAAAA,GAAAA,QAAQ,CAAC,KAAD,CAA5C;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,UAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAmBC,aAAnB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACA,EAAA,IAAMC,MAAM,GAAGC,KAAK,CAACC,MAAN,EAAf,CAAA;EACA,IAAuCP,eAAAA,GAAAA,MAAM,CAACQ,OAA9C;MAAQC,YAAR,mBAAQA,YAAR;MAAsBC,YAAtB,mBAAsBA,YAAtB,CAAA;EACA,IAAMC,eAAe,GAAGV,CAAC,CAACD,MAAM,CAACY,iBAAP,CAAyBC,MAA1B,CAAzB,CAAA;AACA,EAAA,IAAMC,OAAO,GAAGC,UAAU,CAAA,EAAA,CAAA,MAAA,CAAIjB,WAAJ,EAAA,kBAAA,CAAA,EAAmC,CAACP,IAAD,GAAWO,EAAAA,CAAAA,MAAAA,CAAAA,WAAX,EAAkD,yBAAA,CAAA,GAAA,EAArF,EAAyF,CAAAP,IAAI,KAAA,IAAJ,IAAAA,IAAI,KAAJ,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,IAAI,CAAEyB,MAAN,MAAiB,MAAjB,GAAA,EAAA,CAAA,MAAA,CAA6BlB,WAA7B,EAAA,wBAAA,CAAA,GAAmE,EAA5J,CAA1B,CAAA;AACA,EAAA,IAAMmB,kBAAkB,GAAGX,KAAK,CAACY,OAAN,CAAc,YAAM;AAC7C,IAAA,IAAMC,eAAe,kBAAmBb,KAAK,CAACc,aAAN,CAAoB,KAApB,EAA2B,IAA3B,iBAAiDd,KAAK,CAACc,aAAN,CAAoB,MAApB,EAA4B;AACnHC,MAAAA,SAAS,YAAKvB,WAAL,EAAA,oBAAA,CAAA;KAD8E,EAEtFa,eAFsF,CAAjD,iBAEHL,KAAK,CAACc,aAAN,CAAoB,MAApB,EAA4B,IAA5B,EAAkC,mBAAlC,EAAuDnB,CAAC,CAACQ,YAAD,CAAxD,CAFG,CAAxC,CAAA;AAGA,IAAA,IAAMa,aAAa,kBAAmBhB,KAAK,CAACc,aAAN,CAAoB,KAApB,EAA2B,IAA3B,EAAiCnB,CAAC,CAACS,YAAD,CAAlC,CAAtC,CAAA;AACA,IAAA,OAAOP,UAAU,GAAGmB,aAAH,GAAmBH,eAApC,CAAA;AACD,GAN0B,EAMxB,CAACrB,WAAD,EAAcK,UAAd,EAA0BO,YAA1B,EAAwCC,eAAxC,EAAyDF,YAAzD,EAAuER,CAAvE,CANwB,CAA3B,CAAA;AAOA,EAAA,IAAMsB,WAAW,GAAGjB,KAAK,CAACY,OAAN,CAAc,YAAM;AACtC,IAAA,IAAIM,OAAJ,CAAA;;AACA,IAAA,IAAIjC,IAAI,IAAIC,OAAO,KAAK,QAAxB,EAAkC;AAChCgC,MAAAA,OAAO,kBAAmBlB,KAAK,CAACc,aAAN,CAAoBK,eAApB,EAAqC;AAC7D/B,QAAAA,QAAQ,EAARA,QAD6D;AAE7DF,QAAAA,OAAO,EAAPA,OAF6D;QAG7DkC,SAAS,EAAEpC,KAAK,CAACoC,SAH4C;AAI7DnC,QAAAA,IAAI,EAAJA,IAJ6D;AAK7DE,QAAAA,QAAQ,EAAE,SAAM,QAAA,GAAA;UACdA,SAAQ,KAAA,IAAR,IAAAA,SAAQ,KAAA,KAAA,CAAR,YAAAA,SAAQ,CAAGF,IAAH,CAAR,CAAA;SAN2D;AAQ7DK,QAAAA,QAAQ,EAARA,QAAAA;AAR6D,OAArC,CAA1B,CAAA;AAUD,KAXD,MAWO;AACL4B,MAAAA,OAAO,kBAAmBlB,KAAK,CAACc,aAAN,CAAoB,KAApB,EAA2B;QACnDC,SAAS,EAAA,EAAA,CAAA,MAAA,CAAKvB,WAAL,EAD0C,kBAAA,CAAA;QAEnD6B,OAAO,EAAErC,KAAK,CAACoC,SAAAA;OAFS,EAGvB,CAAA/B,mBAAmB,KAAA,IAAnB,IAAAA,mBAAmB,KAAA,KAAA,CAAnB,GAAAA,KAAAA,CAAAA,GAAAA,mBAAmB,CAAG;AAAEQ,QAAAA,UAAU,EAAVA,UAAAA;OAAL,CAAnB,KAAyCc,kBAHlB,CAA1B,CAAA;AAID,KAAA;;AACD,IAAA,OAAOO,OAAP,CAAA;GAnBkB,EAoBjB,CACDjC,IADC,EAEDC,OAFC,EAGDE,QAHC,EAIDJ,KAAK,CAACoC,SAJL,EAKD9B,QALC,EAMDH,SANC,EAODK,WAPC,EAQDH,mBARC,EASDQ,UATC,EAUDc,kBAVC,CApBiB,CAApB,CAAA;;AAgCA,EAAA,IAAMW,UAAU,GAAG,SAAbA,UAAa,CAACC,KAAD,EAAW;AAAA,IAAA,IAAA,eAAA,EAAA,aAAA,CAAA;;AAC5BA,IAAAA,KAAK,CAACC,cAAN,EAAA,CAAA;IACA,CAAAxC,eAAAA,GAAAA,KAAK,CAACyC,QAAN,MAAAzC,IAAAA,IAAAA,eAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,eAAAA,CAAAA,IAAAA,CAAAA,KAAK,EAAYuC,KAAK,CAACG,YAAN,CAAmBC,KAA/B,CAAL,CAAA;AACA,IAAA,CAAA,aAAA,GAAA3C,KAAK,CAAC4C,MAAN,qEAAA5C,KAAK,EAAUuC,KAAV,CAAL,CAAA;IACAzB,aAAa,CAAC,KAAD,CAAb,CAAA;GAJF,CAAA;;AAMA,EAAA,IAAM+B,eAAe,GAAG,SAAlBA,eAAkB,CAACN,KAAD,EAAW;AAAA,IAAA,IAAA,kBAAA,CAAA;;AACjCA,IAAAA,KAAK,CAACC,cAAN,EAAA,CAAA;AACA,IAAA,CAAA,kBAAA,GAAAxC,KAAK,CAAC8C,WAAN,+EAAA9C,KAAK,EAAeuC,KAAf,CAAL,CAAA;IACAzB,aAAa,CAAC,IAAD,CAAb,CAAA;GAHF,CAAA;;AAKA,EAAA,IAAMiC,eAAe,GAAG,SAAlBA,eAAkB,CAACR,KAAD,EAAW;AAAA,IAAA,IAAA,kBAAA,CAAA;;AACjC,IAAA,IAAI,CAACxB,MAAM,CAACiC,OAAZ,EACE,OAAA;AACFT,IAAAA,KAAK,CAACC,cAAN,EAAA,CAAA;AACA,IAAA,CAAA,kBAAA,GAAAxC,KAAK,CAACiD,WAAN,+EAAAjD,KAAK,EAAeuC,KAAf,CAAL,CAAA;IACAzB,aAAa,CAAC,KAAD,CAAb,CAAA;GALF,CAAA;;AAOA,EAAA,IAAMoC,cAAc,GAAG,SAAjBA,cAAiB,CAACX,KAAD,EAAW;AAChCA,IAAAA,KAAK,CAACC,cAAN,EAAA,CAAA;GADF,CAAA;;AAGA,EAAA,sBAAuBxB,KAAK,CAACc,aAAN,CAAoB,KAApB,EAA2B;AAChDqB,IAAAA,GAAG,EAAEpC,MAD2C;AAEhDgB,IAAAA,SAAS,EAAEP,OAFqC;AAGhDoB,IAAAA,MAAM,EAAEN,UAHwC;AAIhDc,IAAAA,WAAW,EAAEP,eAJmC;AAKhDQ,IAAAA,UAAU,EAAEH,cALoC;AAMhDI,IAAAA,WAAW,EAAEP,eAAAA;GANQ,EAOpBd,WAPoB,CAAvB,CAAA;AAQD;;;;"}
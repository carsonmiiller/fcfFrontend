{"version":3,"file":"helper.js","sources":["../../../src/select/util/helper.ts"],"sourcesContent":["import { ReactElement } from 'react';\nimport isPlainObject from 'lodash/isPlainObject';\nimport get from 'lodash/get';\nimport OptionGroup from '../base/OptionGroup';\nimport Option from '../base/Option';\n\nimport { SelectValue, TdOptionProps, SelectKeysType } from '../type';\n\ntype SelectLabeledValue = Required<Omit<TdOptionProps, 'disabled'>>;\n\ntype ValueToOption = {\n  [value: string | number]: TdOptionProps;\n};\n\nfunction setValueToOptionFormOptionDom(dom, valueToOption: ValueToOption, keys: SelectKeysType) {\n  const { value, label, children } = dom.props;\n  if (typeof value === 'string' || typeof value === 'number') {\n    // eslint-disable-next-line no-param-reassign\n    valueToOption[value] = {\n      [keys?.value || 'value']: value,\n      [keys?.label || 'label']: label || children || value,\n    };\n  }\n}\n\n// 获取value => option，用于快速基于value找到对应的option\nexport const getValueToOption = (children, options: TdOptionProps[], keys: SelectKeysType): ValueToOption => {\n  const valueToOption = {};\n\n  // options优先级高于children\n  if (Array.isArray(options)) {\n    options.forEach((option) => {\n      valueToOption[get(option, keys?.value || 'value')] = option;\n    });\n    return valueToOption;\n  }\n\n  if (isPlainObject(children)) {\n    if (children.type === Option) {\n      setValueToOptionFormOptionDom(children, valueToOption, keys);\n      return valueToOption;\n    }\n\n    if (children.type === OptionGroup) {\n      const groupChildren = children.props.children;\n\n      if (Array.isArray(groupChildren)) {\n        groupChildren.forEach((item) => {\n          setValueToOptionFormOptionDom(item, valueToOption, keys);\n        });\n        return valueToOption;\n      }\n    }\n  }\n\n  if (Array.isArray(children)) {\n    children.forEach((item: ReactElement) => {\n      if (item.type === Option) {\n        setValueToOptionFormOptionDom(item, valueToOption, keys);\n      }\n\n      if (item.type === OptionGroup) {\n        const groupChildren = item.props.children;\n        if (Array.isArray(groupChildren)) {\n          groupChildren.forEach((groupItem) => {\n            setValueToOptionFormOptionDom(groupItem, valueToOption, keys);\n          });\n        }\n      }\n    });\n  }\n\n  return valueToOption;\n};\n\n// 获取单选的label\nexport const getLabel = (\n  children,\n  value: SelectValue<TdOptionProps>,\n  options: TdOptionProps[],\n  keys: SelectKeysType,\n) => {\n  let selectedLabel = '';\n  // 处理带 options 属性的情况\n  if (Array.isArray(options)) {\n    options.some((option) => {\n      if ([get(value, keys?.value || 'value'), value].includes(option.value)) {\n        selectedLabel = option.label;\n        return true;\n      }\n      return false;\n    });\n\n    return selectedLabel;\n  }\n\n  if (isPlainObject(children)) {\n    selectedLabel = children.props.label;\n\n    if (children.type === OptionGroup) {\n      const groupChildren = children.props.children;\n\n      if (Array.isArray(groupChildren)) {\n        groupChildren.some((item) => {\n          const selectedValue = isPlainObject(value) ? get(value, 'value') : value;\n          if (isPlainObject(item.props) && item.props.value === selectedValue) {\n            selectedLabel = item.props.label || item.props.children;\n            return true;\n          }\n          return false;\n        });\n      }\n    }\n  }\n\n  if (Array.isArray(children)) {\n    children.some((item: ReactElement) => {\n      // 处理分组\n      if (item.type === OptionGroup) {\n        const groupChildren = item.props.children;\n        if (Array.isArray(groupChildren)) {\n          const isSelected = groupChildren.some((item) => {\n            const selectedValue = isPlainObject(value) ? get(value, 'value') : value;\n            if (isPlainObject(item.props) && item.props.value === selectedValue) {\n              selectedLabel = item.props.label || item.props.children;\n              return true;\n            }\n            return false;\n          });\n          return isSelected;\n        }\n      }\n      const selectedValue = isPlainObject(value) ? get(value, 'value') : value;\n      if (isPlainObject(item.props) && item.props.value === selectedValue) {\n        selectedLabel = item.props.label || item.props.children;\n        return true;\n      }\n      return false;\n    });\n  }\n\n  return selectedLabel;\n};\n\nexport const getMultipleTags = (values: SelectValue[], keys: SelectKeysType) => {\n  const tags = values.map((item) => ({\n    label: get(item, keys?.label || 'label') || item.toString(),\n    value: get(item, keys?.value || 'value') || item,\n  }));\n  return tags;\n};\n\nexport const getSelectValueArr = (\n  values: SelectValue | SelectValue[],\n  activeValue: SelectValue,\n  selected?: boolean,\n  valueType?: 'object' | 'value',\n  keys?: SelectKeysType,\n  objVal?: SelectValue,\n) => {\n  // eslint-disable-next-line no-param-reassign\n  values = Array.isArray(values) ? values : [];\n\n  if (Array.isArray(values)) {\n    let currentValues = [...values];\n    const isValueObj = valueType === 'object';\n    if (selected) {\n      currentValues = currentValues.filter((item: SelectLabeledValue) => {\n        if (isValueObj) {\n          if (isPlainObject(activeValue)) {\n            return get(item, keys?.value || 'value') !== get(activeValue, keys?.value || 'value');\n          }\n          return get(item, keys?.value || 'value') !== activeValue;\n        }\n        return item !== activeValue;\n      });\n    } else {\n      const item = isValueObj ? objVal : activeValue;\n\n      currentValues.push(item as SelectValue);\n    }\n    return currentValues;\n  }\n};\n"],"names":["setValueToOptionFormOptionDom","dom","valueToOption","keys","props","value","label","children","getValueToOption","options","Array","isArray","forEach","option","get","isPlainObject","type","Option","OptionGroup","groupChildren","item","groupItem","getLabel","selectedLabel","some","includes","selectedValue","isSelected","item2","selectedValue2","getMultipleTags","values","tags","map","toString","getSelectValueArr","activeValue","selected","valueType","objVal","currentValues","isValueObj","filter","push"],"mappings":"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"}
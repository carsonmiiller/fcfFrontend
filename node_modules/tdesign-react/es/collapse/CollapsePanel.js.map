{"version":3,"file":"CollapsePanel.js","sources":["../../src/collapse/CollapsePanel.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport classnames from 'classnames';\nimport { CSSTransition } from 'react-transition-group';\nimport { useCollapseContext } from './CollapseContext';\nimport FakeArrow from '../common/FakeArrow';\nimport useConfig from '../_util/useConfig';\nimport { TdCollapsePanelProps } from './type';\nimport { StyledProps } from '../common';\nimport { collapsePanelDefaultProps } from './defaultProps';\n\nexport interface CollapsePanelProps extends TdCollapsePanelProps, StyledProps {\n  children?: React.ReactNode;\n  index?: number;\n}\n\nconst CollapsePanel = (props: CollapsePanelProps) => {\n  const {\n    value,\n    disabled,\n    destroyOnCollapse,\n    expandIcon,\n    className,\n    style,\n    header,\n    headerRightContent,\n    children,\n    index,\n  } = props;\n  const {\n    disabled: disableAll,\n    defaultExpandAll,\n    expandIconPlacement,\n    expandOnRowClick,\n    expandIcon: expandIconAll,\n    updateCollapseValue,\n    collapseValue,\n  } = useCollapseContext();\n\n  const { classPrefix } = useConfig();\n  const componentName = `${classPrefix}-collapse-panel`;\n  const innerValue = value || index;\n  const showExpandIcon = expandIcon === undefined ? expandIconAll : expandIcon;\n  const headRef = useRef();\n  const contentRef = useRef<HTMLDivElement>();\n  const bodyRef = useRef<HTMLDivElement>();\n  const isDisabled = disabled || disableAll;\n\n  if (defaultExpandAll) {\n    updateCollapseValue(innerValue);\n  }\n\n  const isActive = Array.isArray(collapseValue) ? collapseValue.includes(innerValue) : collapseValue === innerValue;\n\n  const classes = classnames(\n    componentName,\n    {\n      [`${classPrefix}-is-disabled`]: isDisabled,\n    },\n    className,\n  );\n\n  const handleClick = (e) => {\n    const canExpand =\n      (expandOnRowClick && e.target === headRef.current) || ['svg', 'path'].includes((e.target as Element).tagName);\n\n    if (canExpand && !isDisabled) {\n      updateCollapseValue(innerValue);\n    }\n  };\n\n  const renderIcon = (direction: string) => (\n    <FakeArrow\n      isActive={isActive}\n      overlayClassName={classnames(`${componentName}__icon`, `${componentName}__icon--${direction}`)}\n    />\n  );\n\n  const renderHeader = () => {\n    const cls = [\n      `${componentName}__header`,\n      {\n        [`${classPrefix}-is-clickable`]: expandOnRowClick && !isDisabled,\n      },\n    ];\n    return (\n      <div ref={headRef} className={classnames(cls)} onClick={handleClick}>\n        {showExpandIcon && expandIconPlacement === 'left' ? renderIcon(expandIconPlacement) : null}\n        {header && header}\n        <div className={`${componentName}__header--blank`}></div>\n        {headerRightContent && headerRightContent}\n        {showExpandIcon && expandIconPlacement === 'right' ? renderIcon(expandIconPlacement) : null}\n      </div>\n    );\n  };\n\n  const renderBody = () => {\n    const transitionCallbacks = {\n      onEnter: () => {\n        bodyRef.current.style.height = `${contentRef?.current.clientHeight}px`;\n      },\n      onEntered: () => {\n        bodyRef.current.style.height = 'auto';\n      },\n      onExit: () => {\n        bodyRef.current.style.height = `${contentRef?.current.clientHeight}px`;\n      },\n      onExiting: () => {\n        bodyRef.current.style.height = '0px';\n      },\n    };\n    return (\n      <CSSTransition\n        in={isActive}\n        appear\n        timeout={300}\n        nodeRef={bodyRef}\n        unmountOnExit={destroyOnCollapse}\n        {...transitionCallbacks}\n      >\n        <div\n          style={{ height: 0 }}\n          className={classnames(`${componentName}__body`, `${classPrefix}-slide-down-enter-active`, {\n            [`${componentName}__body--collapsed`]: !isActive,\n          })}\n          ref={bodyRef}\n        >\n          <div className={`${componentName}__content`} ref={contentRef}>\n            {children}\n          </div>\n        </div>\n      </CSSTransition>\n    );\n  };\n\n  return (\n    <div className={classes} style={{ ...style }}>\n      <div className={`${componentName}__wrapper`}>\n        {renderHeader()}\n        {renderBody()}\n      </div>\n    </div>\n  );\n};\n\nCollapsePanel.displayName = 'CollapsePanel';\nCollapsePanel.defaultProps = collapsePanelDefaultProps;\n\nexport default CollapsePanel;\n"],"names":["CollapsePanel","props","value","disabled","destroyOnCollapse","expandIcon","className","style","header","headerRightContent","children","index","useCollapseContext","disableAll","defaultExpandAll","expandIconPlacement","expandOnRowClick","expandIconAll","updateCollapseValue","collapseValue","useConfig","classPrefix","componentName","innerValue","showExpandIcon","headRef","useRef","contentRef","bodyRef","isDisabled","isActive","Array","isArray","includes","classes","classnames","handleClick","e","canExpand","target","current","tagName","renderIcon","direction","React","createElement","FakeArrow","overlayClassName","renderHeader","cls","ref","onClick","renderBody","transitionCallbacks","onEnter","height","clientHeight","onEntered","onExit","onExiting","CSSTransition","appear","timeout","nodeRef","unmountOnExit","displayName","defaultProps","collapsePanelDefaultProps"],"mappings":"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"}
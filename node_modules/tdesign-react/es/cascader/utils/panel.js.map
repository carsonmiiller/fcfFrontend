{"version":3,"file":"panel.js","sources":["../../../src/cascader/utils/panel.ts"],"sourcesContent":["import isNumber from 'lodash/isNumber';\nimport { TreeNode, CascaderContextType, CascaderProps, TreeNodeValue } from '../interface';\n\n/**\n * 面板数据计算方法\n * @param treeNodes\n * @returns\n */\nexport function getPanels(treeNodes: CascaderContextType['treeNodes']) {\n  const panels: TreeNode[][] = [];\n  treeNodes.forEach((node: TreeNode) => {\n    if (panels[node.level]) {\n      panels[node.level].push(node);\n    } else {\n      panels[node.level] = [node];\n    }\n  });\n  return panels;\n}\n\n/**\n * 点击item的副作用\n * @param propsTrigger\n * @param trigger\n * @param node\n * @param cascaderContext\n * @param onChange\n * @param ctx\n */\nexport function expendClickEffect(\n  propsTrigger: CascaderProps['trigger'],\n  trigger: CascaderProps['trigger'],\n  node: TreeNode,\n  cascaderContext: CascaderContextType,\n) {\n  const {\n    checkStrictly,\n    filterActive,\n    multiple,\n    treeStore,\n    setFilterActive,\n    setVisible,\n    setValue,\n    setTreeNodes,\n    setExpend,\n    value,\n    max,\n  } = cascaderContext;\n\n  const isDisabled = node.disabled || (multiple && value && (value as TreeNodeValue[]).length >= max && max !== 0);\n\n  if (isDisabled) return;\n  // 点击展开节点，设置展开状态\n  if (propsTrigger === trigger && !node.isLeaf()) {\n    const expanded = node.setExpanded(true);\n    treeStore.refreshNodes();\n    treeStore.replaceExpanded(expanded);\n    const nodes = treeStore.getNodes().filter((node: TreeNode) => node.visible);\n    setTreeNodes(nodes);\n\n    // 多选条件下\b手动维护expend\n    if (multiple) {\n      setExpend(expanded);\n    }\n  }\n\n  if (!multiple && (node.isLeaf() || checkStrictly) && trigger === 'click') {\n    treeStore.resetChecked();\n    const checked = node.setChecked(!node.isChecked());\n    const [value] = checked;\n\n    // 过滤状态下，点击后清除过滤状态\n    if (filterActive) {\n      setFilterActive(false);\n    }\n\n    // 非过滤状态下，关闭\n    if (!filterActive && !checkStrictly) {\n      setVisible(false);\n    }\n\n    // 非受控状态下更新状态\n    setValue(value, 'check', node.getModel());\n  }\n}\n\n/**\n * 多选状态下选中状态数据变化的副作用\n * @param node\n * @param cascaderContext\n * @returns\n */\nexport function valueChangeEffect(node: TreeNode, cascaderContext: CascaderContextType) {\n  const { disabled, max, multiple, setVisible, setValue, filterActive, setFilterActive, treeNodes, treeStore } =\n    cascaderContext;\n\n  if (!node || disabled || node.disabled) {\n    return;\n  }\n  const checked = node.setChecked(!node.isChecked());\n\n  if (isNumber(max) && max < 0) {\n    console.warn('TDesign Warn:', 'max should > 0');\n  }\n\n  if (checked.length > max && isNumber(max) && max > 0) {\n    return;\n  }\n\n  if (checked.length === 0) {\n    const expanded = treeStore.getExpanded();\n    setTimeout(() => {\n      treeStore.replaceExpanded(expanded);\n      treeStore.refreshNodes();\n    }, 0);\n  }\n\n  if (!multiple) {\n    setVisible(false);\n  }\n\n  const isSelectAll = treeNodes.every((item) => checked.indexOf(item.value) > -1);\n\n  if (filterActive && isSelectAll) {\n    setVisible(false);\n    setFilterActive(false);\n  }\n\n  setValue(checked, 'check', node.getModel());\n}\n"],"names":["getPanels","treeNodes","panels","forEach","node","level","push","expendClickEffect","propsTrigger","trigger","cascaderContext","checkStrictly","filterActive","multiple","treeStore","setFilterActive","setVisible","setValue","setTreeNodes","setExpend","value","max","isDisabled","disabled","length","isLeaf","expanded","setExpanded","refreshNodes","replaceExpanded","nodes","getNodes","filter","node2","visible","resetChecked","checked","setChecked","isChecked","value2","getModel","valueChangeEffect","isNumber","console","warn","getExpanded","setTimeout","isSelectAll","every","item","indexOf"],"mappings":"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"}
{"version":3,"file":"useControlled.js","sources":["../../src/hooks/useControlled.ts"],"sourcesContent":["import { useState } from 'react';\nimport upperFirst from 'lodash/upperFirst';\nimport noop from '../_util/noop';\n\nexport interface ChangeHandler<T, P extends any[]> {\n  (value: T, ...args: P);\n}\n\nexport default function useControlled<T, P extends any[]>(\n  props: object = {},\n  valueKey: string,\n  onChange: ChangeHandler<T, P>,\n): [T, ChangeHandler<T, P>] {\n  // 外部设置 props，说明希望受控\n  const controlled = Reflect.has(props, valueKey);\n  // 受控属性\n  const value = props[valueKey];\n  // 约定受控属性的非受控 key 为 defaultXxx\n  const defaultValue = props[`default${upperFirst(valueKey)}`];\n\n  // 无论是否受控，都要维护一个内部变量，默认值由 defaultValue 控制\n  const [internalValue, setInternalValue] = useState(defaultValue);\n\n  // 受控模式\n  if (controlled) return [value, onChange || noop];\n\n  // 非受控模式\n  return [\n    internalValue,\n    (newValue, ...args) => {\n      setInternalValue(newValue);\n      onChange?.(newValue, ...args);\n    },\n  ];\n}\n"],"names":["useControlled","props","valueKey","onChange","controlled","Reflect","has","value","defaultValue","upperFirst","useState","internalValue","setInternalValue","noop","newValue","args"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAGe,SAASA,aAAT,GAAuD;EAAA,IAAhCC,KAAgC,uEAAxB,EAAwB,CAAA;AAAA,EAAA,IAApBC,QAAoB,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA,CAAA;AAAA,EAAA,IAAVC,QAAU,GAAA,SAAA,CAAA,MAAA,GAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAA,SAAA,CAAA;EACpE,IAAMC,UAAU,GAAGC,OAAO,CAACC,GAAR,CAAYL,KAAZ,EAAmBC,QAAnB,CAAnB,CAAA;AACA,EAAA,IAAMK,KAAK,GAAGN,KAAK,CAACC,QAAD,CAAnB,CAAA;EACA,IAAMM,YAAY,GAAGP,KAAK,CAAA,SAAA,CAAA,MAAA,CAAWQ,YAAU,CAACP,QAAD,CAArB,CAA1B,CAAA,CAAA;;EACA,IAA0CQ,SAAAA,GAAAA,QAAQ,CAACF,YAAD,CAAlD;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOG,aAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAsBC,gBAAtB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAIR,UAAJ,EACE,OAAO,CAACG,KAAD,EAAQJ,QAAQ,IAAIU,IAApB,CAAP,CAAA;AACF,EAAA,OAAO,CACLF,aADK,EAEL,UAACG,QAAD,EAAuB;IACrBF,gBAAgB,CAACE,QAAD,CAAhB,CAAA;;AADqB,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAATC,IAAS,GAAA,IAAA,KAAA,CAAA,IAAA,GAAA,CAAA,GAAA,IAAA,GAAA,CAAA,GAAA,CAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;MAATA,IAAS,CAAA,IAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAAA,KAAA;;IAErBZ,QAAQ,KAAA,IAAR,IAAAA,QAAQ,KAAR,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,QAAQ,CAAR,KAAA,CAAA,KAAA,CAAA,EAAA,CAAWW,QAAX,CAAA,CAAA,MAAA,CAAwBC,IAAxB,CAAA,CAAA,CAAA;AACD,GALI,CAAP,CAAA;AAOD;;;;"}
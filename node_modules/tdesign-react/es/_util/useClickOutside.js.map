{"version":3,"file":"useClickOutside.js","sources":["../../src/_util/useClickOutside.ts"],"sourcesContent":["import { MutableRefObject, useEffect } from 'react';\nimport useConfig from './useConfig';\n\nexport default function useClickOutside<T extends HTMLElement>(\n  refs: MutableRefObject<T>[],\n  handler: (event: MouseEvent | TouchEvent) => void,\n  includePopup?: boolean,\n) {\n  const { classPrefix } = useConfig();\n  const POPUP_SELECTOR = `.${classPrefix}-popup`;\n\n  useEffect(() => {\n    const listener = (event) => {\n      if (!Array.isArray(refs)) {\n        return;\n      }\n\n      let elements = [];\n      if (includePopup) {\n        document.querySelectorAll(POPUP_SELECTOR).forEach((ele: Element) => {\n          elements.push(ele as HTMLElement);\n        });\n      }\n      elements = Array.from(new Set(elements));\n\n      // Do nothing if clicking ref's element or descendent elements\n      if (\n        refs.find((ref) => ref.current?.contains(event.target)) ||\n        elements.find((el) => el?.contains(event.target))\n      ) {\n        return;\n      }\n      handler(event);\n    };\n    // todo: pointerdown， jsdom 暂未实现 pointer 事件，后续加上后可以改进.\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n    return () => {\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [refs, handler, includePopup]);\n}\n"],"names":["useClickOutside","refs","handler","includePopup","useConfig","classPrefix","POPUP_SELECTOR","useEffect","listener","event","Array","isArray","elements","document","querySelectorAll","forEach","ele","push","from","Set","find","ref","current","contains","target","el","addEventListener","removeEventListener"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEe,SAASA,eAAT,CAAyBC,IAAzB,EAA+BC,OAA/B,EAAwCC,YAAxC,EAAsD;AACnE,EAAA,IAAA,UAAA,GAAwBC,SAAS,EAAjC;MAAQC,WAAR,cAAQA,WAAR,CAAA;;EACA,IAAMC,cAAc,GAAOD,GAAAA,CAAAA,MAAAA,CAAAA,WAAP,EAApB,QAAA,CAAA,CAAA;AACAE,EAAAA,SAAS,CAAC,YAAM;AACd,IAAA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,KAAD,EAAW;AAC1B,MAAA,IAAI,CAACC,KAAK,CAACC,OAAN,CAAcV,IAAd,CAAL,EAA0B;AACxB,QAAA,OAAA;AACD,OAAA;;MACD,IAAIW,QAAQ,GAAG,EAAf,CAAA;;AACA,MAAA,IAAIT,YAAJ,EAAkB;QAChBU,QAAQ,CAACC,gBAAT,CAA0BR,cAA1B,EAA0CS,OAA1C,CAAkD,UAACC,GAAD,EAAS;UACzDJ,QAAQ,CAACK,IAAT,CAAcD,GAAd,CAAA,CAAA;SADF,CAAA,CAAA;AAGD,OAAA;;MACDJ,QAAQ,GAAGF,KAAK,CAACQ,IAAN,CAAW,IAAIC,GAAJ,CAAQP,QAAR,CAAX,CAAX,CAAA;;AACA,MAAA,IAAIX,IAAI,CAACmB,IAAL,CAAU,UAACC,GAAD,EAAA;AAAA,QAAA,IAAA,YAAA,CAAA;;QAAA,OAASA,CAAAA,YAAAA,GAAAA,GAAG,CAACC,OAAb,MAAS,IAAA,IAAA,YAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,YAAA,CAAaC,QAAb,CAAsBd,KAAK,CAACe,MAA5B,CAAT,CAAA;AAAA,OAAV,KAA2DZ,QAAQ,CAACQ,IAAT,CAAc,UAACK,EAAD,EAAA;QAAA,OAAQA,EAAR,KAAQA,IAAAA,IAAAA,EAAR,KAAQA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,EAAE,CAAEF,QAAJ,CAAad,KAAK,CAACe,MAAnB,CAAR,CAAA;AAAA,OAAd,CAA/D,EAAkH;AAChH,QAAA,OAAA;AACD,OAAA;;MACDtB,OAAO,CAACO,KAAD,CAAP,CAAA;KAdF,CAAA;;AAgBAI,IAAAA,QAAQ,CAACa,gBAAT,CAA0B,WAA1B,EAAuClB,QAAvC,CAAA,CAAA;AACAK,IAAAA,QAAQ,CAACa,gBAAT,CAA0B,YAA1B,EAAwClB,QAAxC,CAAA,CAAA;AACA,IAAA,OAAO,YAAM;AACXK,MAAAA,QAAQ,CAACc,mBAAT,CAA6B,WAA7B,EAA0CnB,QAA1C,CAAA,CAAA;AACAK,MAAAA,QAAQ,CAACc,mBAAT,CAA6B,YAA7B,EAA2CnB,QAA3C,CAAA,CAAA;KAFF,CAAA;GAnBO,EAuBN,CAACP,IAAD,EAAOC,OAAP,EAAgBC,YAAhB,CAvBM,CAAT,CAAA;AAwBD;;;;"}
{"version":3,"file":"Tooltip.js","sources":["../../src/tooltip/Tooltip.tsx"],"sourcesContent":["import React, { forwardRef, useState, useEffect, useRef, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport Popup, { PopupVisibleChangeContext } from '../popup';\nimport useConfig from '../_util/useConfig';\nimport { TdTooltipProps } from './type';\nimport { tooltipDefaultProps } from './defaultProps';\n\nexport type TooltipProps = TdTooltipProps;\n\ninterface RefProps {\n  setVisible?: (v: boolean) => void;\n}\n\nconst Tooltip = forwardRef((props: TdTooltipProps, ref) => {\n  const {\n    theme,\n    showArrow = true,\n    destroyOnClose = true,\n    overlayClassName,\n    children,\n    duration = 0,\n    placement = 'top',\n    ...restProps\n  } = props;\n  const { classPrefix } = useConfig();\n  const [isTipShowed, setTipshow] = useState(duration !== 0);\n  const [timeup, setTimeup] = useState(false);\n  const popupRef = useRef<HTMLDivElement>();\n  const timerRef = useRef<number | null>(null);\n  const [offset, setOffset] = useState([0, 0]);\n  const toolTipClass = classNames(\n    `${classPrefix}-tooltip`,\n    {\n      [`${classPrefix}-tooltip--${theme}`]: theme,\n    },\n    overlayClassName,\n  );\n  const isPlacedByMouse = placement === 'mouse';\n\n  const setVisible = (v: boolean) => {\n    if (duration !== 0) setTimeup(false);\n    setTipshow(v);\n  };\n\n  const calculatePos = (e) => {\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    return {\n      x,\n      y,\n    };\n  };\n\n  const handleShowTip = (visible: boolean, { e, trigger }: PopupVisibleChangeContext) => {\n    if (duration === 0 || (duration !== 0 && timeup)) {\n      if (\n        visible &&\n        placement === 'mouse' &&\n        (trigger === 'trigger-element-hover' || trigger === 'trigger-element-click')\n      ) {\n        const { x } = calculatePos(e);\n        setOffset([x, 0]);\n      }\n      setTipshow(visible);\n    }\n  };\n\n  useEffect(() => {\n    if (duration !== 0 && !timeup) {\n      timerRef.current = window.setTimeout(() => {\n        setTipshow(false);\n        setTimeup(true);\n      }, duration);\n    }\n    return () => {\n      if (timerRef.current) window.clearTimeout(timerRef.current);\n    };\n  }, [duration, timeup]);\n\n  useImperativeHandle(\n    ref,\n    (): RefProps => ({\n      setVisible,\n    }),\n  );\n\n  return (\n    <Popup\n      ref={popupRef}\n      destroyOnClose={destroyOnClose}\n      showArrow={isPlacedByMouse ? false : showArrow}\n      overlayClassName={toolTipClass}\n      visible={isTipShowed}\n      onVisibleChange={handleShowTip}\n      popperModifiers={isPlacedByMouse ? [{ name: 'offset', options: { offset } }] : []}\n      placement={isPlacedByMouse ? 'bottom-left' : placement}\n      {...restProps}\n    >\n      {children}\n    </Popup>\n  );\n});\n\nTooltip.displayName = 'Tooltip';\nTooltip.defaultProps = tooltipDefaultProps;\n\nexport default Tooltip;\n"],"names":["Tooltip","forwardRef","props","ref","theme","showArrow","destroyOnClose","overlayClassName","children","duration","placement","restProps","useConfig","classPrefix","useState","isTipShowed","setTipshow","timeup","setTimeup","popupRef","useRef","timerRef","offset","setOffset","toolTipClass","classNames","isPlacedByMouse","setVisible","v","calculatePos","e","rect","target","getBoundingClientRect","x","clientX","left","y","clientY","top","handleShowTip","visible","trigger","useEffect","current","window","setTimeout","clearTimeout","useImperativeHandle","React","createElement","Popup","onVisibleChange","popperModifiers","name","options","displayName","defaultProps","tooltipDefaultProps"],"mappings":"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"}
{"version":3,"file":"usePagination.js","sources":["../../../src/table/hooks/usePagination.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport useConfig from '../../_util/useConfig';\nimport Pagination, { PageInfo } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps) {\n  const { pagination, data, disableDataPage } = props;\n  const { classPrefix } = useConfig();\n\n  const [dataSource, setDataSource] = useState<TableRowData[]>([]);\n  const [isPaginateData, setIsPaginateData] = useState(false);\n\n  const updateDataSourceAndPaginate = useCallback(\n    (current = 1, pageSize = 10) => {\n      // data 数据数量超出分页大小时，则自动启动本地数据分页\n      const isPaginateData = Boolean(!disableDataPage && data.length > pageSize);\n      setIsPaginateData(isPaginateData);\n      if (isPaginateData) {\n        const start = (current - 1) * pageSize;\n        const end = current * pageSize;\n        setDataSource([...data.slice(start, end)]);\n      } else {\n        setDataSource(data);\n      }\n    },\n    [data, disableDataPage],\n  );\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  useEffect(() => {\n    if (!pagination || !pagination.current) return;\n    updateDataSourceAndPaginate(pagination.current, pagination.pageSize);\n  }, [pagination, updateDataSourceAndPaginate]);\n\n  // 非受控情况\n  useEffect(() => {\n    if (!pagination || !pagination.defaultCurrent) return;\n    updateDataSourceAndPaginate(pagination.defaultCurrent, pagination.defaultPageSize);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [updateDataSourceAndPaginate]);\n\n  const renderPagination = () => {\n    if (!pagination) return null;\n    return (\n      <div className={`${classPrefix}-table__pagination`}>\n        <Pagination\n          {...pagination}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            props.onPageChange?.(pageInfo, dataSource);\n            // 如果是非受控情况的分页变化，还需更新分页数据（data）\n            if (pagination && !pagination.current && pagination.defaultCurrent) {\n              updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            }\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","pagination","data","disableDataPage","useConfig","classPrefix","useState","dataSource","setDataSource","isPaginateData","setIsPaginateData","updateDataSourceAndPaginate","useCallback","current","pageSize","isPaginateData2","Boolean","length","start","end","slice","useEffect","defaultCurrent","defaultPageSize","renderPagination","React","createElement","className","Pagination","onChange","pageInfo","onPageChange"],"mappings":"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"}
{"version":3,"file":"useLazyLoad.js","sources":["../../../src/table/hooks/useLazyLoad.ts"],"sourcesContent":["// import { ref, onMounted, computed, nextTick, Ref, UnwrapRef } from 'vue';\nimport { useState, useMemo, useEffect } from 'react';\nimport observe from '../../_common/js/utils/observe';\n\nexport type UseLazyLoadParams = {\n  type: 'lazy' | 'virtual';\n  rowIndex: number;\n  rowHeight?: number;\n  bufferSize?: number;\n};\n\nexport default function useLazyLoad(\n  containerRef: HTMLElement,\n  childRef: HTMLTableRowElement,\n  params: UseLazyLoadParams,\n) {\n  // useMemo 用意：1. 为了实时响应数据；2. 表格的计算量容易过大，提前存储\n  const tRowHeight = useMemo(() => Math.max(params.rowHeight || 48, 48), [params.rowHeight]);\n  const [isInit, setIsInit] = useState(params.rowIndex === 0);\n  const hasLazyLoadHolder = useMemo(() => params?.type === 'lazy' && !isInit, [isInit, params?.type]);\n\n  const requestAnimationFrame =\n    (typeof window === 'undefined' ? false : window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\n  const init = () => {\n    if (!isInit) {\n      requestAnimationFrame(() => {\n        setIsInit(true);\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (params?.type !== 'lazy') return;\n    const timer = setTimeout(() => {\n      const bufferSize = Math.max(10, params.bufferSize || 10);\n      const height = tRowHeight * bufferSize;\n      childRef && observe(childRef, containerRef, init, height);\n      clearTimeout(timer);\n    });\n    return () => {\n      clearTimeout(timer);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [childRef, containerRef, params.bufferSize, params?.type, tRowHeight]);\n\n  return {\n    hasLazyLoadHolder,\n    tRowHeight,\n  };\n}\n"],"names":["useLazyLoad","containerRef","childRef","params","tRowHeight","useMemo","Math","max","rowHeight","useState","rowIndex","isInit","setIsInit","hasLazyLoadHolder","type","requestAnimationFrame","window","cb","setTimeout","init","useEffect","timer","bufferSize","height","observe","clearTimeout"],"mappings":";;;;;;;;;;;AAEe,SAASA,WAAT,CAAqBC,YAArB,EAAmCC,QAAnC,EAA6CC,MAA7C,EAAqD;EAClE,IAAMC,UAAU,GAAGC,OAAO,CAAC,YAAA;IAAA,OAAMC,IAAI,CAACC,GAAL,CAASJ,MAAM,CAACK,SAAP,IAAoB,EAA7B,EAAiC,EAAjC,CAAN,CAAA;AAAA,GAAD,EAA6C,CAACL,MAAM,CAACK,SAAR,CAA7C,CAA1B,CAAA;;AACA,EAAA,IAAA,SAAA,GAA4BC,QAAQ,CAACN,MAAM,CAACO,QAAP,KAAoB,CAArB,CAApC;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,MAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAeC,SAAf,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAMC,iBAAiB,GAAGR,OAAO,CAAC,YAAA;AAAA,IAAA,OAAM,CAAAF,MAAM,KAAN,IAAA,IAAAA,MAAM,KAAN,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,MAAM,CAAEW,IAAR,MAAiB,MAAjB,IAA2B,CAACH,MAAlC,CAAA;AAAA,GAAD,EAA2C,CAACA,MAAD,EAASR,MAAT,KAAA,IAAA,IAASA,MAAT,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAASA,MAAM,CAAEW,IAAjB,CAA3C,CAAjC,CAAA;;AACA,EAAA,IAAMC,qBAAqB,GAAG,CAAC,OAAOC,MAAP,KAAkB,WAAlB,GAAgC,KAAhC,GAAwCA,MAAM,CAACD,qBAAhD,KAA2E,UAACE,EAAD,EAAA;AAAA,IAAA,OAAQC,UAAU,CAACD,EAAD,EAAK,IAAL,CAAlB,CAAA;GAAzG,CAAA;;AACA,EAAA,IAAME,IAAI,GAAG,SAAPA,IAAO,GAAM;IACjB,IAAI,CAACR,MAAL,EAAa;AACXI,MAAAA,qBAAqB,CAAC,YAAM;QAC1BH,SAAS,CAAC,IAAD,CAAT,CAAA;AACD,OAFoB,CAArB,CAAA;AAGD,KAAA;GALH,CAAA;;AAOAQ,EAAAA,SAAS,CAAC,YAAM;AACd,IAAA,IAAI,CAAAjB,MAAM,KAAN,IAAA,IAAAA,MAAM,KAAA,KAAA,CAAN,GAAAA,KAAAA,CAAAA,GAAAA,MAAM,CAAEW,IAAR,MAAiB,MAArB,EACE,OAAA;AACF,IAAA,IAAMO,KAAK,GAAGH,UAAU,CAAC,YAAM;AAC7B,MAAA,IAAMI,UAAU,GAAGhB,IAAI,CAACC,GAAL,CAAS,EAAT,EAAaJ,MAAM,CAACmB,UAAP,IAAqB,EAAlC,CAAnB,CAAA;AACA,MAAA,IAAMC,MAAM,GAAGnB,UAAU,GAAGkB,UAA5B,CAAA;MACApB,QAAQ,IAAIsB,OAAO,CAACtB,QAAD,EAAWD,YAAX,EAAyBkB,IAAzB,EAA+BI,MAA/B,CAAnB,CAAA;MACAE,YAAY,CAACJ,KAAD,CAAZ,CAAA;AACD,KALuB,CAAxB,CAAA;AAMA,IAAA,OAAO,YAAM;MACXI,YAAY,CAACJ,KAAD,CAAZ,CAAA;KADF,CAAA;GATO,EAYN,CAACnB,QAAD,EAAWD,YAAX,EAAyBE,MAAM,CAACmB,UAAhC,EAA4CnB,MAA5C,KAA4CA,IAAAA,IAAAA,MAA5C,uBAA4CA,MAAM,CAAEW,IAApD,EAA0DV,UAA1D,CAZM,CAAT,CAAA;EAaA,OAAO;AACLS,IAAAA,iBAAiB,EAAjBA,iBADK;AAELT,IAAAA,UAAU,EAAVA,UAAAA;GAFF,CAAA;AAID;;;;"}
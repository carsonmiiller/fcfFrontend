{"version":3,"file":"THead.js","sources":["../../src/table/THead.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport isFunction from 'lodash/isFunction';\nimport classNames from 'classnames';\nimport { RowAndColFixedPosition, getColumnFixedStyles } from './hooks/useFixed';\nimport { TableColumns, ThRowspanAndColspan } from './hooks/useMultiHeader';\nimport useClassName from './hooks/useClassName';\nimport useConfig from '../_util/useConfig';\nimport { BaseTableCol, TableRowData } from './type';\nimport { renderTitle } from './hooks/useTableHeader';\nimport TEllipsis from './Ellipsis';\n\nexport interface TheadProps {\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  // 虚拟滚动单独渲染表头；表头吸顶单独渲染表头\n  thWidthList?: { [colKey: string]: number };\n  bordered: boolean;\n  isMultipleHeader: boolean;\n  spansAndLeafNodes: {\n    rowspanAndColspanMap: ThRowspanAndColspan;\n    leafColumns: BaseTableCol<TableRowData>[];\n  };\n  thList: BaseTableCol<TableRowData>[][];\n}\n\nexport default function THead(props: TheadProps) {\n  const theadRef = useRef<HTMLTableSectionElement>(null);\n  const classnames = useClassName();\n  const { tableHeaderClasses, tableBaseClass } = classnames;\n  const { classPrefix } = useConfig();\n  const theadClasses = [\n    tableHeaderClasses.header,\n    {\n      [tableHeaderClasses.fixed]: props.isFixedHeader,\n      [tableBaseClass.bordered]: props.bordered && props.isMultipleHeader,\n      [tableHeaderClasses.multipleHeader]: props.isMultipleHeader,\n    },\n  ];\n\n  const renderThNodeList = (rowAndColFixedPosition: RowAndColFixedPosition, thWidthList: TheadProps['thWidthList']) => {\n    // thBorderMap: rowspan 会影响 tr > th 是否为第一列表头，从而影响边框\n    const thBorderMap = new Map<any, boolean>();\n    const thRowspanAndColspan = props.spansAndLeafNodes.rowspanAndColspanMap;\n    return props.thList.map((row, rowIndex) => {\n      const thRow = row.map((col: TableColumns[0], index: number) => {\n        const rowspanAndColspan = thRowspanAndColspan.get(col);\n        if (index === 0 && rowspanAndColspan.rowspan > 1) {\n          for (let j = rowIndex + 1; j < rowIndex + rowspanAndColspan.rowspan; j++) {\n            thBorderMap.set(props.thList[j][0], true);\n          }\n        }\n        const thStyles = getColumnFixedStyles(col, index, rowAndColFixedPosition, classnames.tableColFixedClasses);\n        const colParams = {\n          col,\n          colIndex: index,\n          row: {},\n          rowIndex: -1,\n        };\n        const customClasses = isFunction(col.className) ? col.className({ ...colParams, type: 'th' }) : col.className;\n        const thClasses = [\n          thStyles.classes,\n          customClasses,\n          {\n            // 受 rowspan 影响，部分 tr > th:first-child 需要补足左边框\n            [tableHeaderClasses.thBordered]: thBorderMap.get(col),\n            [`${classPrefix}-table__th-${col.colKey}`]: col.colKey,\n            [classnames.tdAlignClasses[col.align]]: col.align && col.align !== 'left',\n          },\n        ];\n        const withoutChildren = !col.children?.length;\n        const width = withoutChildren && thWidthList?.[col.colKey] ? `${thWidthList?.[col.colKey]}px` : undefined;\n        const styles = { ...(thStyles.style || {}), width };\n        const innerTh = renderTitle(col, index);\n        if (!col.colKey) return null;\n        const content = isFunction(col.ellipsisTitle) ? col.ellipsisTitle({ col, colIndex: index }) : undefined;\n        return (\n          <th\n            key={col.colKey}\n            data-colkey={col.colKey}\n            className={classNames(thClasses)}\n            style={styles}\n            {...{ rowSpan: rowspanAndColspan.rowspan, colSpan: rowspanAndColspan.colspan }}\n          >\n            <div className={tableBaseClass.thCellInner}>\n              {col.ellipsis && col.ellipsisTitle !== false && col.ellipsisTitle !== null ? (\n                <TEllipsis\n                  placement=\"bottom\"\n                  attach={theadRef.current ? () => theadRef.current.parentNode.parentNode as HTMLElement : undefined}\n                  popupContent={content}\n                  popupProps={typeof col.ellipsisTitle === 'object' ? col.ellipsisTitle : undefined}\n                >\n                  {innerTh}\n                </TEllipsis>\n              ) : (\n                innerTh\n              )}\n            </div>\n          </th>\n        );\n      });\n      return <tr key={rowIndex}>{thRow}</tr>;\n    });\n  };\n\n  return (\n    <thead ref={theadRef} className={classNames(theadClasses)}>\n      {renderThNodeList(props.rowAndColFixedPosition, props.thWidthList)}\n    </thead>\n  );\n}\n"],"names":["THead","props","theadRef","useRef","classnames","useClassName","tableHeaderClasses","tableBaseClass","useConfig","classPrefix","theadClasses","header","fixed","isFixedHeader","bordered","isMultipleHeader","multipleHeader","renderThNodeList","rowAndColFixedPosition","thWidthList","thBorderMap","Map","thRowspanAndColspan","spansAndLeafNodes","rowspanAndColspanMap","thList","map","row","rowIndex","thRow","col","index","rowspanAndColspan","get","rowspan","j","set","thStyles","getColumnFixedStyles","tableColFixedClasses","colParams","colIndex","customClasses","isFunction","className","type","thClasses","classes","thBordered","colKey","tdAlignClasses","align","withoutChildren","children","length","width","styles","style","innerTh","renderTitle","content","ellipsisTitle","React","createElement","key","classNames","rowSpan","colSpan","colspan","thCellInner","ellipsis","TEllipsis","placement","attach","current","parentNode","popupContent","popupProps","ref"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQe,SAASA,KAAT,CAAeC,KAAf,EAAsB;AAAA,EAAA,IAAA,IAAA,CAAA;;AACnC,EAAA,IAAMC,QAAQ,GAAGC,MAAM,CAAC,IAAD,CAAvB,CAAA;EACA,IAAMC,UAAU,GAAGC,YAAY,EAA/B,CAAA;AACA,EAAA,IAAQC,kBAAR,GAA+CF,UAA/C,CAAQE,kBAAR;AAAA,MAA4BC,cAA5B,GAA+CH,UAA/C,CAA4BG,cAA5B,CAAA;;AACA,EAAA,IAAA,UAAA,GAAwBC,SAAS,EAAjC;MAAQC,WAAR,cAAQA,WAAR,CAAA;;AACA,EAAA,IAAMC,YAAY,GAAG,CACnBJ,kBAAkB,CAACK,MADA,GAAA,IAAA,GAAA,EAAA,EAAA,eAAA,CAAA,IAAA,EAGhBL,kBAAkB,CAACM,KAHH,EAGWX,KAAK,CAACY,aAHjB,yBAIhBN,cAAc,CAACO,QAJC,EAIUb,KAAK,CAACa,QAAN,IAAkBb,KAAK,CAACc,gBAJlC,CAKhBT,EAAAA,eAAAA,CAAAA,IAAAA,EAAAA,kBAAkB,CAACU,cALH,EAKoBf,KAAK,CAACc,gBAL1B,CAArB,EAAA,IAAA,EAAA,CAAA;;EAQA,IAAME,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,sBAAD,EAAyBC,WAAzB,EAAyC;AAChE,IAAA,IAAMC,WAAW,kBAAmB,IAAIC,GAAJ,EAApC,CAAA;AACA,IAAA,IAAMC,mBAAmB,GAAGrB,KAAK,CAACsB,iBAAN,CAAwBC,oBAApD,CAAA;IACA,OAAOvB,KAAK,CAACwB,MAAN,CAAaC,GAAb,CAAiB,UAACC,GAAD,EAAMC,QAAN,EAAmB;MACzC,IAAMC,KAAK,GAAGF,GAAG,CAACD,GAAJ,CAAQ,UAACI,GAAD,EAAMC,KAAN,EAAgB;AAAA,QAAA,IAAA,KAAA,EAAA,aAAA,CAAA;;AACpC,QAAA,IAAMC,iBAAiB,GAAGV,mBAAmB,CAACW,GAApB,CAAwBH,GAAxB,CAA1B,CAAA;;QACA,IAAIC,KAAK,KAAK,CAAV,IAAeC,iBAAiB,CAACE,OAAlB,GAA4B,CAA/C,EAAkD;AAChD,UAAA,KAAK,IAAIC,CAAC,GAAGP,QAAQ,GAAG,CAAxB,EAA2BO,CAAC,GAAGP,QAAQ,GAAGI,iBAAiB,CAACE,OAA5D,EAAqEC,CAAC,EAAtE,EAA0E;AACxEf,YAAAA,WAAW,CAACgB,GAAZ,CAAgBnC,KAAK,CAACwB,MAAN,CAAaU,CAAb,CAAgB,CAAA,CAAhB,CAAhB,EAAoC,IAApC,CAAA,CAAA;AACD,WAAA;AACF,SAAA;;AACD,QAAA,IAAME,QAAQ,GAAGC,oBAAoB,CAACR,GAAD,EAAMC,KAAN,EAAab,sBAAb,EAAqCd,UAAU,CAACmC,oBAAhD,CAArC,CAAA;AACA,QAAA,IAAMC,SAAS,GAAG;AAChBV,UAAAA,GAAG,EAAHA,GADgB;AAEhBW,UAAAA,QAAQ,EAAEV,KAFM;AAGhBJ,UAAAA,GAAG,EAAE,EAHW;AAIhBC,UAAAA,QAAQ,EAAE,CAAC,CAAA;SAJb,CAAA;AAMA,QAAA,IAAMc,aAAa,GAAGC,YAAU,CAACb,GAAG,CAACc,SAAL,CAAV,GAA4Bd,GAAG,CAACc,SAAJ,iCAAmBJ,SAAnB,CAAA,EAAA,EAAA,EAAA;AAA8BK,UAAAA,IAAI,EAAE,IAAA;SAAhE,CAAA,CAAA,GAA0Ef,GAAG,CAACc,SAApG,CAAA;QACA,IAAME,SAAS,GAAG,CAChBT,QAAQ,CAACU,OADO,EAEhBL,aAFgB,GAAA,KAAA,GAAA,EAAA,EAAA,eAAA,CAAA,KAAA,EAIbpC,kBAAkB,CAAC0C,UAJN,EAImB5B,WAAW,CAACa,GAAZ,CAAgBH,GAAhB,CAJnB,CAAA,EAAA,eAAA,CAAA,KAAA,EAAA,EAAA,CAAA,MAAA,CAKVrB,WALU,EAAA,aAAA,CAAA,CAAA,MAAA,CAKeqB,GAAG,CAACmB,MALnB,CAK8BnB,EAAAA,GAAG,CAACmB,MALlC,CAAA,EAAA,eAAA,CAAA,KAAA,EAMb7C,UAAU,CAAC8C,cAAX,CAA0BpB,GAAG,CAACqB,KAA9B,CANa,EAM0BrB,GAAG,CAACqB,KAAJ,IAAarB,GAAG,CAACqB,KAAJ,KAAc,MANrD,CAAlB,EAAA,KAAA,EAAA,CAAA;QASA,IAAMC,eAAe,GAAG,EAACtB,CAAAA,aAAAA,GAAAA,GAAG,CAACuB,QAAL,MAAA,IAAA,IAAA,aAAA,KAAA,KAAA,CAAA,IAAC,aAAcC,CAAAA,MAAf,CAAxB,CAAA;QACA,IAAMC,KAAK,GAAGH,eAAe,IAAIjC,WAAJ,KAAIA,IAAAA,IAAAA,WAAJ,KAAIA,KAAAA,CAAAA,IAAAA,WAAW,CAAGW,GAAG,CAACmB,MAAP,CAA9B,GAAA,EAAA,CAAA,MAAA,CAAkD9B,WAAlD,KAAA,IAAA,IAAkDA,WAAlD,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAkDA,WAAW,CAAGW,GAAG,CAACmB,MAAP,CAA7D,EAAkF,IAAA,CAAA,GAAA,KAAK,CAArG,CAAA;;AACA,QAAA,IAAMO,MAAM,GAAQnB,aAAAA,CAAAA,aAAAA,CAAAA,EAAAA,EAAAA,QAAQ,CAACoB,KAAT,IAAkB,EAA1B,CAAA,EAAA,EAAA,EAAA;AAA8BF,UAAAA,KAAK,EAALA,KAAAA;SAA1C,CAAA,CAAA;;AACA,QAAA,IAAMG,OAAO,GAAGC,WAAW,CAAC7B,GAAD,EAAMC,KAAN,CAA3B,CAAA;AACA,QAAA,IAAI,CAACD,GAAG,CAACmB,MAAT,EACE,OAAO,IAAP,CAAA;AACF,QAAA,IAAMW,OAAO,GAAGjB,YAAU,CAACb,GAAG,CAAC+B,aAAL,CAAV,GAAgC/B,GAAG,CAAC+B,aAAJ,CAAkB;AAAE/B,UAAAA,GAAG,EAAHA,GAAF;AAAOW,UAAAA,QAAQ,EAAEV,KAAAA;SAAnC,CAAhC,GAA8E,KAAK,CAAnG,CAAA;AACA,QAAA,sBAAuB+B,KAAK,CAACC,aAAN,CAAoB,IAApB,EAAA,aAAA,CAAA;UACrBC,GAAG,EAAElC,GAAG,CAACmB,MADY;UAErB,aAAenB,EAAAA,GAAG,CAACmB,MAFE;AAGrBL,UAAAA,SAAS,EAAEqB,UAAU,CAACnB,SAAD,CAHA;AAIrBW,UAAAA,KAAK,EAAED,MAAAA;SACJ,EAAA;UAAEU,OAAO,EAAElC,iBAAiB,CAACE,OAA7B;UAAsCiC,OAAO,EAAEnC,iBAAiB,CAACoC,OAAAA;AAAjE,SALkB,kBAMJN,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;UAC5CnB,SAAS,EAAErC,cAAc,CAAC8D,WAAAA;SADT,EAEhBvC,GAAG,CAACwC,QAAJ,IAAgBxC,GAAG,CAAC+B,aAAJ,KAAsB,KAAtC,IAA+C/B,GAAG,CAAC+B,aAAJ,KAAsB,IAArE,kBAA4FC,KAAK,CAACC,aAAN,CAAoBQ,QAApB,EAA+B;AAC5HC,UAAAA,SAAS,EAAE,QADiH;AAE5HC,UAAAA,MAAM,EAAEvE,QAAQ,CAACwE,OAAT,GAAmB,YAAA;AAAA,YAAA,OAAMxE,QAAQ,CAACwE,OAAT,CAAiBC,UAAjB,CAA4BA,UAAlC,CAAA;WAAnB,GAAkE,KAAK,CAF6C;AAG5HC,UAAAA,YAAY,EAAEhB,OAH8G;AAI5HiB,UAAAA,UAAU,EAAE,OAAA,CAAO/C,GAAG,CAAC+B,aAAX,CAAA,KAA6B,QAA7B,GAAwC/B,GAAG,CAAC+B,aAA5C,GAA4D,KAAK,CAAA;AAJ+C,SAA/B,EAK5FH,OAL4F,CAA5F,GAKWA,OAPK,CANI,CAAvB,CAAA;AAcD,OA7Ca,CAAd,CAAA;AA8CA,MAAA,sBAAuBI,KAAK,CAACC,aAAN,CAAoB,IAApB,EAA0B;AAC/CC,QAAAA,GAAG,EAAEpC,QAAAA;OADgB,EAEpBC,KAFoB,CAAvB,CAAA;AAGD,KAlDM,CAAP,CAAA;GAHF,CAAA;;AAuDA,EAAA,sBAAuBiC,KAAK,CAACC,aAAN,CAAoB,OAApB,EAA6B;AAClDe,IAAAA,GAAG,EAAE5E,QAD6C;IAElD0C,SAAS,EAAEqB,UAAU,CAACvD,YAAD,CAAA;GAFA,EAGpBO,gBAAgB,CAAChB,KAAK,CAACiB,sBAAP,EAA+BjB,KAAK,CAACkB,WAArC,CAHI,CAAvB,CAAA;AAID;;;;"}
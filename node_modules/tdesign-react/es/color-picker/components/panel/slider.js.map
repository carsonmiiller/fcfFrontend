{"version":3,"file":"slider.js","sources":["../../../../src/color-picker/components/panel/slider.tsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport classnames from 'classnames';\nimport { SLIDER_DEFAULT_WIDTH } from '../../const';\nimport useDrag, { Coordinate } from '../../../_util/useDrag';\nimport { TdColorBaseProps } from '../../interface';\n\nexport interface TdColorSliderProps extends TdColorBaseProps {\n  className?: string;\n  value?: Number;\n  maxValue?: Number;\n  railStyle?: Object;\n}\n\nconst ColorSlider = (props: TdColorSliderProps) => {\n  const { color, className = '', value = 0, railStyle = {}, maxValue = 360, baseClassName, disabled, onChange } = props;\n  const panelRef = useRef<HTMLDivElement>(null);\n  const thumbRef = useRef<HTMLElement>(null);\n  const isMovedRef = useRef<boolean>(false);\n  const panelRectRef = useRef({\n    width: SLIDER_DEFAULT_WIDTH,\n  });\n\n  const styles = () => {\n    const { width } = panelRectRef.current;\n    if (!width) {\n      return;\n    }\n    const left = Math.round((Number(value) / Number(maxValue)) * width);\n    return {\n      left: `${left}px`,\n      color: color.rgb,\n    };\n  };\n\n  const handleDrag = (coordinate: Coordinate, isEnded?: boolean) => {\n    if (disabled) {\n      return;\n    }\n    const { width } = panelRectRef.current;\n    const { x } = coordinate;\n    const value = Math.round((x / width) * Number(maxValue) * 100) / 100;\n    isMovedRef.current = true;\n    onChange(value, isEnded);\n  };\n\n  const handleDragEnd = (coordinate: Coordinate) => {\n    if (disabled || !isMovedRef.current) {\n      return;\n    }\n\n    handleDrag(coordinate, true);\n    isMovedRef.current = false;\n  };\n\n  useDrag(panelRef, {\n    start: (coordinate: Coordinate) => {\n      // pop模式下由于是隐藏显示，这个宽度让其每次点击的时候重新计算\n      panelRectRef.current.width = panelRef.current.offsetWidth;\n      isMovedRef.current = false;\n      handleDrag(coordinate);\n    },\n    end: (coordinate: Coordinate) => {\n      handleDragEnd(coordinate);\n    },\n    drag: (coordinate: Coordinate) => {\n      handleDrag(coordinate);\n    },\n  });\n\n  useEffect(() => {\n    panelRectRef.current.width = panelRef.current.offsetWidth || SLIDER_DEFAULT_WIDTH;\n  }, []);\n\n  return (\n    <div className={classnames(`${baseClassName}__slider`, className)} ref={panelRef}>\n      <div className={`${baseClassName}__rail`} style={railStyle}></div>\n      <span\n        className={`${baseClassName}__thumb`}\n        role=\"slider\"\n        tabIndex={0}\n        ref={thumbRef}\n        style={{ ...styles() }}\n      ></span>\n    </div>\n  );\n};\n\nexport default React.memo(ColorSlider);\n"],"names":["ColorSlider","props","color","className","value","railStyle","maxValue","baseClassName","disabled","onChange","panelRef","useRef","thumbRef","isMovedRef","panelRectRef","width","SLIDER_DEFAULT_WIDTH","styles","current","left","Math","round","Number","rgb","handleDrag","coordinate","isEnded","x","value2","handleDragEnd","useDrag","start","offsetWidth","end","drag","useEffect","React","createElement","classnames","ref","style","role","tabIndex","memo"],"mappings":"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"}
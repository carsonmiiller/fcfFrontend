{"version":3,"file":"RenderDialog.js","sources":["../../src/dialog/RenderDialog.tsx"],"sourcesContent":["import React, { useRef, CSSProperties, useEffect, forwardRef, useImperativeHandle } from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport classnames from 'classnames';\nimport Portal from '../common/Portal';\nimport noop from '../_util/noop';\nimport useLayoutEffect from '../_util/useLayoutEffect';\nimport { DialogProps } from './Dialog';\nimport useDialogEsc from '../_util/useDialogEsc';\nimport { dialogDefaultProps } from './defaultProps';\n\nenum KeyCode {\n  ESC = 27,\n}\n\nexport interface RenderDialogProps extends DialogProps {\n  prefixCls?: string;\n  classPrefix: string;\n}\n\nconst transitionTime = 300;\nlet mousePosition: { x: number; y: number } | null;\nconst getClickPosition = (e: MouseEvent) => {\n  mousePosition = {\n    x: e.clientX,\n    y: e.clientY,\n  };\n  setTimeout(() => {\n    mousePosition = null;\n  }, 100);\n};\nif (typeof window !== 'undefined' && window.document && window.document.documentElement) {\n  document.documentElement.addEventListener('click', getClickPosition, true);\n}\nconst RenderDialog = forwardRef((props: RenderDialogProps, ref: React.Ref<HTMLDivElement>) => {\n  const {\n    prefixCls,\n    attach,\n    visible,\n    mode,\n    zIndex,\n    showOverlay,\n    onEscKeydown = noop,\n    onClosed = noop,\n    onClose = noop,\n    onCloseBtnClick = noop,\n    onOverlayClick = noop,\n    preventScrollThrough,\n    closeBtn,\n    closeOnEscKeydown,\n    closeOnOverlayClick,\n    destroyOnClose,\n  } = props;\n  const wrap = useRef<HTMLDivElement>();\n  const dialog = useRef<HTMLDivElement>();\n  const maskRef = useRef<HTMLDivElement>();\n  const portalRef = useRef<HTMLDivElement>();\n  const bodyOverflow = useRef<string>();\n  const bodyCssTextRef = useRef<string>();\n  const isModal = mode === 'modal';\n  const canDraggable = props.draggable && mode === 'modeless';\n  const dialogOpenClass = `${prefixCls}__open`;\n  useDialogEsc(visible, wrap);\n  useImperativeHandle(ref, () => wrap.current);\n  useLayoutEffect(() => {\n    bodyOverflow.current = document.body.style.overflow;\n    bodyCssTextRef.current = document.body.style.cssText;\n  }, []);\n\n  useLayoutEffect(() => {\n    if (visible) {\n      if (isModal && bodyOverflow.current !== 'hidden' && preventScrollThrough) {\n        const scrollWidth = window.innerWidth - document.body.offsetWidth;\n        // 减少回流\n        if (bodyCssTextRef.current === '') {\n          let bodyCssText = 'overflow: hidden;';\n          if (scrollWidth > 0) {\n            bodyCssText += `position: relative;width: calc(100% - ${scrollWidth}px);`;\n          }\n          document.body.style.cssText = bodyCssText;\n        } else {\n          if (scrollWidth > 0) {\n            document.body.style.width = `calc(100% - ${scrollWidth}px)`;\n            document.body.style.position = 'relative';\n          }\n          document.body.style.overflow = 'hidden';\n        }\n      }\n      if (wrap.current) {\n        wrap.current.focus();\n      }\n    } else if (isModal) {\n      const openDialogDom = document.querySelectorAll(`.${dialogOpenClass}`);\n      if (openDialogDom.length < 1) {\n        document.body.style.cssText = bodyCssTextRef.current;\n      }\n    }\n\n    // 组件销毁后重置 body 样式\n    return () => {\n      if (isModal) {\n        const openDialogDom = document.querySelectorAll(`.${dialogOpenClass}`);\n        if (openDialogDom.length < 1) {\n          document.body.style.cssText = bodyCssTextRef.current;\n          document.body.style.overflow = bodyOverflow.current;\n        }\n      } else {\n        document.body.style.cssText = bodyCssTextRef.current;\n        document.body.style.overflow = bodyOverflow.current;\n      }\n    };\n  }, [preventScrollThrough, attach, visible, mode, isModal, dialogOpenClass]);\n\n  useEffect(() => {\n    if (visible) {\n      if (mousePosition && dialog.current) {\n        dialog.current.style.transformOrigin = `${mousePosition.x - dialog.current.offsetLeft}px ${\n          mousePosition.y - dialog.current.offsetTop\n        }px`;\n      }\n    }\n  }, [visible]);\n\n  const onAnimateLeave = () => {\n    if (wrap.current) {\n      wrap.current.style.display = 'none';\n    }\n    if (isModal && preventScrollThrough) {\n      // 还原body的滚动条\n      const openDialogDom = document.querySelectorAll(`.${dialogOpenClass}`);\n      if (isModal && openDialogDom.length < 1) {\n        document.body.style.overflow = bodyOverflow.current;\n      }\n    }\n    if (!isModal) {\n      const { style } = dialog.current;\n      style.left = '50%';\n      style.top = '50%';\n    }\n    onClosed && onClosed();\n  };\n\n  const onMaskClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (e.target === e.currentTarget && closeOnOverlayClick) {\n      onOverlayClick({ e });\n      onClose({ e, trigger: 'overlay' });\n    }\n  };\n\n  const handleCloseBtnClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    onCloseBtnClick({ e });\n    onClose({ e, trigger: 'close-btn' });\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n    if (+e.code === KeyCode.ESC || e.keyCode === KeyCode.ESC) {\n      e.stopPropagation();\n      onEscKeydown({ e });\n      if (closeOnEscKeydown) {\n        onClose({ e, trigger: 'esc' });\n      }\n    }\n  };\n\n  const renderDialog = (classNames) => {\n    const dest: any = {};\n    if (props.width !== undefined) {\n      dest.width = props.width;\n    }\n\n    const footer = props.footer ? <div className={`${prefixCls}__footer`}>{props.footer}</div> : null;\n\n    const { header } = props;\n\n    const body = <div className={`${prefixCls}__body`}>{props.body || props.children}</div>;\n\n    const closer = closeBtn && (\n      <span onClick={handleCloseBtnClick} className={`${prefixCls}__close`}>\n        {closeBtn}\n      </span>\n    );\n\n    const style = { ...dest, ...props.style };\n    let dialogOffset = { x: 0, y: 0 };\n    const onDialogMove = (e: MouseEvent) => {\n      const { style, offsetWidth, offsetHeight, clientHeight, clientWidth } = dialog.current;\n      const halfHeight = clientHeight / 2;\n      const halfWidth = clientWidth / 2;\n\n      let diffX = e.clientX - dialogOffset.x;\n      let diffY = e.clientY - dialogOffset.y;\n\n      if (diffX < halfWidth) {\n        diffX = halfWidth;\n      }\n      if (diffX > window.innerWidth - offsetWidth + halfWidth) {\n        diffX = window.innerWidth - offsetWidth + halfWidth;\n      }\n\n      if (diffY < halfHeight) {\n        diffY = halfHeight;\n      }\n\n      if (diffY > window.innerHeight - offsetHeight + halfHeight) {\n        diffY = window.innerHeight - offsetHeight + halfHeight;\n      }\n      style.left = `${diffX}px`;\n      style.top = `${diffY}px`;\n    };\n\n    const onDialogMoveEnd = () => {\n      dialog.current.style.cursor = 'default';\n      document.removeEventListener('mousemove', onDialogMove);\n      document.removeEventListener('mouseup', onDialogMoveEnd);\n    };\n\n    const onDialogMoveStart = (e: React.MouseEvent<HTMLDivElement>) => {\n      if (canDraggable) {\n        const { offsetLeft, offsetTop } = dialog.current;\n        dialog.current.style.cursor = 'move';\n        const diffX = e.clientX - offsetLeft;\n        const diffY = e.clientY - offsetTop;\n        dialogOffset = {\n          x: diffX,\n          y: diffY,\n        };\n\n        document.addEventListener('mousemove', onDialogMove);\n        document.addEventListener('mouseup', onDialogMoveEnd);\n      }\n    };\n\n    const dialogElement = (\n      <div\n        ref={dialog}\n        style={style}\n        className={classnames(`${prefixCls}`, `${prefixCls}--default`, classNames)}\n        onMouseDown={onDialogMoveStart}\n      >\n        {closer}\n        {header}\n        {body}\n        {footer}\n      </div>\n    );\n\n    return (\n      <CSSTransition\n        in={props.visible}\n        appear\n        mountOnEnter\n        unmountOnExit={destroyOnClose}\n        timeout={transitionTime}\n        classNames={`${prefixCls}-zoom`}\n        onEntered={props.onOpened}\n        onExited={onAnimateLeave}\n        nodeRef={dialog}\n      >\n        {dialogElement}\n      </CSSTransition>\n    );\n  };\n\n  const renderMask = () => {\n    let maskElement;\n    if (showOverlay) {\n      maskElement = (\n        <CSSTransition\n          in={visible}\n          appear\n          timeout={transitionTime}\n          classNames={`${prefixCls}-fade`}\n          mountOnEnter\n          unmountOnExit\n          nodeRef={maskRef}\n        >\n          <div ref={maskRef} onClick={onMaskClick} className={`${prefixCls}__mask`} />\n        </CSSTransition>\n      );\n    }\n    return maskElement;\n  };\n\n  const render = () => {\n    const style: CSSProperties = {};\n    if (visible) {\n      style.display = 'block';\n    }\n    const wrapStyle = {\n      ...style,\n      zIndex,\n    };\n\n    const dialogBody = renderDialog(`${props.placement ? `${prefixCls}--${props.placement}` : ''}`);\n    const wrapClass = classnames(\n      props.className,\n      `${prefixCls}__ctx`,\n      `${prefixCls}__ctx--fixed`,\n      visible ? dialogOpenClass : '',\n    );\n    const dialog = (\n      <div ref={wrap} className={wrapClass} style={wrapStyle} onKeyDown={handleKeyDown} tabIndex={0}>\n        {mode === 'modal' && renderMask()}\n        {dialogBody}\n      </div>\n    );\n\n    let dom = null;\n\n    if (visible || wrap.current) {\n      if (!attach) {\n        dom = dialog;\n      } else {\n        dom = (\n          <CSSTransition\n            in={visible}\n            appear\n            timeout={transitionTime}\n            mountOnEnter\n            unmountOnExit={destroyOnClose}\n            nodeRef={portalRef}\n          >\n            <Portal attach={attach} ref={portalRef}>\n              {dialog}\n            </Portal>\n          </CSSTransition>\n        );\n      }\n    }\n    return dom;\n  };\n\n  return render();\n});\n\nRenderDialog.defaultProps = dialogDefaultProps;\n\nexport default RenderDialog;\n"],"names":["KeyCode","KeyCode2","transitionTime","mousePosition","getClickPosition","e","x","clientX","y","clientY","setTimeout","window","document","documentElement","addEventListener","RenderDialog","forwardRef","props","ref","prefixCls","attach","visible","mode","zIndex","showOverlay","onEscKeydown","noop","onClosed","onClose","onCloseBtnClick","onOverlayClick","preventScrollThrough","closeBtn","closeOnEscKeydown","closeOnOverlayClick","destroyOnClose","wrap","useRef","dialog","maskRef","portalRef","bodyOverflow","bodyCssTextRef","isModal","canDraggable","draggable","dialogOpenClass","useDialogEsc","useImperativeHandle","current","useLayoutEffect","body","style","overflow","cssText","scrollWidth","innerWidth","offsetWidth","bodyCssText","width","position","focus","openDialogDom","querySelectorAll","length","useEffect","transformOrigin","offsetLeft","offsetTop","onAnimateLeave","display","left","top","onMaskClick","target","currentTarget","trigger","handleCloseBtnClick","handleKeyDown","code","keyCode","stopPropagation","renderDialog","classNames","dest","footer","React","createElement","className","header","children","closer","onClick","dialogOffset","onDialogMove","style2","offsetHeight","clientHeight","clientWidth","halfHeight","halfWidth","diffX","diffY","innerHeight","onDialogMoveEnd","cursor","removeEventListener","onDialogMoveStart","dialogElement","classnames","onMouseDown","CSSTransition","appear","mountOnEnter","unmountOnExit","timeout","onEntered","onOpened","onExited","nodeRef","renderMask","maskElement","render","wrapStyle","dialogBody","placement","wrapClass","dialog2","onKeyDown","tabIndex","dom","Portal","defaultProps","dialogDefaultProps"],"mappings":"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"}
{"version":3,"file":"Dialog.js","sources":["../../src/dialog/Dialog.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo, useRef, isValidElement } from 'react';\nimport isString from 'lodash/isString';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { CloseIcon, InfoCircleFilledIcon, CheckCircleFilledIcon } from 'tdesign-icons-react';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport Button, { ButtonProps } from '../button';\nimport { TdDialogProps, DialogInstance } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport RenderDialog from './RenderDialog';\nimport useSetState from '../_util/useSetState';\nimport useConfig from '../_util/useConfig';\nimport { dialogDefaultProps } from './defaultProps';\n\nexport interface DialogProps extends TdDialogProps, StyledProps {\n  /**\n   * 是否以插件形式调用\n   */\n  isPlugin?: boolean;\n}\n\nconst renderDialogButton = (btn: TdDialogProps['cancelBtn'], defaultProps: ButtonProps) => {\n  let result = null;\n\n  if (isString(btn)) {\n    result = <Button {...defaultProps}>{btn}</Button>;\n  } else if (isValidElement(btn)) {\n    result = btn;\n  } else if (isObject(btn)) {\n    result = <Button {...defaultProps} {...(btn as {})} />;\n  } else if (isFunction(btn)) {\n    result = btn();\n  }\n\n  return result;\n};\n\nconst Dialog = forwardRef((props: DialogProps, ref: React.Ref<DialogInstance>) => {\n  const { classPrefix } = useConfig();\n  const dialogDom = useRef<HTMLDivElement>();\n  const [state, setState] = useSetState<DialogProps>({\n    width: 520,\n    visible: false,\n    zIndex: 2500,\n    placement: 'center',\n    mode: 'modal',\n    showOverlay: true,\n    destroyOnClose: false,\n    draggable: false,\n    preventScrollThrough: true,\n    isPlugin: false,\n    ...props,\n  });\n\n  const [local, t] = useLocaleReceiver('dialog');\n  const confirmText = t(local.confirm);\n  const cancelText = t(local.cancel);\n\n  const {\n    visible,\n    attach = 'body',\n    closeBtn,\n    footer,\n    onCancel = noop,\n    onConfirm = noop,\n    cancelBtn = cancelText,\n    confirmBtn = confirmText,\n    onClose = noop,\n    isPlugin = false,\n    ...restState\n  } = state;\n\n  useEffect(() => {\n    // 插件式调用不会更新props, 只有组件式调用才会更新props\n    if (!isPlugin) {\n      setState((prevState) => ({\n        ...prevState,\n        ...props,\n      }));\n    }\n  }, [props, setState, isPlugin]);\n\n  const prefixCls = `${classPrefix}-dialog`;\n  const renderCloseIcon = () => {\n    if (closeBtn === false) return null;\n    if (closeBtn === true) return <CloseIcon style={{ verticalAlign: 'unset' }} />;\n    return closeBtn || <CloseIcon style={{ verticalAlign: 'unset' }} />;\n  };\n\n  React.useImperativeHandle(ref, () => ({\n    show() {\n      setState({ visible: true });\n    },\n    hide() {\n      setState({ visible: false });\n    },\n    destroy() {\n      setState({ visible: false, destroyOnClose: true });\n    },\n    update(newOptions) {\n      setState((prevState) => ({\n        ...prevState,\n        ...(newOptions as DialogProps),\n      }));\n    },\n  }));\n\n  const renderHeader = useMemo(() => {\n    if (!state.header) return null;\n\n    const iconMap = {\n      info: <InfoCircleFilledIcon className={`${classPrefix}-is-info`} />,\n      warning: <InfoCircleFilledIcon className={`${classPrefix}-is-warning`} />,\n      error: <InfoCircleFilledIcon className={`${classPrefix}-is-error`} />,\n      success: <CheckCircleFilledIcon className={`${classPrefix}-is-success`} />,\n    };\n    return (\n      <div className={`${prefixCls}__header`}>\n        {iconMap[state.theme]}\n        {state.header}\n      </div>\n    );\n  }, [state.header, state.theme, prefixCls, classPrefix]);\n\n  const handleCancel = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onCancel({ e });\n    onClose({ e, trigger: 'cancel' });\n  };\n\n  const handleConfirm = (e: React.MouseEvent<HTMLButtonElement>) => {\n    onConfirm({ e });\n  };\n\n  const defaultFooter = () => {\n    const renderCancelBtn = renderDialogButton(cancelBtn, { variant: 'outline' });\n    const renderConfirmBtn = renderDialogButton(confirmBtn, { theme: 'primary' });\n\n    return (\n      <>\n        {renderCancelBtn &&\n          React.cloneElement(renderCancelBtn, {\n            onClick: handleCancel,\n            ...renderCancelBtn.props,\n          })}\n        {renderConfirmBtn &&\n          React.cloneElement(renderConfirmBtn, {\n            onClick: handleConfirm,\n            ...renderConfirmBtn.props,\n          })}\n      </>\n    );\n  };\n\n  return (\n    <RenderDialog\n      {...restState}\n      visible={visible}\n      prefixCls={prefixCls}\n      header={renderHeader}\n      attach={attach}\n      closeBtn={renderCloseIcon()}\n      classPrefix={classPrefix}\n      onClose={onClose}\n      footer={footer === undefined ? defaultFooter() : footer}\n      ref={dialogDom}\n    />\n  );\n});\n\nDialog.displayName = 'Dialog';\nDialog.defaultProps = dialogDefaultProps;\n\nexport default Dialog;\n"],"names":["renderDialogButton","btn","defaultProps","result","isString","React","createElement","Button","isValidElement","isObject","isFunction","Dialog","forwardRef","props","ref","useConfig","classPrefix","dialogDom","useRef","useSetState","width","visible","zIndex","placement","mode","showOverlay","destroyOnClose","draggable","preventScrollThrough","isPlugin","state","setState","useLocaleReceiver","local","t","confirmText","confirm","cancelText","cancel","attach","closeBtn","footer","onCancel","noop","onConfirm","cancelBtn","confirmBtn","onClose","restState","useEffect","prevState","prefixCls","renderCloseIcon","CloseIcon","style","verticalAlign","useImperativeHandle","show","hide","destroy","update","newOptions","renderHeader","useMemo","header","iconMap","info","InfoCircleFilledIcon","className","warning","error","success","CheckCircleFilledIcon","theme","handleCancel","e","trigger","handleConfirm","defaultFooter","renderCancelBtn","variant","renderConfirmBtn","Fragment","cloneElement","onClick","RenderDialog","displayName","dialogDefaultProps"],"mappings":"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"}
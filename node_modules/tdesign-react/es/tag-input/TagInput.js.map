{"version":3,"file":"TagInput.js","sources":["../../src/tag-input/TagInput.tsx"],"sourcesContent":["import React, { CompositionEvent, KeyboardEvent, useRef, useImperativeHandle, forwardRef, MouseEvent } from 'react';\nimport { CloseCircleFilledIcon } from 'tdesign-icons-react';\nimport isFunction from 'lodash/isFunction';\nimport classnames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport useDragSorter from '../_util/useDragSorter';\nimport TInput, { InputValue } from '../input';\nimport { TdTagInputProps } from './type';\nimport useTagScroll from './useTagScroll';\nimport useTagList from './useTagList';\nimport useHover from './useHover';\nimport useControlled from '../hooks/useControlled';\nimport { StyledProps } from '../common';\nimport { tagInputDefaultProps } from './defaultProps';\n\nexport interface TagInputProps extends TdTagInputProps, StyledProps {}\n\nconst TagInput = forwardRef((props: TagInputProps, ref) => {\n  const { classPrefix: prefix } = useConfig();\n\n  const {\n    excessTagsDisplayType,\n    autoWidth,\n    readonly,\n    disabled,\n    clearable,\n    placeholder,\n    valueDisplay,\n    label,\n    inputProps,\n    size,\n    tips,\n    status,\n    suffixIcon,\n    suffix,\n    onClick,\n    onPaste,\n    onFocus,\n    onBlur,\n  } = props;\n\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n\n  const { isHover, addHover, cancelHover } = useHover(props);\n  const { getDragProps } = useDragSorter({\n    ...props,\n    sortOnDraggable: props.dragSort,\n    onDragOverCheck: {\n      x: true,\n      targetClassNameRegExp: new RegExp(`^${prefix}-tag`),\n    },\n  });\n  const isCompositionRef = useRef(false);\n\n  const { scrollToRight, onWheel, scrollToRightOnEnter, scrollToLeftOnLeave, tagInputRef } = useTagScroll(props);\n\n  // handle tag add and remove\n  const { tagValue, onClose, onInnerEnter, onInputBackspaceKeyUp, clearAll, renderLabel } = useTagList({\n    ...props,\n    getDragProps,\n  });\n\n  const NAME_CLASS = `${prefix}-tag-input`;\n  const WITH_SUFFIX_ICON_CLASS = `${prefix}-tag-input__with-suffix-icon`;\n  const CLEAR_CLASS = `${prefix}-tag-input__suffix-clear`;\n  const BREAK_LINE_CLASS = `${prefix}-tag-input--break-line`;\n\n  const tagInputPlaceholder = !tagValue?.length ? placeholder : '';\n\n  const showClearIcon = Boolean(!readonly && !disabled && clearable && isHover && tagValue?.length);\n\n  useImperativeHandle(ref, () => ({ ...(tagInputRef.current || {}) }));\n\n  const onInputCompositionstart = (value: InputValue, context: { e: CompositionEvent<HTMLInputElement> }) => {\n    isCompositionRef.current = true;\n    inputProps?.onCompositionstart?.(value, context);\n  };\n\n  const onInputCompositionend = (value: InputValue, context: { e: CompositionEvent<HTMLInputElement> }) => {\n    isCompositionRef.current = false;\n    inputProps?.onCompositionend?.(value, context);\n  };\n\n  const onInputEnter = (value: InputValue, context: { e: KeyboardEvent<HTMLDivElement> }) => {\n    setTInputValue('', { e: context.e, trigger: 'enter' });\n    !isCompositionRef.current && onInnerEnter(value, context);\n    scrollToRight();\n  };\n\n  const onInnerClick = (context: { e: MouseEvent<HTMLDivElement> }) => {\n    (tagInputRef.current as any).inputElement.focus();\n    onClick?.(context);\n  };\n\n  const onClearClick = (e: MouseEvent<SVGElement>) => {\n    clearAll({ e });\n    setTInputValue('', { e, trigger: 'clear' });\n  };\n\n  const suffixIconNode = showClearIcon ? (\n    <CloseCircleFilledIcon className={CLEAR_CLASS} onClick={onClearClick} />\n  ) : (\n    suffixIcon\n  );\n  // 自定义 Tag 节点\n  const displayNode = isFunction(valueDisplay)\n    ? valueDisplay({\n        value: tagValue,\n        onClose: (index, item) => onClose({ index, item }),\n      })\n    : valueDisplay;\n\n  const classes = [\n    NAME_CLASS,\n    {\n      [BREAK_LINE_CLASS]: excessTagsDisplayType === 'break-line',\n      [WITH_SUFFIX_ICON_CLASS]: !!suffixIconNode,\n    },\n    props.className,\n  ];\n\n  return (\n    <TInput\n      ref={tagInputRef}\n      {...inputProps}\n      value={tInputValue}\n      onChange={(val, context) => {\n        setTInputValue(val, { ...context, trigger: 'input' });\n      }}\n      autoWidth={autoWidth}\n      onWheel={onWheel}\n      size={size}\n      readonly={readonly}\n      disabled={disabled}\n      label={() => renderLabel({ displayNode, label })}\n      className={classnames(classes)}\n      style={props.style}\n      tips={tips}\n      status={status}\n      placeholder={tagInputPlaceholder}\n      suffix={suffix}\n      suffixIcon={suffixIconNode}\n      onPaste={onPaste}\n      onClick={onInnerClick}\n      onEnter={onInputEnter}\n      onKeyup={onInputBackspaceKeyUp}\n      onMouseenter={(context) => {\n        addHover(context);\n        scrollToRightOnEnter();\n      }}\n      onMouseleave={(context) => {\n        cancelHover(context);\n        scrollToLeftOnLeave();\n      }}\n      onFocus={(inputValue, context) => {\n        onFocus?.(tagValue, { e: context.e, inputValue });\n      }}\n      onBlur={(inputValue, context) => {\n        onBlur?.(tagValue, { e: context.e, inputValue });\n      }}\n      onCompositionstart={onInputCompositionstart}\n      onCompositionend={onInputCompositionend}\n    />\n  );\n});\n\nTagInput.displayName = 'TagInput';\nTagInput.defaultProps = tagInputDefaultProps;\n\nexport default TagInput;\n"],"names":["TagInput","forwardRef","props","ref","useConfig","prefix","classPrefix","excessTagsDisplayType","autoWidth","readonly","disabled","clearable","placeholder","valueDisplay","label","inputProps","size","tips","status","suffixIcon","suffix","onClick","onPaste","onFocus","onBlur","useControlled","onInputChange","tInputValue","setTInputValue","useHover","isHover","addHover","cancelHover","useDragSorter","sortOnDraggable","dragSort","onDragOverCheck","x","targetClassNameRegExp","RegExp","getDragProps","isCompositionRef","useRef","useTagScroll","scrollToRight","onWheel","scrollToRightOnEnter","scrollToLeftOnLeave","tagInputRef","useTagList","tagValue","onClose","onInnerEnter","onInputBackspaceKeyUp","clearAll","renderLabel","NAME_CLASS","WITH_SUFFIX_ICON_CLASS","CLEAR_CLASS","BREAK_LINE_CLASS","tagInputPlaceholder","length","showClearIcon","Boolean","useImperativeHandle","current","onInputCompositionstart","value","context","onCompositionstart","onInputCompositionend","onCompositionend","onInputEnter","e","trigger","onInnerClick","inputElement","focus","onClearClick","suffixIconNode","React","createElement","CloseCircleFilledIcon","className","displayNode","isFunction","index","item","classes","TInput","onChange","val","classnames","style","onEnter","onKeyup","onMouseenter","onMouseleave","inputValue","displayName","defaultProps","tagInputDefaultProps"],"mappings":"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"}
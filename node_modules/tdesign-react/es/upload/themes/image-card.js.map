{"version":3,"file":"image-card.js","sources":["../../../src/upload/themes/image-card.tsx"],"sourcesContent":["import React, { FC, Fragment, useState } from 'react';\nimport { BrowseIcon, DeleteIcon, AddIcon } from 'tdesign-icons-react';\nimport Loading from '../../loading';\nimport Dialog from '../../dialog';\nimport useConfig from '../../_util/useConfig';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { UploadRemoveContext } from '../type';\nimport { finishUpload } from '../util';\nimport { TdUploadFile } from '../types';\nimport BooleanRender from '../boolean-render';\n\nexport interface ImageCardProps {\n  files?: TdUploadFile[];\n  multiple?: boolean;\n  max?: number;\n  onTrigger: () => void;\n  onRemove?: (options: UploadRemoveContext) => void;\n  showUploadProgress: boolean;\n}\n\nconst ImageCard: FC<ImageCardProps> = (props) => {\n  const { files, multiple = false, max = 0, onRemove, showUploadProgress } = props;\n  const { classPrefix } = useConfig();\n  const [locale, t] = useLocaleReceiver('upload');\n  const [showImg, setShowImg] = useState(false);\n  const [imgURL, setImgURL] = useState();\n\n  const preview = (file) => {\n    setShowImg(true);\n    setImgURL(file.url);\n  };\n\n  const showTrigger = React.useMemo(() => {\n    if (multiple) {\n      return !max || files.length < max;\n    }\n\n    return !(files && files[0]);\n  }, [files, max, multiple]);\n\n  return (\n    <Fragment>\n      <Dialog\n        visible={showImg}\n        showOverlay\n        width=\"auto\"\n        top=\"10%\"\n        className={`${classPrefix}-upload__dialog`}\n        footer={false}\n        header={false}\n        onClose={() => {\n          setShowImg(false);\n          setImgURL(null);\n        }}\n      >\n        <p className={`${classPrefix}-dialog__dialog-body-img-box`}>\n          <img src={imgURL} alt=\"\" />\n        </p>\n      </Dialog>\n      <ul className={`${classPrefix}-upload__card`}>\n        <BooleanRender boolExpression={!!files}>\n          {files.map((file, index) => (\n            <li className={`${classPrefix}-upload__card-item ${classPrefix}-is--background`} key={index}>\n              <BooleanRender\n                falseRender={() => (\n                  <div className={`${classPrefix}-upload__card-content ${classPrefix}-upload__card-box`}>\n                    <img className={`${classPrefix}-upload__card-image`} src={file.url} />\n                    <div className={`${classPrefix}-upload__card-mask`}>\n                      <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n                        <BrowseIcon\n                          onClick={() => {\n                            preview(file);\n                          }}\n                        />\n                      </span>\n                      <span className={`${classPrefix}-upload__card-mask-item-divider`} />\n                      <span className={`${classPrefix}-upload__card-mask-item`} onClick={(e) => e.stopPropagation()}>\n                        <DeleteIcon\n                          onClick={(e) => {\n                            onRemove?.({ e, file, index });\n                          }}\n                        />\n                      </span>\n                    </div>\n                  </div>\n                )}\n                boolExpression={showUploadProgress && !finishUpload(file.status)}\n              >\n                <div className={`${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`}>\n                  <Loading loading={true} size=\"medium\" />\n                  <p>\n                    {t(locale.progress.uploadingText)} {Math.min(files[index].percent, 99)}%\n                  </p>\n                </div>\n              </BooleanRender>\n            </li>\n          ))}\n        </BooleanRender>\n        <BooleanRender boolExpression={showTrigger}>\n          <li className={`${classPrefix}-upload__card-item ${classPrefix}-is--background`} onClick={props.onTrigger}>\n            <div className={`${classPrefix}-upload__card-container ${classPrefix}-upload__card-box`}>\n              <AddIcon />\n              <p className={`${classPrefix}-size-s`}>{t(locale.triggerUploadText.image)}</p>\n            </div>\n          </li>\n        </BooleanRender>\n      </ul>\n    </Fragment>\n  );\n};\n\nexport default ImageCard;\n"],"names":["ImageCard","props","files","multiple","max","onRemove","showUploadProgress","useConfig","classPrefix","useLocaleReceiver","locale","t","useState","showImg","setShowImg","imgURL","setImgURL","preview","file","url","showTrigger","React","useMemo","length","createElement","Fragment","Dialog","visible","showOverlay","width","top","className","footer","header","onClose","src","alt","BooleanRender","boolExpression","map","index","key","falseRender","onClick","e","stopPropagation","BrowseIcon","DeleteIcon","finishUpload","status","Loading","loading","size","progress","uploadingText","Math","min","percent","onTrigger","AddIcon","triggerUploadText","image"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../../../../src/upload/themes/flow-list/index.tsx"],"sourcesContent":["import React, { DragEvent, MouseEvent, ReactNode, useCallback, useState } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../../../_util/useConfig';\nimport { useLocaleReceiver } from '../../../locale/LocalReceiver';\nimport Button from '../../../button';\nimport { UploadFile } from '../../type';\nimport { FlowRemoveContext } from '../../types';\nimport ImgList from './img-list';\nimport FileList from './file-list';\nimport BooleanRender from '../../boolean-render';\n\nexport interface CommonListProps {\n  renderDragger: () => React.ReactElement;\n  showInitial: boolean;\n  listFiles: UploadFile[];\n}\n\nexport interface FlowListProps {\n  children?: ReactNode;\n  files?: UploadFile[];\n  showUploadProgress?: boolean;\n  toUploadFiles?: UploadFile[];\n  placeholder: string;\n  display: 'file-flow' | 'image-flow';\n  remove: (ctx: FlowRemoveContext) => void;\n  upload: (files: UploadFile[], e: MouseEvent) => void;\n  cancel: (e: MouseEvent) => void;\n  onImgPreview: (file: UploadFile, e: MouseEvent) => void;\n  onChange: (files: FileList) => void;\n  onDragenter: (e: React.DragEvent) => void;\n  onDragleave: (e: React.DragEvent) => void;\n}\n\nconst Index: React.FC<FlowListProps> = (props) => {\n  const {\n    files: listFiles,\n    toUploadFiles = [],\n    showUploadProgress = false,\n    placeholder,\n    display,\n    onImgPreview,\n    remove,\n    upload,\n    cancel,\n    onChange,\n    onDragenter,\n    onDragleave,\n    children = null,\n  } = props;\n  const target = React.useRef();\n  const { classPrefix: prefix } = useConfig();\n  const [locale, t] = useLocaleReceiver('upload');\n  const UPLOAD_NAME = `${prefix}-upload`;\n  const [dragActive, setDragActive] = useState(false);\n  const showInitial = !listFiles.length;\n  const failedList = toUploadFiles.filter((file) => file.status === 'fail');\n  const isUploading = toUploadFiles.filter((file) => file.status === 'progress').length > 0;\n  const allowUpload = toUploadFiles.length > 0 && !isUploading;\n  const { progress, triggerUploadText } = locale;\n  let uploadText = failedList.length ? t(triggerUploadText.reupload) : t(triggerUploadText.normal);\n  if (isUploading) uploadText = t(progress.uploadingText);\n\n  const handleDrop = (event: DragEvent) => {\n    event.preventDefault();\n    onChange?.(event.dataTransfer.files);\n    onDragleave?.(event);\n    setDragActive(false);\n  };\n  const handleDragenter = (event: DragEvent) => {\n    event.preventDefault();\n    onDragenter?.(event);\n    setDragActive(true);\n  };\n  const handleDragleave = (event: DragEvent) => {\n    if (event.target !== target.current) return;\n    event.preventDefault();\n    onDragleave?.(event);\n    setDragActive(false);\n  };\n  const handleDragover = (event: DragEvent) => {\n    event.preventDefault();\n  };\n  const onInternalImgPreview = useCallback(\n    (file, event) => {\n      if (!onImgPreview) return;\n      event.preventDefault();\n      onImgPreview(file, event);\n    },\n    [onImgPreview],\n  );\n\n  const renderDragger = () => (\n    <div\n      ref={target}\n      className={`${UPLOAD_NAME}__flow-empty`}\n      onDrop={handleDrop}\n      onDragEnter={handleDragenter}\n      onDragOver={handleDragover}\n      onDragLeave={handleDragleave}\n    >\n      {dragActive ? t(locale.dragger.dragDropText) : t(locale.dragger.clickAndDragText)}\n    </div>\n  );\n  const wrapperClassNames = classNames({\n    [`${UPLOAD_NAME}__flow`]: true,\n    [`${UPLOAD_NAME}__flow-${display}`]: true,\n  });\n\n  return (\n    <div className={wrapperClassNames}>\n      <div className={`${UPLOAD_NAME}__flow-op`}>\n        {children}\n        <small className={`${UPLOAD_NAME}__small ${UPLOAD_NAME}__flow-placeholder`}>{placeholder}</small>\n      </div>\n      <BooleanRender boolExpression={display === 'file-flow'}>\n        <FileList\n          listFiles={listFiles}\n          showInitial={showInitial}\n          renderDragger={renderDragger}\n          showUploadProgress={showUploadProgress}\n          remove={remove}\n        />\n      </BooleanRender>\n      <BooleanRender boolExpression={display === 'image-flow'}>\n        <ImgList\n          listFiles={listFiles}\n          showInitial={showInitial}\n          renderDragger={renderDragger}\n          onImgPreview={onInternalImgPreview}\n          remove={remove}\n        />\n      </BooleanRender>\n      <div className={`${UPLOAD_NAME}__flow-bottom`}>\n        <Button theme=\"default\" onClick={cancel}>\n          {t(locale.cancelUploadText)}\n        </Button>\n        <Button disabled={!allowUpload} theme=\"primary\" onClick={(e: MouseEvent) => upload(toUploadFiles, e)}>\n          {uploadText}\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default Index;\n"],"names":["Index","props","listFiles","files","toUploadFiles","showUploadProgress","placeholder","display","onImgPreview","remove","upload","cancel","onChange","onDragenter","onDragleave","children","target","React","useRef","useConfig","prefix","classPrefix","useLocaleReceiver","locale","t","UPLOAD_NAME","useState","dragActive","setDragActive","showInitial","length","failedList","filter","file","status","isUploading","allowUpload","progress","triggerUploadText","uploadText","reupload","normal","uploadingText","handleDrop","event","preventDefault","dataTransfer","handleDragenter","handleDragleave","current","handleDragover","onInternalImgPreview","useCallback","renderDragger","createElement","ref","className","onDrop","onDragEnter","onDragOver","onDragLeave","dragger","dragDropText","clickAndDragText","wrapperClassNames","classNames","BooleanRender","boolExpression","FileList","ImgList","Button","theme","onClick","cancelUploadText","disabled","e"],"mappings":"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"}
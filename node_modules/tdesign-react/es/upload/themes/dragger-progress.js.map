{"version":3,"file":"dragger-progress.js","sources":["../../../src/upload/themes/dragger-progress.tsx"],"sourcesContent":["import React, { FC, useCallback } from 'react';\nimport { CheckCircleFilledIcon, ErrorCircleFilledIcon } from 'tdesign-icons-react';\nimport Button from '../../button';\nimport Loading from '../../loading';\nimport useConfig from '../../_util/useConfig';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { UploadFile, UploadRemoveContext } from '../type';\nimport { returnFileSize, abridgeName, getCurrentDate } from '../util';\n\nexport interface DraggerProgressProps {\n  display?: string;\n  file?: UploadFile;\n  onTrigger?: () => void;\n  onRemove?: (context: UploadRemoveContext) => void;\n  onUpload?: () => void;\n  onCancel?: () => void;\n}\n\nconst DraggerProgress: FC<DraggerProgressProps> = (props) => {\n  const { file, onUpload, onRemove, display, onTrigger, onCancel } = props;\n  const { classPrefix } = useConfig();\n  const [locale, t] = useLocaleReceiver('upload');\n  const { triggerUploadText, file: infoText, cancelUploadText } = locale;\n  const reUpload = (e) => {\n    onRemove?.({ e, file, index: 0 });\n    onTrigger?.();\n  };\n\n  const showResultOperate = React.useMemo(() => ['success', 'fail'].includes(file?.status), [file]);\n\n  const handleRemove = (e) => {\n    onRemove?.({ e, file, index: 0 });\n  };\n\n  const renderUploading = useCallback(() => {\n    if (file?.status === 'fail') {\n      return <ErrorCircleFilledIcon />;\n    }\n    if (file?.status === 'progress') {\n      return (\n        <div className=\"t-upload__single-progress\">\n          <Loading loading={true} size=\"small\" />\n          <span className=\"t-upload__single-percent\">{Math.min(file?.percent || 0, 99)}%</span>\n        </div>\n      );\n    }\n  }, [file]);\n\n  return (\n    <div className={`${classPrefix}-upload__dragger-progress`}>\n      {display === 'image' && (\n        <div className=\"t-upload__dragger-img-wrap\">{file && <img src={file?.url || 'default.png'} alt=\"\" />}</div>\n      )}\n      <div className={`${classPrefix}-upload__dragger-progress-info`}>\n        <div className={`${classPrefix}-upload__dragger-text`}>\n          <span className={`${classPrefix}-upload__single-name`}>{abridgeName(file?.name)}</span>\n          {file?.status !== 'success' && renderUploading()}\n          {file?.status === 'success' && <CheckCircleFilledIcon />}\n        </div>\n        <small className={`${classPrefix}-size-s`}>\n          {t(infoText.fileSizeText)}：{returnFileSize(file?.size)}\n        </small>\n        <small className={`${classPrefix}-size-s`}>\n          {t(infoText.fileOperationDateText)}：{getCurrentDate()}\n        </small>\n        {!['success', 'fail'].includes(file?.status) && (\n          <div className={`${classPrefix}-upload__dragger-btns`}>\n            <Button\n              theme=\"primary\"\n              variant=\"text\"\n              className={`${classPrefix}-upload__dragger-progress-cancel`}\n              onClick={onCancel}\n            >\n              {t(cancelUploadText)}\n            </Button>\n            <Button theme=\"primary\" variant=\"text\" onClick={onUpload}>\n              {t(triggerUploadText.normal)}\n            </Button>\n          </div>\n        )}\n        {showResultOperate && (\n          <div className=\"t-upload__dragger-btns\">\n            <Button theme=\"primary\" variant=\"text\" className=\"t-upload__dragger-progress-cancel\" onClick={reUpload}>\n              {t(triggerUploadText.reupload)}\n            </Button>\n            <Button theme=\"primary\" variant=\"text\" onClick={handleRemove}>\n              {t(triggerUploadText.delete)}\n            </Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default DraggerProgress;\n"],"names":["DraggerProgress","props","file","onUpload","onRemove","display","onTrigger","onCancel","useConfig","classPrefix","useLocaleReceiver","locale","t","triggerUploadText","infoText","cancelUploadText","reUpload","e","index","showResultOperate","React","useMemo","includes","status","handleRemove","renderUploading","useCallback","createElement","ErrorCircleFilledIcon","className","Loading","loading","size","Math","min","percent","src","url","alt","abridgeName","name","CheckCircleFilledIcon","fileSizeText","returnFileSize","fileOperationDateText","getCurrentDate","Button","theme","variant","onClick","normal","reupload"],"mappings":"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"}
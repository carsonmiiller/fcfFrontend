{"version":3,"file":"Watermark.js","sources":["../../src/watermark/Watermark.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\nimport React, { useState, useEffect, useRef } from 'react';\nimport { StyledProps } from '../common';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport useConfig from '../_util/useConfig';\nimport useMutationObserver from '../_util/useMutationObserver';\nimport { TdWatermarkProps } from './type';\nimport { watermarkDefaultProps as defaultProps } from './defaultProps';\n\nexport interface WatermarkProps extends TdWatermarkProps, StyledProps {}\n\nconst Watermark: React.FC<WatermarkProps> = ({\n  alpha = defaultProps.alpha,\n  x = 200,\n  y = 210,\n  width = 120,\n  height = 60,\n  rotate: tempRotate = defaultProps.rotate,\n  zIndex = 10,\n  lineSpace = defaultProps.lineSpace,\n  isRepeat = defaultProps.isRepeat,\n  removable = defaultProps.removable,\n  movable = defaultProps.movable,\n  moveInterval = defaultProps.moveInterval,\n  offset = [],\n  content,\n  children,\n  watermarkContent,\n  className,\n  style = {},\n}) => {\n  const { classPrefix } = useConfig();\n\n  let gapX = x;\n  let gapY = y;\n  let rotate = tempRotate;\n  if (movable) {\n    gapX = 0;\n    gapY = 0;\n    rotate = 0;\n  }\n  const clsName = `${classPrefix}-watermark`;\n  const [base64Url, setBase64Url] = useState('');\n  const watermarkRef = useRef<HTMLDivElement>();\n  const offsetLeft = offset[0] || gapX / 2;\n  const offsetTop = offset[1] || gapY / 2;\n\n  useEffect(() => {\n    generateBase64Url(\n      {\n        width,\n        height,\n        rotate,\n        lineSpace,\n        alpha,\n        gapX,\n        gapY,\n        watermarkContent,\n        offsetLeft,\n        offsetTop,\n      },\n      (url) => {\n        setBase64Url(url);\n      },\n    );\n  }, [width, height, rotate, zIndex, lineSpace, alpha, offsetLeft, offsetTop, gapX, gapY, watermarkContent]);\n\n  useMutationObserver(watermarkRef.current, (mutations) => {\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          watermarkRef.current.appendChild(node);\n        });\n      }\n    });\n  });\n\n  const parent = useRef<HTMLElement>();\n  useEffect(() => {\n    parent.current = watermarkRef.current.parentElement;\n    const keyframesStyle = randomMovingStyle();\n    injectStyle(keyframesStyle);\n  }, []);\n\n  useMutationObserver(document.body, (mutations) => {\n    if (removable) return;\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        const removeNodes = mutation.removedNodes;\n        removeNodes.forEach((node) => {\n          const element = node as HTMLElement;\n          if (element === watermarkRef.current) {\n            parent.current.appendChild(element);\n          }\n        });\n      }\n    });\n  });\n\n  return (\n    <div style={{ position: 'relative', overflow: 'hidden' }} className={clsName} ref={watermarkRef}>\n      {children || content}\n      <div\n        className={className}\n        style={{\n          zIndex,\n          position: 'absolute',\n          left: 0,\n          right: 0,\n          top: 0,\n          bottom: 0,\n          width: '100%',\n          height: '100%',\n          backgroundSize: `${gapX + width}px`,\n          pointerEvents: 'none',\n          backgroundRepeat: movable ? 'no-repeat' : isRepeat ? 'repeat' : 'no-repeat',\n          backgroundImage: `url('${base64Url}')`,\n          animation: movable ? `watermark infinite ${(moveInterval * 4) / 60}s` : 'none',\n          ...style,\n        }}\n      />\n    </div>\n  );\n};\n\nexport default Watermark;\n"],"names":["Watermark","alpha","defaultProps","x","y","width","height","rotate","tempRotate","zIndex","lineSpace","isRepeat","removable","movable","moveInterval","offset","content","children","watermarkContent","className","style","useConfig","classPrefix","gapX","gapY","clsName","useState","base64Url","setBase64Url","watermarkRef","useRef","offsetLeft","offsetTop","useEffect","generateBase64Url","url","useMutationObserver","current","mutations","forEach","mutation","type","removeNodes","removedNodes","node","appendChild","parent","parentElement","keyframesStyle","randomMovingStyle","injectStyle","document","body","element","React","createElement","position","overflow","ref","left","right","top","bottom","backgroundSize","pointerEvents","backgroundRepeat","backgroundImage","animation"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,IAAMA,SAAS,GAAG,SAAZA,SAAY,CAmBZ,IAAA,EAAA;AAAA,EAAA,IAAA,UAAA,GAAA,IAAA,CAlBJC,KAkBI;AAAA,MAlBJA,KAkBI,GAAA,UAAA,KAAA,KAAA,CAAA,GAlBIC,qBAAY,CAACD,KAkBjB,GAAA,UAAA;AAAA,MAAA,MAAA,GAAA,IAAA,CAjBJE,CAiBI;MAjBJA,CAiBI,uBAjBA,GAiBA,GAAA,MAAA;AAAA,MAAA,MAAA,GAAA,IAAA,CAhBJC,CAgBI;MAhBJA,CAgBI,uBAhBA,GAgBA,GAAA,MAAA;AAAA,MAAA,UAAA,GAAA,IAAA,CAfJC,KAeI;MAfJA,KAeI,2BAfI,GAeJ,GAAA,UAAA;AAAA,MAAA,WAAA,GAAA,IAAA,CAdJC,MAcI;MAdJA,MAcI,4BAdK,EAcL,GAAA,WAAA;AAAA,MAAA,WAAA,GAAA,IAAA,CAbJC,MAaI;AAAA,MAbIC,UAaJ,GAAA,WAAA,KAAA,KAAA,CAAA,GAbiBN,qBAAY,CAACK,MAa9B,GAAA,WAAA;AAAA,MAAA,WAAA,GAAA,IAAA,CAZJE,MAYI;MAZJA,MAYI,4BAZK,EAYL,GAAA,WAAA;AAAA,MAAA,cAAA,GAAA,IAAA,CAXJC,SAWI;AAAA,MAXJA,SAWI,GAAA,cAAA,KAAA,KAAA,CAAA,GAXQR,qBAAY,CAACQ,SAWrB,GAAA,cAAA;AAAA,MAAA,aAAA,GAAA,IAAA,CAVJC,QAUI;AAAA,MAVJA,QAUI,GAAA,aAAA,KAAA,KAAA,CAAA,GAVOT,qBAAY,CAACS,QAUpB,GAAA,aAAA;AAAA,MAAA,cAAA,GAAA,IAAA,CATJC,SASI;AAAA,MATJA,SASI,GAAA,cAAA,KAAA,KAAA,CAAA,GATQV,qBAAY,CAACU,SASrB,GAAA,cAAA;AAAA,MAAA,YAAA,GAAA,IAAA,CARJC,OAQI;AAAA,MARJA,OAQI,GAAA,YAAA,KAAA,KAAA,CAAA,GARMX,qBAAY,CAACW,OAQnB,GAAA,YAAA;AAAA,MAAA,iBAAA,GAAA,IAAA,CAPJC,YAOI;AAAA,MAPJA,YAOI,GAAA,iBAAA,KAAA,KAAA,CAAA,GAPWZ,qBAAY,CAACY,YAOxB,GAAA,iBAAA;AAAA,MAAA,WAAA,GAAA,IAAA,CANJC,MAMI;MANJA,MAMI,4BANK,EAML,GAAA,WAAA;MALJC,OAKI,QALJA,OAKI;MAJJC,QAII,QAJJA,QAII;MAHJC,gBAGI,QAHJA,gBAGI;MAFJC,SAEI,QAFJA,SAEI;AAAA,MAAA,UAAA,GAAA,IAAA,CADJC,KACI;MADJA,KACI,2BADI,EACJ,GAAA,UAAA,CAAA;;AACJ,EAAA,IAAA,UAAA,GAAwBC,SAAS,EAAjC;MAAQC,WAAR,cAAQA,WAAR,CAAA;;EACA,IAAIC,IAAI,GAAGpB,CAAX,CAAA;EACA,IAAIqB,IAAI,GAAGpB,CAAX,CAAA;EACA,IAAIG,MAAM,GAAGC,UAAb,CAAA;;AACA,EAAA,IAAIK,OAAJ,EAAa;AACXU,IAAAA,IAAI,GAAG,CAAP,CAAA;AACAC,IAAAA,IAAI,GAAG,CAAP,CAAA;AACAjB,IAAAA,MAAM,GAAG,CAAT,CAAA;AACD,GAAA;;EACD,IAAMkB,OAAO,GAAMH,EAAAA,CAAAA,MAAAA,CAAAA,WAAN,EAAb,YAAA,CAAA,CAAA;;EACA,IAAkCI,SAAAA,GAAAA,QAAQ,CAAC,EAAD,CAA1C;AAAA,MAAA,UAAA,GAAA,cAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,SAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAkBC,YAAlB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAMC,YAAY,GAAGC,MAAM,EAA3B,CAAA;EACA,IAAMC,UAAU,GAAGhB,MAAM,CAAC,CAAD,CAAN,IAAaQ,IAAI,GAAG,CAAvC,CAAA;EACA,IAAMS,SAAS,GAAGjB,MAAM,CAAC,CAAD,CAAN,IAAaS,IAAI,GAAG,CAAtC,CAAA;AACAS,EAAAA,SAAS,CAAC,YAAM;AACdC,IAAAA,iBAAiB,CAAC;AAChB7B,MAAAA,KAAK,EAALA,KADgB;AAEhBC,MAAAA,MAAM,EAANA,MAFgB;AAGhBC,MAAAA,MAAM,EAANA,MAHgB;AAIhBG,MAAAA,SAAS,EAATA,SAJgB;AAKhBT,MAAAA,KAAK,EAALA,KALgB;AAMhBsB,MAAAA,IAAI,EAAJA,IANgB;AAOhBC,MAAAA,IAAI,EAAJA,IAPgB;AAQhBN,MAAAA,gBAAgB,EAAhBA,gBARgB;AAShBa,MAAAA,UAAU,EAAVA,UATgB;AAUhBC,MAAAA,SAAS,EAATA,SAAAA;KAVe,EAWd,UAACG,GAAD,EAAS;MACVP,YAAY,CAACO,GAAD,CAAZ,CAAA;AACD,KAbgB,CAAjB,CAAA;GADO,EAeN,CAAC9B,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,EAAwBE,MAAxB,EAAgCC,SAAhC,EAA2CT,KAA3C,EAAkD8B,UAAlD,EAA8DC,SAA9D,EAAyET,IAAzE,EAA+EC,IAA/E,EAAqFN,gBAArF,CAfM,CAAT,CAAA;AAgBAkB,EAAAA,qBAAmB,CAACP,YAAY,CAACQ,OAAd,EAAuB,UAACC,SAAD,EAAe;AACvD,IAAA,IAAI1B,SAAJ,EACE,OAAA;AACF0B,IAAAA,SAAS,CAACC,OAAV,CAAkB,UAACC,QAAD,EAAc;AAC9B,MAAA,IAAIA,QAAQ,CAACC,IAAT,KAAkB,WAAtB,EAAmC;AACjC,QAAA,IAAMC,WAAW,GAAGF,QAAQ,CAACG,YAA7B,CAAA;AACAD,QAAAA,WAAW,CAACH,OAAZ,CAAoB,UAACK,IAAD,EAAU;AAC5Bf,UAAAA,YAAY,CAACQ,OAAb,CAAqBQ,WAArB,CAAiCD,IAAjC,CAAA,CAAA;SADF,CAAA,CAAA;AAGD,OAAA;KANH,CAAA,CAAA;AAQD,GAXkB,CAAnB,CAAA;EAYA,IAAME,MAAM,GAAGhB,MAAM,EAArB,CAAA;AACAG,EAAAA,SAAS,CAAC,YAAM;AACda,IAAAA,MAAM,CAACT,OAAP,GAAiBR,YAAY,CAACQ,OAAb,CAAqBU,aAAtC,CAAA;IACA,IAAMC,cAAc,GAAGC,iBAAiB,EAAxC,CAAA;IACAC,WAAW,CAACF,cAAD,CAAX,CAAA;GAHO,EAIN,EAJM,CAAT,CAAA;AAKAZ,EAAAA,qBAAmB,CAACe,QAAQ,CAACC,IAAV,EAAgB,UAACd,SAAD,EAAe;AAChD,IAAA,IAAI1B,SAAJ,EACE,OAAA;AACF0B,IAAAA,SAAS,CAACC,OAAV,CAAkB,UAACC,QAAD,EAAc;AAC9B,MAAA,IAAIA,QAAQ,CAACC,IAAT,KAAkB,WAAtB,EAAmC;AACjC,QAAA,IAAMC,WAAW,GAAGF,QAAQ,CAACG,YAA7B,CAAA;AACAD,QAAAA,WAAW,CAACH,OAAZ,CAAoB,UAACK,IAAD,EAAU;UAC5B,IAAMS,OAAO,GAAGT,IAAhB,CAAA;;AACA,UAAA,IAAIS,OAAO,KAAKxB,YAAY,CAACQ,OAA7B,EAAsC;AACpCS,YAAAA,MAAM,CAACT,OAAP,CAAeQ,WAAf,CAA2BQ,OAA3B,CAAA,CAAA;AACD,WAAA;SAJH,CAAA,CAAA;AAMD,OAAA;KATH,CAAA,CAAA;AAWD,GAdkB,CAAnB,CAAA;AAeA,EAAA,sBAAuBC,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AAChDnC,IAAAA,KAAK,EAAE;AAAEoC,MAAAA,QAAQ,EAAE,UAAZ;AAAwBC,MAAAA,QAAQ,EAAE,QAAA;KADO;AAEhDtC,IAAAA,SAAS,EAAEM,OAFqC;AAGhDiC,IAAAA,GAAG,EAAE7B,YAAAA;GAHgB,EAIpBZ,QAAQ,IAAID,OAJQ,iBAIiBsC,KAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AACjEpC,IAAAA,SAAS,EAATA,SADiE;IAEjEC,KAAK,EAAA,aAAA,CAAA;AACHX,MAAAA,MAAM,EAANA,MADG;AAEH+C,MAAAA,QAAQ,EAAE,UAFP;AAGHG,MAAAA,IAAI,EAAE,CAHH;AAIHC,MAAAA,KAAK,EAAE,CAJJ;AAKHC,MAAAA,GAAG,EAAE,CALF;AAMHC,MAAAA,MAAM,EAAE,CANL;AAOHzD,MAAAA,KAAK,EAAE,MAPJ;AAQHC,MAAAA,MAAM,EAAE,MARL;AASHyD,MAAAA,cAAc,EAAKxC,EAAAA,CAAAA,MAAAA,CAAAA,IAAI,GAAGlB,KAAZ,EATX,IAAA,CAAA;AAUH2D,MAAAA,aAAa,EAAE,MAVZ;MAWHC,gBAAgB,EAAEpD,OAAO,GAAG,WAAH,GAAiBF,QAAQ,GAAG,QAAH,GAAc,WAX7D;MAYHuD,eAAe,EAAA,OAAA,CAAA,MAAA,CAAUvC,SAAV,EAZZ,IAAA,CAAA;MAaHwC,SAAS,EAAEtD,OAAO,GAAyBC,qBAAAA,CAAAA,MAAAA,CAAAA,YAAY,GAAG,CAAf,GAAmB,EAA5C,EAAoD,GAAA,CAAA,GAAA,MAAA;AAbnE,KAAA,EAcAM,KAdA,CAAA;AAF4D,GAA3B,CAJjB,CAAvB,CAAA;AAuBD;;;;"}
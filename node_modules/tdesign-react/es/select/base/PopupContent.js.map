{"version":3,"file":"PopupContent.js","sources":["../../../src/select/base/PopupContent.tsx"],"sourcesContent":["import React, { Children, Ref, forwardRef, isValidElement, cloneElement } from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { getSelectValueArr } from '../util/helper';\nimport { TdSelectProps, SelectValue, TdOptionProps } from '../type';\nimport useConfig from '../../_util/useConfig';\nimport Option, { SelectOptionProps } from './Option';\n\ntype OptionsType = TdOptionProps[];\n\ninterface SelectPopupProps\n  extends Pick<\n    TdSelectProps,\n    | 'value'\n    | 'size'\n    | 'multiple'\n    | 'empty'\n    | 'options'\n    | 'max'\n    | 'loadingText'\n    | 'loading'\n    | 'valueType'\n    | 'keys'\n    | 'panelTopContent'\n    | 'panelBottomContent'\n  > {\n  onChange?: (value: SelectValue, context?: { label?: string | number; restData?: Record<string, any> }) => void;\n  /**\n   * 是否展示popup\n   */\n  showPopup: boolean;\n  /**\n   * 控制popup展示的函数\n   */\n  setShowPopup: (show: boolean) => void;\n  children?: React.ReactNode;\n}\n\nconst PopupContent = forwardRef((props: SelectPopupProps, ref: Ref<HTMLDivElement>) => {\n  const {\n    onChange,\n    value,\n    size,\n    max,\n    multiple,\n    showPopup,\n    setShowPopup,\n    options,\n    empty,\n    loadingText,\n    loading,\n    valueType,\n    children,\n    keys,\n    panelTopContent,\n    panelBottomContent,\n  } = props;\n\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('select');\n  const emptyText = t(local.empty);\n\n  const { classPrefix } = useConfig();\n  if (!children && !props.options) return null;\n\n  const onSelect: SelectOptionProps['onSelect'] = (selectedValue, { label, selected, restData }) => {\n    const isValObj = valueType === 'object';\n    let objVal = {};\n    if (isValObj) {\n      objVal = { ...restData };\n      if (!keys?.label) {\n        Object.assign(objVal, { label });\n      }\n      if (!keys?.value) {\n        Object.assign(objVal, { value: selectedValue });\n      }\n    }\n\n    if (!Object.keys(objVal).length) {\n      Object.assign(objVal, { [keys?.label || 'label']: label, [keys?.value || 'value']: selectedValue });\n    }\n    if (multiple) {\n      // calc multiple select values\n      const values = getSelectValueArr(value, selectedValue, selected, valueType, keys, objVal);\n      onChange(values, { label });\n    } else {\n      // calc single select value\n      const selectVal = valueType === 'object' ? objVal : selectedValue;\n\n      onChange(selectVal, { label });\n      setShowPopup(!showPopup);\n    }\n  };\n\n  const childrenWithProps = Children.map(children, (child) => {\n    if (isValidElement(child)) {\n      const addedProps = { size, max, multiple, selectedValue: value, onSelect };\n      return cloneElement(child, { ...addedProps });\n    }\n    return child;\n  });\n\n  // 渲染 options\n  const renderOptions = () => {\n    if (options) {\n      // 通过options API配置的\n      return (\n        <ul className={`${classPrefix}-select__list`}>\n          {(options as OptionsType).map(({ value: optionValue, label, disabled, ...restData }, index) => (\n            <Option\n              key={index}\n              max={max}\n              label={label}\n              value={optionValue}\n              onSelect={onSelect}\n              selectedValue={value}\n              multiple={multiple}\n              size={size}\n              disabled={disabled}\n              restData={restData}\n              keys={keys}\n            />\n          ))}\n        </ul>\n      );\n    }\n    return <ul className={`${classPrefix}-select__list`}>{childrenWithProps}</ul>;\n  };\n\n  const isEmpty = (Array.isArray(childrenWithProps) && !childrenWithProps.length) || (options && options.length === 0);\n\n  return (\n    <div\n      ref={ref}\n      className={classNames(`${classPrefix}-select__dropdown-inner`, {\n        [`${classPrefix}-select__dropdown-inner--size-s`]: size === 'small',\n        [`${classPrefix}-select__dropdown-inner--size-l`]: size === 'large',\n        [`${classPrefix}-select__dropdown-inner--size-m`]: size === 'medium',\n      })}\n    >\n      {panelTopContent}\n      {isEmpty && <div className={`${classPrefix}-select__empty`}>{empty ? empty : <p>{emptyText}</p>}</div>}\n      {!isEmpty && loading && <div className={`${classPrefix}-select__loading-tips`}>{loadingText}</div>}\n      {!isEmpty && !loading && renderOptions()}\n      {panelBottomContent}\n    </div>\n  );\n});\n\nexport default PopupContent;\n"],"names":["PopupContent","forwardRef","props","ref","onChange","value","size","max","multiple","showPopup","setShowPopup","options","empty","loadingText","loading","valueType","children","keys","panelTopContent","panelBottomContent","useLocaleReceiver","local","t","emptyText","useConfig","classPrefix","onSelect","selectedValue","label","selected","restData","isValObj","objVal","Object","assign","length","values","getSelectValueArr","selectVal","childrenWithProps","Children","map","child","isValidElement","addedProps","cloneElement","renderOptions","React","createElement","className","index","optionValue","disabled","Option","key","isEmpty","Array","isArray","classNames"],"mappings":"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"}
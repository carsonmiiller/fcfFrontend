{"version":3,"file":"Loading.js","sources":["../../src/loading/Loading.tsx"],"sourcesContent":["import React, { useState, useEffect, FC, useMemo, CSSProperties } from 'react';\nimport classnames from 'classnames';\n\nimport { addClass, canUseDocument, removeClass } from '../_util/dom';\nimport useConfig from '../_util/useConfig';\nimport { StyledProps } from '../common';\nimport { TdLoadingProps } from './type';\nimport Portal from '../common/Portal';\nimport Gradient from './gradient';\nimport { loadingDefaultProps } from './defaultProps';\n\nexport interface LoadingProps extends TdLoadingProps, StyledProps {}\n\nconst Loading: FC<LoadingProps> = (props) => {\n  const {\n    attach,\n    indicator,\n    text,\n    loading,\n    size,\n    delay,\n    fullscreen,\n    preventScrollThrough,\n    showOverlay,\n    content,\n    children,\n    inheritColor,\n    zIndex,\n    className,\n    style,\n  } = props;\n\n  const [showLoading, setShowLoading] = useState(delay ? false : loading);\n\n  const { classPrefix } = useConfig();\n\n  const name = `${classPrefix}-loading`;\n  const centerClass = `${classPrefix}-loading--center`;\n  const inheritColorClass = `${classPrefix}-loading--inherit-color`;\n  const fullClass = `${classPrefix}-loading--full`;\n  const fullscreenClass = `${classPrefix}-loading__fullscreen`;\n  const lockClass = `${classPrefix}-loading--lock`;\n  const overlayClass = `${classPrefix}-loading__overlay`;\n  const relativeClass = `${classPrefix}-loading__parent`;\n  const textClass = `${classPrefix}-loading__text`;\n\n  useEffect(() => {\n    let timer: NodeJS.Timeout;\n\n    if (delay && loading) {\n      timer = setTimeout(() => {\n        setShowLoading(loading);\n      }, delay);\n    } else {\n      setShowLoading(loading);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [delay, loading]);\n\n  const calcStyles = useMemo(() => {\n    const styles: CSSProperties = {};\n\n    if (zIndex !== undefined) {\n      styles.zIndex = zIndex;\n    }\n\n    if (!['small', 'medium', 'large'].includes(size)) {\n      styles.fontSize = size;\n    }\n\n    return style ? { ...styles, ...style } : styles;\n  }, [size, zIndex, style]);\n\n  const sizeMap = {\n    large: `${classPrefix}-size-l`,\n    small: `${classPrefix}-size-s`,\n    medium: `${classPrefix}-size-m`,\n  };\n\n  const baseClasses = classnames(\n    centerClass,\n    sizeMap[size],\n    {\n      [inheritColorClass]: inheritColor,\n    },\n    className,\n  );\n\n  useEffect(() => {\n    if (preventScrollThrough && fullscreen && canUseDocument && loading) {\n      addClass(document.body, lockClass);\n    }\n    return () => {\n      removeClass(document.body, lockClass);\n    };\n  }, [loading, preventScrollThrough, fullscreen, lockClass]);\n\n  const commonContent = () => {\n    let renderIndicator = <Gradient />;\n\n    if (indicator && typeof indicator !== 'boolean') {\n      renderIndicator = indicator as JSX.Element;\n    }\n    return (\n      <>\n        {indicator ? renderIndicator : null}\n        {text ? <div className={textClass}>{text}</div> : null}\n      </>\n    );\n  };\n\n  if (fullscreen) {\n    return loading ? (\n      <div className={classnames(name, fullscreenClass, centerClass, overlayClass)} style={calcStyles}>\n        <div className={baseClasses}>{commonContent()}</div>\n      </div>\n    ) : null;\n  }\n\n  if (content || children) {\n    return (\n      <div className={relativeClass}>\n        {content || children}\n        {showLoading ? (\n          <div\n            className={classnames(name, baseClasses, fullClass, {\n              [overlayClass]: showOverlay,\n            })}\n            style={calcStyles}\n          >\n            {commonContent()}\n          </div>\n        ) : null}\n      </div>\n    );\n  }\n  if (attach) {\n    return (\n      <Portal attach={attach}>\n        {loading ? (\n          <div className={classnames(name, baseClasses, fullClass, { [overlayClass]: showOverlay })} style={calcStyles}>\n            {commonContent()}\n          </div>\n        ) : null}\n      </Portal>\n    );\n  }\n\n  return loading ? (\n    <div className={classnames(name, baseClasses)} style={calcStyles}>\n      {commonContent()}\n    </div>\n  ) : null;\n};\n\nLoading.displayName = 'Loading';\nLoading.defaultProps = loadingDefaultProps;\n\nexport default Loading;\n"],"names":["Loading","props","attach","indicator","text","loading","size","delay","fullscreen","preventScrollThrough","showOverlay","content","children","inheritColor","zIndex","className","style","useState","showLoading","setShowLoading","useConfig","classPrefix","name","centerClass","inheritColorClass","fullClass","fullscreenClass","lockClass","overlayClass","relativeClass","textClass","useEffect","timer","setTimeout","clearTimeout","calcStyles","useMemo","styles","includes","fontSize","sizeMap","large","small","medium","baseClasses","classnames","canUseDocument","addClass","document","body","removeClass","commonContent","renderIndicator","React","createElement","Gradient","Fragment","Portal","displayName","defaultProps","loadingDefaultProps"],"mappings":"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"}
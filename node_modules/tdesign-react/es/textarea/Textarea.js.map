{"version":3,"file":"Textarea.js","sources":["../../src/textarea/Textarea.tsx"],"sourcesContent":["import React, { forwardRef, useState, useEffect, useMemo, useRef, useCallback, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport { TdTextareaProps } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport useControlled from '../hooks/useControlled';\nimport { getCharacterLength } from '../_util/helper';\nimport calcTextareaHeight from '../_common/js/utils/calcTextareaHeight';\nimport { textareaDefaultProps } from './defaultProps';\n\nexport interface TextareaProps extends TdTextareaProps, StyledProps {}\nexport interface TextareaRefInterface extends React.RefObject<unknown> {\n  currentElement: HTMLDivElement;\n  textareaElement: HTMLTextAreaElement;\n}\n\nconst Textarea = forwardRef((props: TextareaProps, ref: TextareaRefInterface) => {\n  const {\n    disabled,\n    maxlength,\n    maxcharacter,\n    className,\n    readonly,\n    autofocus,\n    style,\n    onKeydown = noop,\n    onKeypress = noop,\n    onKeyup = noop,\n    autosize,\n    status,\n    tips,\n    ...otherProps\n  } = props;\n\n  const [value = '', setValue] = useControlled(props, 'value', props.onChange);\n  const [isFocused, setIsFocused] = useState(false);\n  const [textareaStyle, setTextareaStyle] = useState({});\n  const hasMaxcharacter = typeof maxcharacter !== 'undefined';\n  const textareaRef: React.RefObject<HTMLTextAreaElement> = useRef();\n  const wrapperRef: React.RefObject<HTMLDivElement> = useRef();\n  const currentLength = useMemo(() => (value ? String(value).length : 0), [value]);\n  const characterLength = useMemo(() => {\n    const characterInfo = getCharacterLength(String(value), maxcharacter);\n    if (typeof characterInfo === 'object') return characterInfo.length;\n    return characterInfo;\n  }, [value, maxcharacter]);\n\n  const { classPrefix } = useConfig();\n\n  const textareaPropsNames = Object.keys(otherProps).filter((key) => !/^on[A-Z]/.test(key));\n  const textareaProps = textareaPropsNames.reduce(\n    (textareaProps, key) => Object.assign(textareaProps, { [key]: props[key] }),\n    {},\n  );\n  const eventPropsNames = Object.keys(otherProps).filter((key) => /^on[A-Z]/.test(key));\n  const eventProps = eventPropsNames.reduce((eventProps, key) => {\n    Object.assign(eventProps, {\n      [key]: (e) => {\n        if (disabled) return;\n        if (key === 'onFocus') setIsFocused(true);\n        if (key === 'onBlur') setIsFocused(false);\n        props[key](e.currentTarget.value, { e });\n      },\n    });\n    return eventProps;\n  }, {});\n\n  const textareaClassNames = classNames(className, `${classPrefix}-textarea__inner`, {\n    [`${classPrefix}-is-${status}`]: status,\n    [`${classPrefix}-is-disabled`]: disabled,\n    [`${classPrefix}-is-focused`]: isFocused,\n    [`${classPrefix}-resize-none`]: typeof autosize === 'object',\n  });\n\n  const adjustTextareaHeight = useCallback(() => {\n    if (autosize === true) {\n      setTextareaStyle(calcTextareaHeight(textareaRef.current));\n    } else if (typeof autosize === 'object') {\n      setTextareaStyle(calcTextareaHeight(textareaRef.current, autosize?.minRows, autosize?.maxRows));\n    }\n  }, [autosize]);\n\n  function inputValueChangeHandle(e: React.FormEvent<HTMLTextAreaElement>) {\n    const { target } = e;\n    let val = (target as HTMLInputElement).value;\n    if (maxcharacter && maxcharacter >= 0) {\n      const stringInfo = getCharacterLength(val, maxcharacter);\n      val = typeof stringInfo === 'object' && stringInfo.characters;\n    }\n    setValue(val, { e });\n  }\n\n  useEffect(() => {\n    // 当未设置 autosize 时，需要将 textarea 的 height 设置为 auto，以支持原生的 textarea rows 属性\n    if (autosize === false) {\n      setTextareaStyle({ height: 'auto', minHeight: 'auto' });\n    }\n  }, [adjustTextareaHeight, autosize]);\n\n  useEffect(() => {\n    adjustTextareaHeight();\n  }, [adjustTextareaHeight, value]);\n\n  useImperativeHandle(ref as TextareaRefInterface, () => ({\n    currentElement: wrapperRef.current,\n    textareaElement: textareaRef.current,\n  }));\n\n  return (\n    <div style={style} ref={wrapperRef} className={classNames(className, `${classPrefix}-textarea`)}>\n      <textarea\n        {...textareaProps}\n        {...eventProps}\n        value={value}\n        style={textareaStyle}\n        className={textareaClassNames}\n        readOnly={readonly}\n        autoFocus={autofocus}\n        disabled={disabled}\n        maxLength={maxlength}\n        onChange={inputValueChangeHandle}\n        onKeyDown={(e) => onKeydown(e.currentTarget.value, { e })}\n        onKeyPress={(e) => onKeypress(e.currentTarget.value, { e })}\n        onKeyUp={(e) => onKeyup(e.currentTarget.value, { e })}\n        ref={textareaRef}\n      />\n      {hasMaxcharacter ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${characterLength}/${maxcharacter}`}</span>\n      ) : null}\n      {!hasMaxcharacter && maxlength ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${currentLength}/${maxlength}`}</span>\n      ) : null}\n      {tips ? (\n        <div\n          className={classNames(`${classPrefix}-textarea__tips`, {\n            [`${classPrefix}-textarea__tips--normal`]: !status,\n            [`${classPrefix}-textarea__tips--${status}`]: status,\n          })}\n        >\n          {tips}\n        </div>\n      ) : null}\n    </div>\n  );\n});\n\nTextarea.displayName = 'Textarea';\nTextarea.defaultProps = textareaDefaultProps;\n\nexport default Textarea;\n"],"names":["Textarea","forwardRef","props","ref","disabled","maxlength","maxcharacter","className","readonly","autofocus","style","onKeydown","noop","onKeypress","onKeyup","autosize","status","tips","otherProps","useControlled","onChange","value","setValue","useState","isFocused","setIsFocused","textareaStyle","setTextareaStyle","hasMaxcharacter","textareaRef","useRef","wrapperRef","currentLength","useMemo","String","length","characterLength","characterInfo","getCharacterLength","useConfig","classPrefix","textareaPropsNames","Object","keys","filter","key","test","textareaProps","reduce","textareaProps2","assign","eventPropsNames","eventProps","eventProps2","e","currentTarget","textareaClassNames","classNames","adjustTextareaHeight","useCallback","calcTextareaHeight","current","minRows","maxRows","inputValueChangeHandle","target","val","stringInfo","characters","useEffect","height","minHeight","useImperativeHandle","currentElement","textareaElement","React","createElement","readOnly","autoFocus","maxLength","onKeyDown","onKeyPress","onKeyUp","displayName","defaultProps","textareaDefaultProps"],"mappings":"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"}
{"version":3,"file":"Form.js","sources":["../../src/form/Form.tsx"],"sourcesContent":["import React, { useRef, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport noop from '../_util/noop';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport type { TdFormProps, FormInstanceFunctions } from './type';\nimport useInstance from './hooks/useInstance';\nimport { StyledProps } from '../common';\nimport FormContext from './FormContext';\nimport FormItem from './FormItem';\nimport FormList from './FormList';\nimport { formDefaultProps } from './defaultProps';\n\nexport interface FormProps extends TdFormProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nexport interface FormRefInterface extends React.RefObject<unknown>, FormInstanceFunctions {\n  currentElement: HTMLFormElement;\n}\n\nconst Form = forwardRefWithStatics(\n  (props: FormProps, ref) => {\n    const { classPrefix, form: globalFormConfig } = useConfig();\n\n    const {\n      style,\n      className,\n      labelWidth = '100px',\n      statusIcon,\n      labelAlign = 'right',\n      layout = 'vertical',\n      colon = false,\n      requiredMark = globalFormConfig.requiredMark,\n      scrollToFirstError,\n      showErrorMessage = true,\n      resetType = 'empty',\n      rules,\n      errorMessage = globalFormConfig.errorMessage,\n      preventSubmitDefault = true,\n      disabled,\n      children,\n      onReset,\n      onValuesChange = noop,\n    } = props;\n\n    const formClass = classNames(className, `${classPrefix}-form`, {\n      [`${classPrefix}-form-inline`]: layout === 'inline',\n    });\n\n    const formRef: React.RefObject<HTMLFormElement> = useRef();\n    const formMapRef = useRef(new Map()); // 收集所有 formItem 实例\n\n    const {\n      submit,\n      reset,\n      getFieldValue,\n      getFieldsValue,\n      setFieldsValue,\n      setFields,\n      validate,\n      clearValidate,\n      setValidateMessage,\n    } = useInstance(props, formRef, formMapRef);\n\n    useImperativeHandle(ref as FormRefInterface, () => ({\n      currentElement: formRef.current,\n      submit,\n      reset,\n      getFieldValue,\n      getFieldsValue,\n      setFieldsValue,\n      setFields,\n      validate,\n      clearValidate,\n      setValidateMessage,\n    }));\n\n    function onResetHandler(e: React.FormEvent<HTMLFormElement>) {\n      if (preventSubmitDefault) {\n        e.preventDefault?.();\n        e.stopPropagation?.();\n      }\n      [...formMapRef.current.values()].forEach((formItemRef) => {\n        formItemRef?.current.resetField();\n      });\n      onReset?.({ e });\n    }\n\n    function onFormItemValueChange(changedValue: Record<string, unknown>) {\n      const allFields = getFieldsValue(true);\n      onValuesChange(changedValue, allFields);\n    }\n\n    function onKeyDownHandler(e: React.KeyboardEvent<HTMLFormElement>) {\n      if ((e.target as Element).tagName.toLowerCase() === 'textarea') return;\n      if (preventSubmitDefault && e.key === 'Enter') {\n        e.preventDefault?.();\n        e.stopPropagation?.();\n      }\n    }\n\n    return (\n      <FormContext.Provider\n        value={{\n          labelWidth,\n          statusIcon,\n          labelAlign,\n          layout,\n          colon,\n          requiredMark,\n          errorMessage,\n          showErrorMessage,\n          scrollToFirstError,\n          resetType,\n          rules,\n          disabled,\n          formMapRef,\n          onFormItemValueChange,\n        }}\n      >\n        <form\n          ref={formRef}\n          style={style}\n          className={formClass}\n          onSubmit={submit}\n          onReset={onResetHandler}\n          onKeyDown={onKeyDownHandler}\n        >\n          {children}\n        </form>\n      </FormContext.Provider>\n    );\n  },\n  { FormItem, FormList },\n);\n\nForm.displayName = 'Form';\nForm.defaultProps = formDefaultProps;\n\nexport default Form;\n"],"names":["Form","forwardRefWithStatics","props","ref","useConfig","classPrefix","globalFormConfig","form","style","className","labelWidth","statusIcon","labelAlign","layout","colon","requiredMark","scrollToFirstError","showErrorMessage","resetType","rules","errorMessage","preventSubmitDefault","disabled","children","onReset","onValuesChange","noop","formClass","classNames","formRef","useRef","formMapRef","Map","useInstance","submit","reset","getFieldValue","getFieldsValue","setFieldsValue","setFields","validate","clearValidate","setValidateMessage","useImperativeHandle","currentElement","current","onResetHandler","e","preventDefault","stopPropagation","values","forEach","formItemRef","resetField","onFormItemValueChange","changedValue","allFields","onKeyDownHandler","target","tagName","toLowerCase","key","React","createElement","FormContext","Provider","value","onSubmit","onKeyDown","FormItem","FormList","displayName","defaultProps","formDefaultProps"],"mappings":"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"}
{"version":3,"file":"single-file.js","sources":["../../../src/upload/themes/single-file.tsx"],"sourcesContent":["import React, { FC, useCallback } from 'react';\nimport classNames from 'classnames';\nimport { CloseCircleFilledIcon, ErrorCircleFilledIcon } from 'tdesign-icons-react';\nimport Loading from '../../loading';\nimport { UploadFile, UploadRemoveContext } from '../type';\nimport useConfig from '../../_util/useConfig';\n\nexport interface SingleFileProps {\n  file?: UploadFile;\n  display?: string;\n  placeholder?: string;\n  onRemove?: (context: UploadRemoveContext) => void;\n  showUploadProgress: boolean;\n}\n\nconst SingleFile: FC<SingleFileProps> = (props) => {\n  const { display = 'file', onRemove, file, showUploadProgress } = props;\n  const { classPrefix } = useConfig();\n\n  const fileClass = classNames(`${classPrefix}-upload__single`, `${classPrefix}-upload__single-${display}`);\n\n  const showProgress = showUploadProgress && file && file.status !== 'success';\n\n  const inputName = file?.name;\n\n  const handleRemove = useCallback(\n    (e) => {\n      onRemove?.({\n        e,\n        file,\n        index: 0,\n      });\n    },\n    [file, onRemove],\n  );\n\n  const renderProgress = useCallback(() => {\n    if (file?.status === 'fail') {\n      return <ErrorCircleFilledIcon />;\n    }\n\n    return (\n      <div className={`${classPrefix}-upload__single-progress`}>\n        <Loading loading={true} size=\"small\" />\n        <span className={`${classPrefix}-upload__single-percent`}>{Math.min(file?.percent || 0, 99)}%</span>\n      </div>\n    );\n  }, [classPrefix, file]);\n\n  // 文本型预览\n  const renderFilePreviewAsText = useCallback(() => {\n    if (!inputName) return;\n    return (\n      <div className={`${classPrefix}-upload__single-display-text ${classPrefix}-upload__display-text--margin`}>\n        <span className={`${classPrefix}-upload__single-name`}>{inputName}</span>\n        {showProgress ? (\n          renderProgress()\n        ) : (\n          <CloseCircleFilledIcon className={`${classPrefix}-upload__icon-delete`} onClick={handleRemove} />\n        )}\n      </div>\n    );\n  }, [classPrefix, inputName, renderProgress, showProgress, handleRemove]);\n\n  return (\n    <div className={fileClass}>\n      {props.children}\n      {display === 'file' && renderFilePreviewAsText()}\n    </div>\n  );\n};\n\nexport default SingleFile;\n"],"names":["SingleFile","props","display","onRemove","file","showUploadProgress","useConfig","classPrefix","fileClass","classNames","showProgress","status","inputName","name","handleRemove","useCallback","e","index","renderProgress","React","createElement","ErrorCircleFilledIcon","className","Loading","loading","size","Math","min","percent","renderFilePreviewAsText","CloseCircleFilledIcon","onClick","children"],"mappings":"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"}
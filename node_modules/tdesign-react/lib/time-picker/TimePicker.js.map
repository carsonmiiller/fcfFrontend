{"version":3,"file":"TimePicker.js","sources":["../../src/time-picker/TimePicker.tsx"],"sourcesContent":["import React, { useState, Ref, useEffect } from 'react';\nimport classNames from 'classnames';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon } from 'tdesign-icons-react';\n\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../_util/useConfig';\nimport noop from '../_util/noop';\n\nimport SelectInput from '../select-input';\nimport TimeRangePicker from './TimeRangePicker';\nimport TimePickerPanel from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\n\nimport { StyledProps } from '../common';\nimport { TdTimePickerProps } from './type';\nimport { formatInputValue, validateInputValue } from '../_common/js/time-picker/utils';\nimport { DEFAULT_STEPS, DEFAULT_FORMAT } from '../_common/js/time-picker/const';\nimport { timePickerDefaultProps } from './defaultProps';\n\n// https://github.com/iamkun/dayjs/issues/1552\ndayjs.extend(customParseFormat);\n\nexport interface TimePickerProps extends TdTimePickerProps, StyledProps {}\n\nconst TimePicker = forwardRefWithStatics(\n  (props: TimePickerProps, ref: Ref<HTMLDivElement>) => {\n    const TEXT_CONFIG = useTimePickerTextConfig();\n    const {\n      allowInput,\n      className,\n      clearable,\n      disabled,\n      style,\n      format = DEFAULT_FORMAT,\n      hideDisabledTime = true,\n      steps = DEFAULT_STEPS,\n      placeholder = TEXT_CONFIG.placeholder,\n      disableTime,\n      onBlur = noop,\n      onClose = noop,\n      onFocus = noop,\n      onOpen = noop,\n    } = props;\n\n    const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n    const [isPanelShowed, setPanelShow] = useState(false);\n    const [currentValue, setCurrentValue] = useState('');\n\n    const { classPrefix } = useConfig();\n    const name = `${classPrefix}-time-picker`;\n    const inputClasses = classNames(`${name}__group`, {\n      [`${classPrefix}-is-focused`]: isPanelShowed,\n    });\n\n    const handleShowPopup = (visible: boolean, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) => {\n      setPanelShow(visible);\n      visible ? onOpen(context) : onClose(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: React.MouseEvent }) => {\n      const { e } = context;\n      e.stopPropagation();\n      setCurrentValue('');\n      onChange(null);\n    };\n\n    const handleInputChange = (value: string) => {\n      setCurrentValue(value);\n    };\n\n    const handleInputBlur = (value: string, { e }: { e: React.FocusEvent<HTMLInputElement> }) => {\n      if (allowInput) {\n        const isValidTime = validateInputValue(currentValue, format);\n        if (isValidTime) {\n          onChange(formatInputValue(currentValue, format));\n        }\n      }\n      onBlur({ value, e });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue, format);\n      if (isValidTime) onChange(currentValue);\n      setPanelShow(false);\n    };\n\n    useEffect(() => {\n      setCurrentValue(isPanelShowed ? value ?? '' : '');\n    }, [isPanelShowed, value]);\n\n    return (\n      <div className={classNames(name, className)} ref={ref} style={style}>\n        <SelectInput\n          onFocus={onFocus}\n          onClear={handleClear}\n          disabled={disabled}\n          clearable={clearable}\n          allowInput={allowInput}\n          className={inputClasses}\n          suffixIcon={<TimeIcon />}\n          popupVisible={isPanelShowed}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!value ? placeholder : undefined}\n          value={isPanelShowed ? currentValue : value ?? undefined}\n          inputValue={isPanelShowed ? currentValue : value ?? undefined}\n          inputProps={props.inputProps}\n          popupProps={{ overlayStyle: { width: 'auto' }, ...props.popupProps }}\n          panel={\n            <TimePickerPanel\n              steps={steps}\n              format={format}\n              value={currentValue}\n              isFooterDisplay={true}\n              disableTime={disableTime}\n              onChange={setCurrentValue}\n              hideDisabledTime={hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n            />\n          }\n        />\n      </div>\n    );\n  },\n  {\n    TimeRangePicker,\n    TimePickerPanel,\n  },\n);\n\nTimePicker.displayName = 'TimePicker';\nTimePicker.defaultProps = timePickerDefaultProps;\n\nexport default TimePicker;\n"],"names":["dayjs","extend","customParseFormat","TimePicker","forwardRefWithStatics","props","ref","TEXT_CONFIG","useTimePickerTextConfig","allowInput","className","clearable","disabled","style","format","DEFAULT_FORMAT","hideDisabledTime","steps","DEFAULT_STEPS","placeholder","disableTime","onBlur","noop","onClose","onFocus","onOpen","useControlled","onChange","_slicedToArray","value","useState","isPanelShowed","setPanelShow","currentValue","setCurrentValue","useConfig","classPrefix","name","inputClasses","classNames","handleShowPopup","visible","context","handleClear","e","stopPropagation","handleInputChange","value2","handleInputBlur","isValidTime","validateInputValue","formatInputValue","handleClickConfirm","useEffect","React","createElement","SelectInput","onClear","suffixIcon","TimeIcon","popupVisible","onInputChange","onPopupVisibleChange","inputValue","inputProps","popupProps","overlayStyle","width","panel","TimePickerPanel","isFooterDisplay","handleConfirmClick","TimeRangePicker","displayName","defaultProps","timePickerDefaultProps"],"mappings":"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"}
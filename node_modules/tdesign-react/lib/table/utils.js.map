{"version":3,"file":"utils.js","sources":["../../src/table/utils.ts"],"sourcesContent":["import isFunction from 'lodash/isFunction';\nimport get from 'lodash/get';\nimport isObject from 'lodash/isObject';\nimport { PrimaryTableCol, RowClassNameParams, TableRowData, TdBaseTableProps } from './type';\nimport { ClassName, HTMLElementAttributes } from '../common';\n\nexport function toString(obj: any): string {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase();\n}\n\nexport function debounce<T = any>(fn: Function, delay = 200): () => void {\n  let timer: ReturnType<typeof setTimeout>;\n  return function newFn(this: T, ...args: Array<any>): void {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const context = this;\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  };\n}\n\nexport interface FormatRowAttributesParams {\n  row: TableRowData;\n  rowIndex: number;\n  type: 'body' | 'foot';\n}\n\n// 行属性\nexport function formatRowAttributes(attributes: TdBaseTableProps['rowAttributes'], params: FormatRowAttributesParams) {\n  if (!attributes) return undefined;\n  const attrList = attributes instanceof Array ? attributes : [attributes];\n  let result: HTMLElementAttributes = {};\n  for (let i = 0; i < attrList.length; i++) {\n    const attrItem = attrList[i];\n    if (!attrItem) continue;\n    const attrProperty = isFunction(attrItem) ? attrItem(params) : attrItem;\n    result =\n      attrProperty instanceof Array ? formatRowAttributes(attrProperty, params) : Object.assign(result, attrProperty);\n  }\n  return result;\n}\n\n// 行类名，['A', 'B']，[() => 'A', () => 'B']\nexport function formatRowClassNames(\n  rowClassNames: TdBaseTableProps['rowClassName'],\n  params: RowClassNameParams<TableRowData>,\n  rowKey: string,\n): ClassName {\n  const rowClassList = rowClassNames instanceof Array ? rowClassNames : [rowClassNames];\n  const { row, rowIndex } = params;\n  // 自定义行类名\n  let customClasses: ClassName = [];\n  for (let i = 0, len = rowClassList.length; i < len; i++) {\n    const rName = rowClassList[i];\n    let tClass = isFunction(rName) ? rName(params) : rName;\n    if (isObject(tClass) && !(tClass instanceof Array)) {\n      // 根据下标设置行类名\n      tClass[rowIndex] && (tClass = tClass[rowIndex]);\n      // 根据行唯一标识设置行类名\n      const rowId = get(row, rowKey || 'id');\n      tClass[rowId] && (tClass = tClass[rowId]);\n    } else if (tClass instanceof Array) {\n      tClass = formatRowClassNames(tClass, params, rowKey);\n    }\n    customClasses = customClasses.concat(tClass);\n  }\n  return customClasses;\n}\n\nexport function filterDataByIds(\n  data: Array<object> = [],\n  ids: Array<string | number> = [],\n  byId = 'id',\n): Array<object> {\n  return data.filter((d: Record<string, any> = {}) => ids.includes(d[byId]));\n}\n\nexport const INNER_PRE_NAME = '@@inner-';\n\nexport enum SCROLL_DIRECTION {\n  X = 'x',\n  Y = 'y',\n  UNKNOWN = 'unknown',\n}\n\nlet preScrollLeft: any;\nlet preScrollTop: any;\n\nexport const getScrollDirection = (scrollLeft: number, scrollTop: number): SCROLL_DIRECTION => {\n  let direction = SCROLL_DIRECTION.UNKNOWN;\n  if (preScrollTop !== scrollTop) {\n    direction = SCROLL_DIRECTION.Y;\n  } else if (preScrollLeft !== scrollLeft) {\n    direction = SCROLL_DIRECTION.X;\n  }\n  preScrollTop = scrollTop;\n  preScrollLeft = scrollLeft;\n  return direction;\n};\n\nexport const getRecord = (record: Record<any, any>) => {\n  if (!record) {\n    return record;\n  }\n  const result = {};\n  Object.keys(record).forEach((key) => {\n    const descriptor = Object.getOwnPropertyDescriptor(record, key);\n    descriptor &&\n      Reflect.defineProperty(result, key, {\n        set(val) {\n          descriptor.set(val);\n        },\n        get() {\n          console.warn('The parameter `record` will be deprecated, please use `row` instead');\n          return descriptor.get();\n        },\n      });\n  });\n  return result;\n};\n\nexport function isRowSelectedDisabled(\n  selectColumn: PrimaryTableCol,\n  row: Record<string, any>,\n  rowIndex: number,\n): boolean {\n  if (!selectColumn) return false;\n  let disabled = isFunction(selectColumn.disabled) ? selectColumn.disabled({ row, rowIndex }) : selectColumn.disabled;\n  if (selectColumn.checkProps) {\n    if (isFunction(selectColumn.checkProps)) {\n      disabled = disabled || selectColumn.checkProps({ row, rowIndex }).disabled;\n    } else if (selectColumn.checkProps === 'object') {\n      disabled = disabled || selectColumn.checkProps.disabled;\n    }\n  }\n  return !!disabled;\n}\n\n// 多级表头，列配置场景，获取 currentRow\nexport function getCurrentRowByKey<T extends { colKey?: string; children?: any[] }>(columns: T[], key: string): T {\n  if (!columns || !key) return;\n  const col = columns?.find((t) => t.colKey === key);\n  if (col) return col;\n  for (let i = 0, len = columns.length; i < len; i++) {\n    if (columns[i]?.children?.length) {\n      return getCurrentRowByKey(columns[i]?.children, key);\n    }\n  }\n}\n"],"names":["toString","obj","Object","prototype","call","slice","toLowerCase","debounce","fn","delay","timer","newFn","args","context","clearTimeout","setTimeout","apply","formatRowAttributes","attributes","params","attrList","Array","result","i","length","attrItem","attrProperty","isFunction","assign","formatRowClassNames","rowClassNames","rowKey","rowClassList","row","rowIndex","customClasses","len","rName","tClass","isObject","rowId","get","concat","filterDataByIds","data","ids","byId","filter","d","includes","INNER_PRE_NAME","SCROLL_DIRECTION","SCROLL_DIRECTION2","preScrollLeft","preScrollTop","getScrollDirection","scrollLeft","scrollTop","direction","getRecord","record","keys","forEach","key","descriptor","getOwnPropertyDescriptor","Reflect","defineProperty","set","val","console","warn","isRowSelectedDisabled","selectColumn","disabled","checkProps","getCurrentRowByKey","columns","col","find","t","colKey","children"],"mappings":"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"}
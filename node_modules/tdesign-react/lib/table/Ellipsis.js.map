{"version":3,"file":"Ellipsis.js","sources":["../../src/table/Ellipsis.tsx"],"sourcesContent":["import React, { useRef, useState, MouseEvent } from 'react';\nimport classNames from 'classnames';\nimport debounce from 'lodash/debounce';\n\nimport { TNode } from '../common';\nimport { isNodeOverflow } from '../_util/dom';\nimport TPopup, { PopupProps } from '../popup';\nimport useConfig from '../_util/useConfig';\n\nexport interface EllipsisProps {\n  content?: string | TNode;\n  children?: string | TNode;\n  popupContent?: string | number | TNode;\n  placement?: PopupProps['placement'];\n  attach?: () => HTMLElement;\n  popupProps?: PopupProps;\n  zIndex?: number;\n}\n\n/** 超出省略显示 */\nexport default function Ellipsis(props: EllipsisProps) {\n  const { classPrefix } = useConfig();\n  const root = useRef<HTMLDivElement>();\n  const [isOverflow, setIsOverflow] = useState(false);\n\n  const ellipsisClasses = classNames([`${classPrefix}-table__ellipsis`, `${classPrefix}-text-ellipsis`]);\n\n  // 当表格数据量大时，不希望默认渲染全量的 Popup，期望在用户 mouseenter 的时候再显示\n  const onTriggerMouseenter = () => {\n    if (!root.current) return;\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  const onTriggerMouseleave = () => {\n    setIsOverflow(isNodeOverflow(root.current));\n  };\n\n  // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n  const onMouseAround = debounce((e: MouseEvent<HTMLDivElement>) => {\n    e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n  }, 80);\n\n  const cellNode = props.children || props.content;\n  const ellipsisContent = (\n    <div ref={root} className={ellipsisClasses} onMouseEnter={onMouseAround} onMouseLeave={onMouseAround}>\n      {cellNode}\n    </div>\n  );\n  let content = null;\n  if (isOverflow) {\n    const rProps = {\n      content: props.popupContent || cellNode,\n      destroyOnClose: true,\n      zIndex: props.zIndex,\n      attach: props.attach,\n      placement: props.placement,\n      ...(props.popupProps || {}),\n    };\n    content = <TPopup {...rProps}>{ellipsisContent}</TPopup>;\n  } else {\n    content = ellipsisContent;\n  }\n  return content;\n}\n\nEllipsis.displayName = 'Ellipsis';\n"],"names":["Ellipsis","props","useConfig","classPrefix","root","useRef","useState","_slicedToArray","isOverflow","setIsOverflow","ellipsisClasses","classNames","onTriggerMouseenter","current","isNodeOverflow","onTriggerMouseleave","onMouseAround","debounce","e","type","cellNode","children","content","ellipsisContent","React","createElement","ref","className","onMouseEnter","onMouseLeave","rProps","popupContent","destroyOnClose","zIndex","attach","placement","popupProps","TPopup","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMe,SAASA,QAAT,CAAkBC,KAAlB,EAAyB;AACtC,EAAA,IAAA,UAAA,GAAwBC,0BAAS,EAAjC;MAAQC,WAAR,cAAQA,WAAR,CAAA;;EACA,IAAMC,IAAI,GAAGC,YAAM,EAAnB,CAAA;;EACA,IAAoCC,SAAAA,GAAAA,cAAQ,CAAC,KAAD,CAA5C;AAAA,MAAA,UAAA,GAAAC,4BAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AAAA,MAAOC,UAAP,GAAA,UAAA,CAAA,CAAA,CAAA;AAAA,MAAmBC,aAAnB,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;EACA,IAAMC,eAAe,GAAGC,8BAAU,CAAC,WAAIR,WAAJ,EAAA,kBAAA,CAAA,EAAA,EAAA,CAAA,MAAA,CAAsCA,WAAtC,EAAA,gBAAA,CAAA,CAAD,CAAlC,CAAA;;AACA,EAAA,IAAMS,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChC,IAAA,IAAI,CAACR,IAAI,CAACS,OAAV,EACE,OAAA;AACFJ,IAAAA,aAAa,CAACK,wBAAc,CAACV,IAAI,CAACS,OAAN,CAAf,CAAb,CAAA;GAHF,CAAA;;AAKA,EAAA,IAAME,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChCN,IAAAA,aAAa,CAACK,wBAAc,CAACV,IAAI,CAACS,OAAN,CAAf,CAAb,CAAA;GADF,CAAA;;AAGA,EAAA,IAAMG,aAAa,GAAGC,mBAAQ,CAAC,UAACC,CAAD,EAAO;IACpCA,CAAC,CAACC,IAAF,KAAW,YAAX,GAA0BJ,mBAAmB,EAA7C,GAAkDH,mBAAmB,EAArE,CAAA;GAD4B,EAE3B,EAF2B,CAA9B,CAAA;EAGA,IAAMQ,QAAQ,GAAGnB,KAAK,CAACoB,QAAN,IAAkBpB,KAAK,CAACqB,OAAzC,CAAA;EACA,IAAMC,eAAe,kBAAmBC,yBAAK,CAACC,aAAN,CAAoB,KAApB,EAA2B;AACjEC,IAAAA,GAAG,EAAEtB,IAD4D;AAEjEuB,IAAAA,SAAS,EAAEjB,eAFsD;AAGjEkB,IAAAA,YAAY,EAAEZ,aAHmD;AAIjEa,IAAAA,YAAY,EAAEb,aAAAA;GAJwB,EAKrCI,QALqC,CAAxC,CAAA;EAMA,IAAIE,OAAO,GAAG,IAAd,CAAA;;AACA,EAAA,IAAId,UAAJ,EAAgB;AACd,IAAA,IAAMsB,MAAM,GAAA,aAAA,CAAA;AACVR,MAAAA,OAAO,EAAErB,KAAK,CAAC8B,YAAN,IAAsBX,QADrB;AAEVY,MAAAA,cAAc,EAAE,IAFN;MAGVC,MAAM,EAAEhC,KAAK,CAACgC,MAHJ;MAIVC,MAAM,EAAEjC,KAAK,CAACiC,MAJJ;MAKVC,SAAS,EAAElC,KAAK,CAACkC,SAAAA;AALP,KAAA,EAMPlC,KAAK,CAACmC,UAAN,IAAoB,EANb,CAAZ,CAAA;;IAQAd,OAAO,kBAAmBE,yBAAK,CAACC,aAAN,CAAoBY,iBAApB,EACrBP,aAAAA,CAAAA,EAAAA,EAAAA,MADqB,CAEvBP,EAAAA,eAFuB,CAA1B,CAAA;AAGD,GAZD,MAYO;AACLD,IAAAA,OAAO,GAAGC,eAAV,CAAA;AACD,GAAA;;AACD,EAAA,OAAOD,OAAP,CAAA;AACD,CAAA;AACDtB,QAAQ,CAACsC,WAAT,GAAuB,UAAvB;;;;"}
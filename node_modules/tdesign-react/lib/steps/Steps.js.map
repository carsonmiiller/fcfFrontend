{"version":3,"file":"Steps.js","sources":["../../src/steps/Steps.tsx"],"sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport classnames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport { TdStepsProps, TdStepItemProps } from './type';\nimport { StyledProps } from '../common';\nimport StepItem from './StepItem';\nimport StepsContext from './StepsContext';\nimport { stepsDefaultProps } from './defaultProps';\n\nexport interface StepsProps extends TdStepsProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Steps = forwardRefWithStatics(\n  (props: StepsProps, ref) => {\n    const { style, readonly, layout, theme, sequence, separator, children, options } = props;\n    const { classPrefix } = useConfig();\n\n    const [current, onChange] = useControlled(props, 'current', props.onChange);\n\n    // 整理 StepItem value 映射\n    const indexMap = useMemo(() => {\n      const map = {};\n\n      if (options) {\n        options.forEach((item, index) => {\n          if (item.value !== undefined) map[item.value] = index;\n        });\n      } else {\n        React.Children.forEach(children, (child, index) => {\n          if (!React.isValidElement(child)) return;\n          if (child.props.value !== undefined) map[child.props.value] = index;\n        });\n      }\n      return map;\n    }, [options, children]);\n\n    const handleStatus = useCallback(\n      (item: TdStepItemProps, index: number) => {\n        if (current === 'FINISH') return 'finish';\n        if (item.status && item.status !== 'default') return item.status;\n\n        // value 不存在时，使用 index 进行区分每一个步骤\n        if (item.value === undefined) {\n          if (sequence === 'positive' && index < current) return 'finish';\n          if (sequence === 'reverse' && index > current) return 'finish';\n        }\n\n        // value 存在，找匹配位置\n        if (item.value !== undefined) {\n          const matchIndex = indexMap[current];\n          if (matchIndex === undefined) {\n            console.warn('TDesign Steps Warn: The current `value` is not exist.');\n            return 'default';\n          }\n          if (sequence === 'positive' && index < matchIndex) return 'finish';\n          if (sequence === 'reverse' && index > matchIndex) return 'finish';\n        }\n        const key = item.value ?? index;\n        if (key === current) return 'process';\n        return 'default';\n      },\n      [current, sequence, indexMap],\n    );\n\n    const stepItemList = useMemo(() => {\n      if (options) {\n        const optionsDisplayList = sequence === 'reverse' ? options.reverse() : options;\n\n        return options.map((item, index: number) => {\n          const stepIndex = sequence === 'reverse' ? optionsDisplayList.length - index - 1 : index;\n          return <StepItem key={index} {...item} index={stepIndex} status={handleStatus(item, index)} />;\n        });\n      }\n\n      const childrenList = React.Children.toArray(children);\n      const childrenDisplayList = sequence === 'reverse' ? childrenList.reverse() : childrenList;\n\n      return childrenList.map((child: JSX.Element, index: number) => {\n        const stepIndex = sequence === 'reverse' ? childrenDisplayList.length - index - 1 : index;\n        return React.cloneElement(child, {\n          ...child.props,\n          index: stepIndex,\n          status: handleStatus(child.props, index),\n        });\n      });\n    }, [options, children, sequence, handleStatus]);\n\n    return (\n      <StepsContext.Provider value={{ current, theme, readonly, onChange }}>\n        <div\n          ref={ref}\n          style={style}\n          className={classnames({\n            [`${classPrefix}-steps`]: true,\n            [`${classPrefix}-steps--${theme}-anchor`]: theme,\n            [`${classPrefix}-steps--${layout}`]: layout,\n            [`${classPrefix}-steps--${sequence}`]: sequence,\n            [`${classPrefix}-steps--${separator}-separator`]: separator,\n            [props.className]: !!props.className,\n          })}\n        >\n          {stepItemList}\n        </div>\n      </StepsContext.Provider>\n    );\n  },\n  { StepItem },\n);\n\nSteps.displayName = 'Steps';\nSteps.defaultProps = stepsDefaultProps;\n\nexport default Steps;\n"],"names":["Steps","forwardRefWithStatics","props","ref","style","readonly","layout","theme","sequence","separator","children","options","useConfig","classPrefix","useControlled","onChange","_slicedToArray","current","indexMap","useMemo","map","forEach","item","index","value","React","Children","child","isValidElement","handleStatus","useCallback","status","matchIndex","console","warn","key","stepItemList","optionsDisplayList","reverse","stepIndex","length","createElement","StepItem","childrenList","toArray","childrenDisplayList","cloneElement","StepsContext","Provider","className","classnames","_defineProperty","displayName","defaultProps","stepsDefaultProps"],"mappings":"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"}
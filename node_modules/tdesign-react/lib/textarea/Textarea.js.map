{"version":3,"file":"Textarea.js","sources":["../../src/textarea/Textarea.tsx"],"sourcesContent":["import React, { forwardRef, useState, useEffect, useMemo, useRef, useCallback, useImperativeHandle } from 'react';\nimport classNames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport { TdTextareaProps } from './type';\nimport { StyledProps } from '../common';\nimport noop from '../_util/noop';\nimport useControlled from '../hooks/useControlled';\nimport { getCharacterLength } from '../_util/helper';\nimport calcTextareaHeight from '../_common/js/utils/calcTextareaHeight';\nimport { textareaDefaultProps } from './defaultProps';\n\nexport interface TextareaProps extends TdTextareaProps, StyledProps {}\nexport interface TextareaRefInterface extends React.RefObject<unknown> {\n  currentElement: HTMLDivElement;\n  textareaElement: HTMLTextAreaElement;\n}\n\nconst Textarea = forwardRef((props: TextareaProps, ref: TextareaRefInterface) => {\n  const {\n    disabled,\n    maxlength,\n    maxcharacter,\n    className,\n    readonly,\n    autofocus,\n    style,\n    onKeydown = noop,\n    onKeypress = noop,\n    onKeyup = noop,\n    autosize,\n    status,\n    tips,\n    ...otherProps\n  } = props;\n\n  const [value = '', setValue] = useControlled(props, 'value', props.onChange);\n  const [isFocused, setIsFocused] = useState(false);\n  const [textareaStyle, setTextareaStyle] = useState({});\n  const hasMaxcharacter = typeof maxcharacter !== 'undefined';\n  const textareaRef: React.RefObject<HTMLTextAreaElement> = useRef();\n  const wrapperRef: React.RefObject<HTMLDivElement> = useRef();\n  const currentLength = useMemo(() => (value ? String(value).length : 0), [value]);\n  const characterLength = useMemo(() => {\n    const characterInfo = getCharacterLength(String(value), maxcharacter);\n    if (typeof characterInfo === 'object') return characterInfo.length;\n    return characterInfo;\n  }, [value, maxcharacter]);\n\n  const { classPrefix } = useConfig();\n\n  const textareaPropsNames = Object.keys(otherProps).filter((key) => !/^on[A-Z]/.test(key));\n  const textareaProps = textareaPropsNames.reduce(\n    (textareaProps, key) => Object.assign(textareaProps, { [key]: props[key] }),\n    {},\n  );\n  const eventPropsNames = Object.keys(otherProps).filter((key) => /^on[A-Z]/.test(key));\n  const eventProps = eventPropsNames.reduce((eventProps, key) => {\n    Object.assign(eventProps, {\n      [key]: (e) => {\n        if (disabled) return;\n        if (key === 'onFocus') setIsFocused(true);\n        if (key === 'onBlur') setIsFocused(false);\n        props[key](e.currentTarget.value, { e });\n      },\n    });\n    return eventProps;\n  }, {});\n\n  const textareaClassNames = classNames(className, `${classPrefix}-textarea__inner`, {\n    [`${classPrefix}-is-${status}`]: status,\n    [`${classPrefix}-is-disabled`]: disabled,\n    [`${classPrefix}-is-focused`]: isFocused,\n    [`${classPrefix}-resize-none`]: typeof autosize === 'object',\n  });\n\n  const adjustTextareaHeight = useCallback(() => {\n    if (autosize === true) {\n      setTextareaStyle(calcTextareaHeight(textareaRef.current));\n    } else if (typeof autosize === 'object') {\n      setTextareaStyle(calcTextareaHeight(textareaRef.current, autosize?.minRows, autosize?.maxRows));\n    }\n  }, [autosize]);\n\n  function inputValueChangeHandle(e: React.FormEvent<HTMLTextAreaElement>) {\n    const { target } = e;\n    let val = (target as HTMLInputElement).value;\n    if (maxcharacter && maxcharacter >= 0) {\n      const stringInfo = getCharacterLength(val, maxcharacter);\n      val = typeof stringInfo === 'object' && stringInfo.characters;\n    }\n    setValue(val, { e });\n  }\n\n  useEffect(() => {\n    // 当未设置 autosize 时，需要将 textarea 的 height 设置为 auto，以支持原生的 textarea rows 属性\n    if (autosize === false) {\n      setTextareaStyle({ height: 'auto', minHeight: 'auto' });\n    }\n  }, [adjustTextareaHeight, autosize]);\n\n  useEffect(() => {\n    adjustTextareaHeight();\n  }, [adjustTextareaHeight, value]);\n\n  useImperativeHandle(ref as TextareaRefInterface, () => ({\n    currentElement: wrapperRef.current,\n    textareaElement: textareaRef.current,\n  }));\n\n  return (\n    <div style={style} ref={wrapperRef} className={classNames(className, `${classPrefix}-textarea`)}>\n      <textarea\n        {...textareaProps}\n        {...eventProps}\n        value={value}\n        style={textareaStyle}\n        className={textareaClassNames}\n        readOnly={readonly}\n        autoFocus={autofocus}\n        disabled={disabled}\n        maxLength={maxlength}\n        onChange={inputValueChangeHandle}\n        onKeyDown={(e) => onKeydown(e.currentTarget.value, { e })}\n        onKeyPress={(e) => onKeypress(e.currentTarget.value, { e })}\n        onKeyUp={(e) => onKeyup(e.currentTarget.value, { e })}\n        ref={textareaRef}\n      />\n      {hasMaxcharacter ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${characterLength}/${maxcharacter}`}</span>\n      ) : null}\n      {!hasMaxcharacter && maxlength ? (\n        <span className={`${classPrefix}-textarea__limit`}>{`${currentLength}/${maxlength}`}</span>\n      ) : null}\n      {tips ? (\n        <div\n          className={classNames(`${classPrefix}-textarea__tips`, {\n            [`${classPrefix}-textarea__tips--normal`]: !status,\n            [`${classPrefix}-textarea__tips--${status}`]: status,\n          })}\n        >\n          {tips}\n        </div>\n      ) : null}\n    </div>\n  );\n});\n\nTextarea.displayName = 'Textarea';\nTextarea.defaultProps = textareaDefaultProps;\n\nexport default Textarea;\n"],"names":["Textarea","forwardRef","props","ref","disabled","maxlength","maxcharacter","className","readonly","autofocus","style","onKeydown","noop","onKeypress","onKeyup","autosize","status","tips","otherProps","useControlled","onChange","_slicedToArray","value","setValue","useState","isFocused","setIsFocused","textareaStyle","setTextareaStyle","hasMaxcharacter","textareaRef","useRef","wrapperRef","currentLength","useMemo","String","length","characterLength","characterInfo","getCharacterLength","_typeof","useConfig","classPrefix","textareaPropsNames","Object","keys","filter","key","test","textareaProps","reduce","textareaProps2","assign","_defineProperty","eventPropsNames","eventProps","eventProps2","e","currentTarget","textareaClassNames","classNames","adjustTextareaHeight","useCallback","calcTextareaHeight","current","minRows","maxRows","inputValueChangeHandle","target","val","stringInfo","characters","useEffect","height","minHeight","useImperativeHandle","currentElement","textareaElement","React","createElement","readOnly","autoFocus","maxLength","onKeyDown","onKeyPress","onKeyUp","displayName","defaultProps","textareaDefaultProps"],"mappings":"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"}
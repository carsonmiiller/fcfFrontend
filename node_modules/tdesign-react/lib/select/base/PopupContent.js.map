{"version":3,"file":"PopupContent.js","sources":["../../../src/select/base/PopupContent.tsx"],"sourcesContent":["import React, { Children, Ref, forwardRef, isValidElement, cloneElement } from 'react';\nimport classNames from 'classnames';\nimport { useLocaleReceiver } from '../../locale/LocalReceiver';\nimport { getSelectValueArr } from '../util/helper';\nimport { TdSelectProps, SelectValue, TdOptionProps } from '../type';\nimport useConfig from '../../_util/useConfig';\nimport Option, { SelectOptionProps } from './Option';\n\ntype OptionsType = TdOptionProps[];\n\ninterface SelectPopupProps\n  extends Pick<\n    TdSelectProps,\n    | 'value'\n    | 'size'\n    | 'multiple'\n    | 'empty'\n    | 'options'\n    | 'max'\n    | 'loadingText'\n    | 'loading'\n    | 'valueType'\n    | 'keys'\n    | 'panelTopContent'\n    | 'panelBottomContent'\n  > {\n  onChange?: (value: SelectValue, context?: { label?: string | number; restData?: Record<string, any> }) => void;\n  /**\n   * 是否展示popup\n   */\n  showPopup: boolean;\n  /**\n   * 控制popup展示的函数\n   */\n  setShowPopup: (show: boolean) => void;\n  children?: React.ReactNode;\n}\n\nconst PopupContent = forwardRef((props: SelectPopupProps, ref: Ref<HTMLDivElement>) => {\n  const {\n    onChange,\n    value,\n    size,\n    max,\n    multiple,\n    showPopup,\n    setShowPopup,\n    options,\n    empty,\n    loadingText,\n    loading,\n    valueType,\n    children,\n    keys,\n    panelTopContent,\n    panelBottomContent,\n  } = props;\n\n  // 国际化文本初始化\n  const [local, t] = useLocaleReceiver('select');\n  const emptyText = t(local.empty);\n\n  const { classPrefix } = useConfig();\n  if (!children && !props.options) return null;\n\n  const onSelect: SelectOptionProps['onSelect'] = (selectedValue, { label, selected, restData }) => {\n    const isValObj = valueType === 'object';\n    let objVal = {};\n    if (isValObj) {\n      objVal = { ...restData };\n      if (!keys?.label) {\n        Object.assign(objVal, { label });\n      }\n      if (!keys?.value) {\n        Object.assign(objVal, { value: selectedValue });\n      }\n    }\n\n    if (!Object.keys(objVal).length) {\n      Object.assign(objVal, { [keys?.label || 'label']: label, [keys?.value || 'value']: selectedValue });\n    }\n    if (multiple) {\n      // calc multiple select values\n      const values = getSelectValueArr(value, selectedValue, selected, valueType, keys, objVal);\n      onChange(values, { label });\n    } else {\n      // calc single select value\n      const selectVal = valueType === 'object' ? objVal : selectedValue;\n\n      onChange(selectVal, { label });\n      setShowPopup(!showPopup);\n    }\n  };\n\n  const childrenWithProps = Children.map(children, (child) => {\n    if (isValidElement(child)) {\n      const addedProps = { size, max, multiple, selectedValue: value, onSelect };\n      return cloneElement(child, { ...addedProps });\n    }\n    return child;\n  });\n\n  // 渲染 options\n  const renderOptions = () => {\n    if (options) {\n      // 通过options API配置的\n      return (\n        <ul className={`${classPrefix}-select__list`}>\n          {(options as OptionsType).map(({ value: optionValue, label, disabled, ...restData }, index) => (\n            <Option\n              key={index}\n              max={max}\n              label={label}\n              value={optionValue}\n              onSelect={onSelect}\n              selectedValue={value}\n              multiple={multiple}\n              size={size}\n              disabled={disabled}\n              restData={restData}\n              keys={keys}\n            />\n          ))}\n        </ul>\n      );\n    }\n    return <ul className={`${classPrefix}-select__list`}>{childrenWithProps}</ul>;\n  };\n\n  const isEmpty = (Array.isArray(childrenWithProps) && !childrenWithProps.length) || (options && options.length === 0);\n\n  return (\n    <div\n      ref={ref}\n      className={classNames(`${classPrefix}-select__dropdown-inner`, {\n        [`${classPrefix}-select__dropdown-inner--size-s`]: size === 'small',\n        [`${classPrefix}-select__dropdown-inner--size-l`]: size === 'large',\n        [`${classPrefix}-select__dropdown-inner--size-m`]: size === 'medium',\n      })}\n    >\n      {panelTopContent}\n      {isEmpty && <div className={`${classPrefix}-select__empty`}>{empty ? empty : <p>{emptyText}</p>}</div>}\n      {!isEmpty && loading && <div className={`${classPrefix}-select__loading-tips`}>{loadingText}</div>}\n      {!isEmpty && !loading && renderOptions()}\n      {panelBottomContent}\n    </div>\n  );\n});\n\nexport default PopupContent;\n"],"names":["PopupContent","forwardRef","props","ref","onChange","value","size","max","multiple","showPopup","setShowPopup","options","empty","loadingText","loading","valueType","children","keys","panelTopContent","panelBottomContent","useLocaleReceiver","_slicedToArray","local","t","emptyText","useConfig","classPrefix","onSelect","selectedValue","label","selected","restData","isValObj","objVal","Object","assign","length","_defineProperty","values","getSelectValueArr","selectVal","childrenWithProps","Children","map","child","isValidElement","addedProps","cloneElement","renderOptions","React","createElement","className","index","optionValue","disabled","_objectWithoutProperties","Option","key","isEmpty","Array","isArray","classNames"],"mappings":"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"}
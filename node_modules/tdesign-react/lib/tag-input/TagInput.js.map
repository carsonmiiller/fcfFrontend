{"version":3,"file":"TagInput.js","sources":["../../src/tag-input/TagInput.tsx"],"sourcesContent":["import React, { CompositionEvent, KeyboardEvent, useRef, useImperativeHandle, forwardRef, MouseEvent } from 'react';\nimport { CloseCircleFilledIcon } from 'tdesign-icons-react';\nimport isFunction from 'lodash/isFunction';\nimport classnames from 'classnames';\nimport useConfig from '../_util/useConfig';\nimport useDragSorter from '../_util/useDragSorter';\nimport TInput, { InputValue } from '../input';\nimport { TdTagInputProps } from './type';\nimport useTagScroll from './useTagScroll';\nimport useTagList from './useTagList';\nimport useHover from './useHover';\nimport useControlled from '../hooks/useControlled';\nimport { StyledProps } from '../common';\nimport { tagInputDefaultProps } from './defaultProps';\n\nexport interface TagInputProps extends TdTagInputProps, StyledProps {}\n\nconst TagInput = forwardRef((props: TagInputProps, ref) => {\n  const { classPrefix: prefix } = useConfig();\n\n  const {\n    excessTagsDisplayType,\n    autoWidth,\n    readonly,\n    disabled,\n    clearable,\n    placeholder,\n    valueDisplay,\n    label,\n    inputProps,\n    size,\n    tips,\n    status,\n    suffixIcon,\n    suffix,\n    onClick,\n    onPaste,\n    onFocus,\n    onBlur,\n  } = props;\n\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n\n  const { isHover, addHover, cancelHover } = useHover(props);\n  const { getDragProps } = useDragSorter({\n    ...props,\n    sortOnDraggable: props.dragSort,\n    onDragOverCheck: {\n      x: true,\n      targetClassNameRegExp: new RegExp(`^${prefix}-tag`),\n    },\n  });\n  const isCompositionRef = useRef(false);\n\n  const { scrollToRight, onWheel, scrollToRightOnEnter, scrollToLeftOnLeave, tagInputRef } = useTagScroll(props);\n\n  // handle tag add and remove\n  const { tagValue, onClose, onInnerEnter, onInputBackspaceKeyUp, clearAll, renderLabel } = useTagList({\n    ...props,\n    getDragProps,\n  });\n\n  const NAME_CLASS = `${prefix}-tag-input`;\n  const WITH_SUFFIX_ICON_CLASS = `${prefix}-tag-input__with-suffix-icon`;\n  const CLEAR_CLASS = `${prefix}-tag-input__suffix-clear`;\n  const BREAK_LINE_CLASS = `${prefix}-tag-input--break-line`;\n\n  const tagInputPlaceholder = !tagValue?.length ? placeholder : '';\n\n  const showClearIcon = Boolean(!readonly && !disabled && clearable && isHover && tagValue?.length);\n\n  useImperativeHandle(ref, () => ({ ...(tagInputRef.current || {}) }));\n\n  const onInputCompositionstart = (value: InputValue, context: { e: CompositionEvent<HTMLInputElement> }) => {\n    isCompositionRef.current = true;\n    inputProps?.onCompositionstart?.(value, context);\n  };\n\n  const onInputCompositionend = (value: InputValue, context: { e: CompositionEvent<HTMLInputElement> }) => {\n    isCompositionRef.current = false;\n    inputProps?.onCompositionend?.(value, context);\n  };\n\n  const onInputEnter = (value: InputValue, context: { e: KeyboardEvent<HTMLDivElement> }) => {\n    setTInputValue('', { e: context.e, trigger: 'enter' });\n    !isCompositionRef.current && onInnerEnter(value, context);\n    scrollToRight();\n  };\n\n  const onInnerClick = (context: { e: MouseEvent<HTMLDivElement> }) => {\n    (tagInputRef.current as any).inputElement.focus();\n    onClick?.(context);\n  };\n\n  const onClearClick = (e: MouseEvent<SVGElement>) => {\n    clearAll({ e });\n    setTInputValue('', { e, trigger: 'clear' });\n  };\n\n  const suffixIconNode = showClearIcon ? (\n    <CloseCircleFilledIcon className={CLEAR_CLASS} onClick={onClearClick} />\n  ) : (\n    suffixIcon\n  );\n  // 自定义 Tag 节点\n  const displayNode = isFunction(valueDisplay)\n    ? valueDisplay({\n        value: tagValue,\n        onClose: (index, item) => onClose({ index, item }),\n      })\n    : valueDisplay;\n\n  const classes = [\n    NAME_CLASS,\n    {\n      [BREAK_LINE_CLASS]: excessTagsDisplayType === 'break-line',\n      [WITH_SUFFIX_ICON_CLASS]: !!suffixIconNode,\n    },\n    props.className,\n  ];\n\n  return (\n    <TInput\n      ref={tagInputRef}\n      {...inputProps}\n      value={tInputValue}\n      onChange={(val, context) => {\n        setTInputValue(val, { ...context, trigger: 'input' });\n      }}\n      autoWidth={autoWidth}\n      onWheel={onWheel}\n      size={size}\n      readonly={readonly}\n      disabled={disabled}\n      label={() => renderLabel({ displayNode, label })}\n      className={classnames(classes)}\n      style={props.style}\n      tips={tips}\n      status={status}\n      placeholder={tagInputPlaceholder}\n      suffix={suffix}\n      suffixIcon={suffixIconNode}\n      onPaste={onPaste}\n      onClick={onInnerClick}\n      onEnter={onInputEnter}\n      onKeyup={onInputBackspaceKeyUp}\n      onMouseenter={(context) => {\n        addHover(context);\n        scrollToRightOnEnter();\n      }}\n      onMouseleave={(context) => {\n        cancelHover(context);\n        scrollToLeftOnLeave();\n      }}\n      onFocus={(inputValue, context) => {\n        onFocus?.(tagValue, { e: context.e, inputValue });\n      }}\n      onBlur={(inputValue, context) => {\n        onBlur?.(tagValue, { e: context.e, inputValue });\n      }}\n      onCompositionstart={onInputCompositionstart}\n      onCompositionend={onInputCompositionend}\n    />\n  );\n});\n\nTagInput.displayName = 'TagInput';\nTagInput.defaultProps = tagInputDefaultProps;\n\nexport default TagInput;\n"],"names":["TagInput","forwardRef","props","ref","useConfig","prefix","classPrefix","excessTagsDisplayType","autoWidth","readonly","disabled","clearable","placeholder","valueDisplay","label","inputProps","size","tips","status","suffixIcon","suffix","onClick","onPaste","onFocus","onBlur","useControlled","onInputChange","_slicedToArray","tInputValue","setTInputValue","useHover","isHover","addHover","cancelHover","useDragSorter","sortOnDraggable","dragSort","onDragOverCheck","x","targetClassNameRegExp","RegExp","getDragProps","isCompositionRef","useRef","useTagScroll","scrollToRight","onWheel","scrollToRightOnEnter","scrollToLeftOnLeave","tagInputRef","useTagList","tagValue","onClose","onInnerEnter","onInputBackspaceKeyUp","clearAll","renderLabel","NAME_CLASS","WITH_SUFFIX_ICON_CLASS","CLEAR_CLASS","BREAK_LINE_CLASS","tagInputPlaceholder","length","showClearIcon","Boolean","useImperativeHandle","current","onInputCompositionstart","value","context","onCompositionstart","onInputCompositionend","onCompositionend","onInputEnter","e","trigger","onInnerClick","inputElement","focus","onClearClick","suffixIconNode","React","createElement","CloseCircleFilledIcon","className","displayNode","isFunction","index","item","classes","TInput","onChange","val","classnames","style","onEnter","onKeyup","onMouseenter","onMouseleave","inputValue","displayName","defaultProps","tagInputDefaultProps"],"mappings":"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"}
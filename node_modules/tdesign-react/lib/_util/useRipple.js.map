{"version":3,"file":"useRipple.js","sources":["../../src/_util/useRipple.ts"],"sourcesContent":["import { useEffect, useCallback, RefObject, useMemo } from 'react';\nimport useConfig from './useConfig';\nimport useAnimation from './useAnimation';\nimport setStyle from './setStyle';\nimport { canUseDocument } from './dom';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应CSS设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(ref: RefObject<HTMLElement>, fixedRippleColor?: string): void {\n  const { classPrefix } = useConfig();\n\n  // 全局配置\n  const { keepRipple } = useAnimation();\n\n  const rippleContainer = useMemo(() => {\n    if (!canUseDocument) return null;\n    const container = document.createElement('div');\n    container.className = `${classPrefix}-ripple`;\n\n    return container;\n  }, [classPrefix]);\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = useCallback(\n    (e) => {\n      const el = ref?.current;\n      const rippleColor = getRippleColor(el, fixedRippleColor);\n\n      if (e.button !== 0 || !el || !keepRipple) return;\n\n      if (\n        el.classList.contains(`${classPrefix}-is-active`) ||\n        el.classList.contains(`${classPrefix}-is-disabled`) ||\n        el.classList.contains(`${classPrefix}-is-checked`)\n      )\n        return;\n\n      const elStyle = getComputedStyle(el);\n\n      const elBorder = parseInt(elStyle.borderWidth, 10);\n      const border = elBorder > 0 ? elBorder : 0;\n      const width = el.offsetWidth;\n      const height = el.offsetHeight;\n\n      if (rippleContainer.parentNode === null) {\n        setStyle(rippleContainer, {\n          position: 'absolute',\n          left: `${0 - border}px`,\n          top: `${0 - border}px`,\n          width: `${width}px`,\n          height: `${height}px`,\n          borderRadius: elStyle.borderRadius,\n          pointerEvents: 'none',\n          overflow: 'hidden',\n        });\n        el.appendChild(rippleContainer);\n      }\n      // 新增一个ripple\n      const ripple = document.createElement('div');\n\n      ripple.className = `${classPrefix}-ripple__inner`;\n\n      setStyle(ripple, {\n        marginTop: '0',\n        marginLeft: '0',\n        right: `${width}px`,\n        width: `${width + 20}px`,\n        height: '100%',\n        transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n        transform: 'skewX(-8deg)',\n        pointerEvents: 'none',\n        position: 'absolute',\n        zIndex: 0,\n        backgroundColor: rippleColor,\n        opacity: '0.9',\n      });\n\n      // fix zIndex：避免遮盖内部元素\n      const elMap = new WeakMap();\n      for (let n = el.children.length, i = 0; i < n; ++i) {\n        const child = el.children[i];\n        if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer) {\n          (child as HTMLElement).style.zIndex = '1';\n          elMap.set(child, true);\n        }\n      }\n\n      // fix position\n      const initPosition = el.style.position ? el.style.position : getComputedStyle(el).position;\n      if (initPosition === '' || initPosition === 'static') {\n        // eslint-disable-next-line no-param-reassign\n        el.style.position = 'relative';\n      }\n      rippleContainer.insertBefore(ripple, rippleContainer.firstChild);\n\n      setTimeout(() => {\n        ripple.style.transform = `translateX(${width}px)`;\n      }, 0);\n      // 清除动画节点 clear ripple container\n      const handleClearRipple = () => {\n        const el = ref?.current;\n        ripple.style.backgroundColor = noneRippleBg;\n\n        if (!el) return;\n\n        el.removeEventListener('pointerup', handleClearRipple, false);\n        el.removeEventListener('pointerleave', handleClearRipple, false);\n\n        setTimeout(() => {\n          ripple.remove();\n          if (rippleContainer.children.length === 0) rippleContainer.remove();\n        }, period * 2 + 100);\n      };\n      el.addEventListener('pointerup', handleClearRipple, false);\n      el.addEventListener('pointerleave', handleClearRipple, false);\n    },\n    [classPrefix, ref, fixedRippleColor, rippleContainer, keepRipple],\n  );\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el) return;\n\n    el.addEventListener('pointerdown', handleAddRipple, false);\n\n    return () => {\n      el.removeEventListener('pointerdown', handleAddRipple, false);\n    };\n  }, [handleAddRipple, fixedRippleColor, ref]);\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","ref","useConfig","classPrefix","useAnimation","keepRipple","rippleContainer","useMemo","canUseDocument","container","document","createElement","className","handleAddRipple","useCallback","e","current","button","classList","contains","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","el2","removeEventListener","remove","addEventListener","useEffect"],"mappings":"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"}
{"version":3,"file":"Portal.js","sources":["../../src/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useEffect, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AttachNode, AttachNodeReturnValue } from '../common';\nimport { canUseDocument } from '../_util/dom';\nimport useConfig from '../_util/useConfig';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  attach?: React.ReactElement | AttachNode | boolean;\n  /**\n   * 触发元素\n   */\n  triggerNode?: HTMLElement;\n  children: React.ReactNode;\n}\n\nexport function getAttach(attach: PortalProps['attach']) {\n  if (!canUseDocument) return null;\n\n  let parent: AttachNodeReturnValue;\n  if (typeof attach === 'string') {\n    parent = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    parent = attach();\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    parent = attach;\n  }\n  return parent || document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { attach, children, triggerNode } = props;\n  const { classPrefix } = useConfig();\n\n  const container = useMemo(() => {\n    if (!canUseDocument) return null;\n    const el = document.createElement('div');\n    el.className = `${classPrefix}-portal-wrapper`;\n    return el;\n  }, [classPrefix]);\n\n  useEffect(() => {\n    let parentElement = document.body;\n    let el = null;\n\n    // 处理 attach\n    if (typeof attach === 'function') {\n      el = attach(triggerNode);\n    } else if (typeof attach === 'string') {\n      el = document.querySelector(attach);\n    }\n\n    // fix el in iframe\n    if (el && el.nodeType === 1) {\n      parentElement = el;\n    }\n\n    parentElement.appendChild(container);\n\n    return () => {\n      parentElement?.removeChild(container);\n    };\n  }, [container, attach, triggerNode]);\n\n  useImperativeHandle(ref, () => container);\n\n  return canUseDocument ? createPortal(children, container) : null;\n});\n\nPortal.displayName = 'Portal';\n\nexport default Portal;\n"],"names":["getAttach","attach","canUseDocument","parent","document","querySelector","_typeof","window","HTMLElement","body","Portal","forwardRef","props","ref","children","triggerNode","useConfig","classPrefix","container","useMemo","el","createElement","className","useEffect","parentElement","nodeType","appendChild","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":"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"}
{"version":3,"file":"_util.js","sources":["../../src/calendar/_util.ts"],"sourcesContent":["import dayjs from 'dayjs';\nimport { CalendarCell } from './type';\n\n// 抽取配置常量\nexport const blockName = 'calendar'; // 类名前缀\nexport const controlSectionSize = 'medium'; // 操作栏控件尺寸\nexport const minYear = 1970; // 最早选择年份\n\n/**\n * 获取一个日期是周几（1~7）\n */\nexport const getDay = (dt: Date): number => {\n  let day = dayjs(dt).day();\n  if (day === 0) {\n    day = 7;\n  }\n  return day;\n};\n\n/**\n * 创建日历单元格数据\n * @param year 日历年份\n * @param month 日历月份\n * @param firstDayOfWeek 周起始日（1~7）\n * @param currentValue 当前日期\n * @param format 日期格式\n */\nexport const createDateList = (\n  year: number,\n  month: number,\n  firstDayOfWeek: number,\n  currentValue: dayjs.Dayjs,\n  format: string,\n): CalendarCell[][] => {\n  const createCellData = (belongTo: number, isCurrent: boolean, date: Date, weekOrder: number): CalendarCell => {\n    const day = getDay(date);\n    return {\n      mode: 'month',\n      belongTo,\n      isCurrent,\n      day,\n      weekOrder,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    };\n  };\n\n  const monthFirstDay = dayjs(`${year}-${month}`);\n  const rowList = [] as CalendarCell[][];\n  let list = [] as CalendarCell[];\n  let weekCount = 1;\n\n  // 添加上个月中会在本月显示的最后几天日期\n  const lastMonthDaysCount = (getDay(monthFirstDay.toDate()) - firstDayOfWeek + 7) % 7;\n  for (let i = 0; i < lastMonthDaysCount; i++) {\n    const dayObj = monthFirstDay.subtract(i + 1, 'day');\n    list.unshift(createCellData(-1, false, dayObj.toDate(), weekCount));\n  }\n\n  // 添加本月日期\n  const monthDaysCount = monthFirstDay.endOf('month').daysInMonth();\n  for (let i = 0; i < monthDaysCount; i++) {\n    const dayObj = monthFirstDay.add(i, 'day');\n    list.push(createCellData(0, currentValue.isSame(dayObj), dayObj.toDate(), weekCount));\n    if (list.length === 7) {\n      rowList.push(list);\n      list = [];\n      weekCount += 1;\n    }\n  }\n\n  // 添加下月日期\n  if (list.length) {\n    const monthLastDay = dayjs(`${year}-${month}`).endOf('month');\n    const nextMonthDaysCount = 7 - list.length;\n    for (let i = 0; i < nextMonthDaysCount; i++) {\n      const dayObj = monthLastDay.add(i + 1, 'day');\n      list.push(createCellData(1, false, dayObj.toDate(), weekCount));\n    }\n    rowList.push(list);\n  }\n\n  return rowList;\n};\n\n/**\n * 创建月历单元格数据\n * @param year 月历年份\n * @param currentValue 当前日期\n * @param format 输出格式\n * @param rowNum 一行日历的个数\n */\nexport const createMonthList = (\n  year: number,\n  currentValue: dayjs.Dayjs,\n  format: string,\n  rowNum = 4,\n): CalendarCell[][] => {\n  const monthsArr: CalendarCell[][] = [];\n  const isCurYear = currentValue.year() === year;\n  let tmpArr: CalendarCell[] = [];\n  for (let i = 1; i <= 12; i++) {\n    const date = new Date(year, i - 1);\n    const curDateMon = parseInt(currentValue.format('M'), 10);\n    const isCurrent = isCurYear && curDateMon === i;\n\n    tmpArr.push({\n      mode: 'year',\n      isCurrent,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    });\n    if (tmpArr.length === rowNum) {\n      monthsArr.push(tmpArr);\n      tmpArr = [];\n    }\n  }\n\n  return monthsArr;\n};\n"],"names":["blockName","controlSectionSize","minYear","getDay","dt","day","dayjs","createDateList","year","month","firstDayOfWeek","currentValue","format","createCellData","belongTo","isCurrent","date","weekOrder","mode","formattedDate","filterDate","formattedFilterDate","isShowWeekend","monthFirstDay","rowList","list","weekCount","lastMonthDaysCount","toDate","i","dayObj","subtract","unshift","monthDaysCount","endOf","daysInMonth","add","push","isSame","length","monthLastDay","nextMonthDaysCount","createMonthList","rowNum","monthsArr","isCurYear","tmpArr","Date","curDateMon","parseInt"],"mappings":"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"}
{"version":3,"file":"Skeleton.js","sources":["../../src/skeleton/Skeleton.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport isNumber from 'lodash/isNumber';\nimport classNames from 'classnames';\nimport { SkeletonRowCol, SkeletonRowColObj, TdSkeletonProps } from './type';\n\nimport { StyledProps, Styles, TNode } from '../common';\nimport useConfig from '../_util/useConfig';\nimport { pxCompat } from '../_util/helper';\nimport { skeletonDefaultProps } from './defaultProps';\n\nexport type SkeletonProps = TdSkeletonProps & StyledProps & { children: TNode };\n\nconst ThemeMap: Record<TdSkeletonProps['theme'], SkeletonRowCol> = {\n  text: [1],\n  avatar: [{ type: 'circle', size: '56px' }],\n  paragraph: [1, 1, { width: '70%' }],\n  'avatar-text': [[{ type: 'circle' }, { type: 'text', height: '32px' }]],\n  tab: [{ height: '30px' }, { height: '200px' }],\n  article: [\n    { type: 'rect', height: '30px', width: '100%' },\n    { type: 'rect', height: '200px', width: '100%' },\n    ...[3, 2, 2, 2].map((value) => Array(value).fill({ type: 'text', height: '30px' })),\n  ],\n};\n\nconst Skeleton = (props: SkeletonProps) => {\n  const { animation, loading, rowCol, theme, className, style, delay = 0, children } = props;\n\n  const { classPrefix } = useConfig();\n  const name = `${classPrefix}-skeleton`; // t-skeleton\n\n  const renderCols = (_cols: Number | SkeletonRowColObj | Array<SkeletonRowColObj>) => {\n    const getColItemClass = (obj: SkeletonRowColObj) =>\n      classNames(`${name}__col`, `${name}--type-${obj.type || 'text'}`, {\n        [`${name}--animation-${animation}`]: animation,\n      });\n\n    const getColItemStyle = (obj: SkeletonRowColObj): Styles => {\n      const styleName = [\n        'width',\n        'height',\n        'marginRight',\n        'marginLeft',\n        'margin',\n        'size',\n        'background',\n        'backgroundColor',\n      ];\n      const style: Styles = {};\n      styleName.forEach((name) => {\n        if (name in obj) {\n          const px = pxCompat(obj[name]);\n          if (name === 'size') {\n            [style.width, style.height] = [px, px];\n          } else {\n            style[name] = px;\n          }\n        }\n      });\n      return style;\n    };\n\n    let cols: Array<SkeletonRowColObj> = [];\n    if (Array.isArray(_cols)) {\n      cols = _cols;\n    } else if (isNumber(_cols)) {\n      cols = new Array(_cols).fill({ type: 'text' });\n    } else {\n      cols = [_cols as SkeletonRowColObj];\n    }\n\n    return cols.map((item, index) => (\n      <div key={index} className={getColItemClass(item)} style={getColItemStyle(item)}>\n        {typeof item.content === 'function' ? item.content(React.createElement) : item.content}\n      </div>\n    ));\n  };\n\n  const renderRowCol = (_rowCol?: SkeletonRowCol) => {\n    const renderedRowCol: SkeletonRowCol = _rowCol || rowCol;\n\n    return renderedRowCol.map((item, index) => (\n      <div key={index} className={`${name}__row`}>\n        {renderCols(item)}\n      </div>\n    ));\n  };\n\n  const [ctrlLoading, setCtrlLoading] = useState(loading);\n\n  useEffect(() => {\n    if (delay > 0 && !loading) {\n      const timeout = setTimeout(() => {\n        setCtrlLoading(loading);\n      }, delay);\n      return () => clearTimeout(timeout);\n    }\n\n    setCtrlLoading(loading);\n  }, [delay, loading]);\n\n  if (!ctrlLoading) {\n    return children;\n  }\n\n  const childrenContent = [];\n  if (theme) {\n    childrenContent.push(renderRowCol(ThemeMap[theme]));\n  }\n  if (rowCol) {\n    childrenContent.push(renderRowCol(rowCol));\n  }\n  if (!theme && !rowCol) {\n    // 什么都不传时，传入默认 rowCol\n    childrenContent.push(renderRowCol([1, 1, 1, { width: '70%' }]));\n  }\n\n  return (\n    <div className={className} style={style}>\n      {childrenContent}\n    </div>\n  );\n};\n\nSkeleton.displayName = 'Skeleton';\nSkeleton.defaultProps = skeletonDefaultProps;\n\nexport default Skeleton;\n"],"names":["ThemeMap","text","avatar","type","size","paragraph","width","height","tab","article","_toConsumableArray","map","value","Array","fill","Skeleton","props","animation","loading","rowCol","theme","className","style","delay","children","useConfig","classPrefix","name","renderCols","_cols","getColItemClass","obj","classNames","getColItemStyle","styleName","style2","forEach","name2","px","pxCompat","cols","isArray","isNumber","item","index","React","createElement","key","content","renderRowCol","_rowCol","renderedRowCol","useState","_slicedToArray","ctrlLoading","setCtrlLoading","useEffect","timeout","setTimeout","clearTimeout","childrenContent","push","displayName","defaultProps","skeletonDefaultProps"],"mappings":"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"}
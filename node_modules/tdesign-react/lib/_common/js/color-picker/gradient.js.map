{"version":3,"file":"gradient.js","sources":["../../../../src/_common/js/color-picker/gradient.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\n/**\n * 用于反解析渐变字符串为对象\n * https://stackoverflow.com/questions/20215440/parse-css-gradient-rule-with-javascript-regex\n */\nimport tinyColor from 'tinycolor2';\n\n/**\n * Utility combine multiple regular expressions.\n *\n * @param {RegExp[]|string[]} regexpList List of regular expressions or strings.\n * @param {string} flags Normal RegExp flags.\n */\nconst combineRegExp = (regexpList: (string | RegExp)[], flags: string): RegExp => {\n  let source = '';\n  for (let i = 0; i < regexpList.length; i++) {\n    if (typeof regexpList[i] === 'string') {\n      source += regexpList[i];\n    } else {\n      source += (regexpList[i] as RegExp).source;\n    }\n  }\n  return new RegExp(source, flags);\n};\n\ninterface RegExpLib {\n  gradientSearch: RegExp;\n  colorStopSearch: RegExp;\n}\n\ninterface ColorStop {\n  color: string;\n  position?: string;\n}\n\ninterface ParseGradientResult {\n  original: string;\n  colorStopList?: ColorStop[];\n  line?: string;\n  angle?: string;\n  sideCorner?: string;\n}\n\n/**\n * Generate the required regular expressions once.\n *\n * Regular Expressions are easier to manage this way and can be well described.\n *\n * @result {object} Object containing regular expressions.\n */\nconst generateRegExp = (): RegExpLib => {\n  // Note any variables with \"Capture\" in name include capturing bracket set(s).\n  const searchFlags = 'gi'; // ignore case for angles, \"rgb\" etc\n  const rAngle = /(?:[+-]?\\d*\\.?\\d+)(?:deg|grad|rad|turn)/; // Angle +ive, -ive and angle types\n  const rSideCornerCapture = /to\\s+((?:(?:left|right|top|bottom)(?:\\s+(?:top|bottom|left|right))?))/; // optional 2nd part\n  const rComma = /\\s*,\\s*/; // Allow space around comma.\n  const rColorHex = /#(?:[a-f0-9]{6}|[a-f0-9]{3})/; // 3 or 6 character form\n  const rDigits3 = /\\(\\s*(?:\\d{1,3}\\s*,\\s*){2}\\d{1,3}\\s*\\)/;\n  const // \"(1, 2, 3)\"\n    rDigits4 = /\\(\\s*(?:\\d{1,3}\\s*,\\s*){2}\\d{1,3}\\s*,\\s*\\d*\\.?\\d+\\)/;\n  const // \"(1, 2, 3, 4)\"\n    rValue = /(?:[+-]?\\d*\\.?\\d+)(?:%|[a-z]+)?/;\n  const // \".9\", \"-5px\", \"100%\".\n    rKeyword = /[_a-z-][_a-z0-9-]*/;\n  const // \"red\", \"transparent\".\n    rColor = combineRegExp(\n      ['(?:', rColorHex, '|', '(?:rgb|hsl)', rDigits3, '|', '(?:rgba|hsla)', rDigits4, '|', rKeyword, ')'],\n      '',\n    );\n  const rColorStop = combineRegExp([rColor, '(?:\\\\s+', rValue, '(?:\\\\s+', rValue, ')?)?'], '');\n  const // Single Color Stop, optional %, optional length.\n    rColorStopList = combineRegExp(['(?:', rColorStop, rComma, ')*', rColorStop], '');\n  const // List of color stops min 1.\n    rLineCapture = combineRegExp(['(?:(', rAngle, ')|', rSideCornerCapture, ')'], '');\n  const // Angle or SideCorner\n    rGradientSearch = combineRegExp(['(?:(', rLineCapture, ')', rComma, ')?(', rColorStopList, ')'], searchFlags);\n  const // Capture 1:\"line\", 2:\"angle\" (optional), 3:\"side corner\" (optional) and 4:\"stop list\".\n    rColorStopSearch = combineRegExp(\n      ['\\\\s*(', rColor, ')', '(?:\\\\s+', '(', rValue, '))?', '(?:', rComma, '\\\\s*)?'],\n      searchFlags,\n    ); // Capture 1:\"color\" and 2:\"position\" (optional).\n\n  return {\n    gradientSearch: rGradientSearch,\n    colorStopSearch: rColorStopSearch,\n  };\n};\n\n/**\n * Actually parse the input gradient parameters string into an object for reusability.\n *\n *\n * @note Really this only supports the standard syntax not historical versions, see MDN for details\n *       https://developer.mozilla.org/en-US/docs/Web/CSS/linear-gradient\n *\n * @param regExpLib\n * @param {string} input\n * @returns {object|undefined}\n */\nconst parseGradient = (regExpLib: RegExpLib, input: string) => {\n  let result: ParseGradientResult;\n  let matchColorStop: any;\n  let stopResult: ColorStop;\n\n  // reset search position, because we reuse regex.\n  regExpLib.gradientSearch.lastIndex = 0;\n\n  const matchGradient = regExpLib.gradientSearch.exec(input);\n  if (matchGradient !== null) {\n    result = {\n      original: matchGradient[0],\n      colorStopList: [],\n    };\n\n    // Line (Angle or Side-Corner).\n    if (matchGradient[1]) {\n      // eslint-disable-next-line prefer-destructuring\n      result.line = matchGradient[1];\n    }\n    // Angle or undefined if side-corner.\n    if (matchGradient[2]) {\n      // eslint-disable-next-line prefer-destructuring\n      result.angle = matchGradient[2];\n    }\n    // Side-corner or undefined if angle.\n    if (matchGradient[3]) {\n      // eslint-disable-next-line prefer-destructuring\n      result.sideCorner = matchGradient[3];\n    }\n\n    // reset search position, because we reuse regex.\n    regExpLib.colorStopSearch.lastIndex = 0;\n\n    // Loop though all the color-stops.\n    matchColorStop = regExpLib.colorStopSearch.exec(matchGradient[4]);\n    while (matchColorStop !== null) {\n      stopResult = {\n        color: matchColorStop[1],\n      };\n\n      // Position (optional).\n      if (matchColorStop[2]) {\n        // eslint-disable-next-line prefer-destructuring\n        stopResult.position = matchColorStop[2];\n      }\n      result.colorStopList.push(stopResult);\n\n      // Continue searching from previous position.\n      matchColorStop = regExpLib.colorStopSearch.exec(matchGradient[4]);\n    }\n  }\n\n  // Can be undefined if match not found.\n  return result;\n};\n\nexport interface GradientColorPoint {\n  id?: string;\n  color?: string;\n  left?: number;\n}\n\nexport interface GradientColors {\n  points: GradientColorPoint[];\n  degree: number;\n}\n\nconst REGEXP_LIB = generateRegExp();\nconst REG_GRADIENT = /.*gradient\\s*\\(((?:\\([^)]*\\)|[^)(]*)*)\\)/gim;\n\n/**\n * 验证是否是渐变字符串\n * @param input\n * @returns\n */\nexport const isGradientColor = (input: string): null | RegExpExecArray => {\n  REG_GRADIENT.lastIndex = 0;\n  return REG_GRADIENT.exec(input);\n};\n\n// 边界字符串和角度关系\nconst sideCornerDegreeMap = {\n  top: 0,\n  right: 90,\n  bottom: 180,\n  left: 270,\n  'top left': 225,\n  'left top': 225,\n  'top right': 135,\n  'right top': 135,\n  'bottom left': 315,\n  'left bottom': 315,\n  'bottom right': 45,\n  'right bottom': 45,\n};\n\n/**\n * 解析渐变字符串为 GradientColors 对象\n * @param input\n * @returns\n */\nexport const parseGradientString = (input: string): GradientColors | boolean => {\n  const match = isGradientColor(input);\n  if (!match) {\n    return false;\n  }\n  const gradientColors: GradientColors = {\n    points: [],\n    degree: 0,\n  };\n\n  const result: ParseGradientResult = parseGradient(REGEXP_LIB, match[1]);\n  if (result.original.trim() !== match[1].trim()) {\n    return false;\n  }\n  const points: GradientColorPoint[] = result.colorStopList.map(({ color, position }) => {\n    const point = Object.create(null);\n    point.color = tinyColor(color).toRgbString();\n    point.left = parseFloat(position);\n    return point;\n  });\n  gradientColors.points = points;\n  let degree = parseInt(result.angle, 10);\n  if (Number.isNaN(degree)) {\n    degree = sideCornerDegreeMap[result.sideCorner] || 90;\n  }\n  gradientColors.degree = degree;\n\n  return gradientColors;\n};\n\nexport default parseGradientString;\n"],"names":["combineRegExp","regexpList","flags","source","i","length","RegExp","generateRegExp","searchFlags","rAngle","rSideCornerCapture","rComma","rColorHex","rDigits3","rDigits4","rValue","rKeyword","rColor","rColorStop","rColorStopList","rLineCapture","rGradientSearch","rColorStopSearch","gradientSearch","colorStopSearch","parseGradient","regExpLib","input","result","matchColorStop","stopResult","lastIndex","matchGradient","exec","original","colorStopList","line","angle","sideCorner","color","position","push","REGEXP_LIB","REG_GRADIENT","isGradientColor","sideCornerDegreeMap","top","right","bottom","left","parseGradientString","match","gradientColors","points","degree","trim","map","point","Object","create","tinyColor","toRgbString","parseFloat","parseInt","Number","isNaN"],"mappings":"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"}
{"version":3,"file":"DropdownMenu.js","sources":["../../src/dropdown/DropdownMenu.tsx"],"sourcesContent":["import React, { useState, isValidElement } from 'react';\nimport classNames from 'classnames';\nimport { DropdownOption } from './type';\nimport useConfig from '../_util/useConfig';\nimport { DropdownProps } from './Dropdown';\nimport DropdownItem from './DropdownItem';\n\ntype RenderType = 'Normal' | 'DropdownItem';\n\nconst DropdownMenu = (props: DropdownProps) => {\n  const { options = [], maxHeight = 300, maxColumnWidth = 100, minColumnWidth = 10 } = props;\n  const [path, setPath] = useState<string>('');\n  const { classPrefix } = useConfig();\n  const dropdownMenuClass = `${classPrefix}-dropdown__menu`;\n\n  const isActive = (item: DropdownOption | React.ReactChild, pathPrefix: string, excludeSelf = true): boolean => {\n    const itemPath = isValidElement(item)\n      ? `${pathPrefix}/${item.props.value}`\n      : `${pathPrefix}/${(item as DropdownOption).value}`;\n    if (excludeSelf && path === itemPath) {\n      return false;\n    }\n    return path.indexOf(itemPath) === 0;\n  };\n\n  const isDropdownItem = (child) => {\n    if (isValidElement(child) && child.type === DropdownItem) {\n      return true;\n    }\n    return false;\n  };\n\n  const getActiveItemChild = (children, type: RenderType = 'DropdownItem') => {\n    if (!children) {\n      return [];\n    }\n    const activeItemChildren = React.Children.toArray(children);\n    return type === 'DropdownItem'\n      ? activeItemChildren.filter((e) => isDropdownItem(e))\n      : activeItemChildren.filter((e) => !isDropdownItem(e));\n  };\n\n  const handleHoverItem = (path: string) => {\n    setPath(path);\n  };\n\n  const handleItemClick = (\n    options: {\n      data: DropdownOption;\n      context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> };\n      idx: number;\n    },\n    type: RenderType = 'Normal',\n    child?: React.ReactElement,\n  ) => {\n    const { data, context, idx } = options;\n    if (type === 'Normal') {\n      options[idx]?.onClick?.(data, context);\n    } else {\n      child?.props?.onClick?.(data, context);\n    }\n    props.onClick(data, context);\n  };\n  const renderDropdownColumn = (\n    children: Array<DropdownOption | React.ReactChild>,\n    showSubmenu: boolean,\n    pathPrefix: string,\n  ) => {\n    // eslint-disable-next-line\n    const menuClass = [`${dropdownMenuClass}-column`, 'narrow-scrollbar', { submenu__visible: showSubmenu }];\n    return (\n      <div\n        key={`/${pathPrefix}`}\n        className={classNames(menuClass)}\n        style={{\n          maxHeight: `${maxHeight}px`,\n        }}\n      >\n        {children.map((item, idx) => {\n          if (!isDropdownItem(item)) {\n            const optionItem = item as DropdownOption;\n            return (\n              <DropdownItem\n                key={idx}\n                disabled={optionItem.disabled}\n                active={isActive(optionItem, pathPrefix) || optionItem.active}\n                value={optionItem.value}\n                content={optionItem.content}\n                divider={optionItem.divider}\n                hasChildren={optionItem.children && optionItem.children.length > 0}\n                path={`${pathPrefix}/${optionItem.value}`}\n                maxColumnWidth={maxColumnWidth}\n                minColumnWidth={minColumnWidth}\n                onClick={(data: DropdownOption, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) =>\n                  handleItemClick({ data, context, idx })\n                }\n                onHover={handleHoverItem}\n              />\n            );\n          }\n          const childItem = item as React.ReactElement;\n          return React.cloneElement(childItem, {\n            key: idx,\n            hasChildren: getActiveItemChild(childItem.props.children).length > 0,\n            path: `${pathPrefix}/${childItem.props.value}`,\n            maxColumnWidth,\n            minColumnWidth,\n            onHover: handleHoverItem,\n            active: isActive(item, pathPrefix) || childItem.props.active,\n            children: getActiveItemChild(childItem.props.children, 'Normal'),\n            onClick: (data: DropdownOption, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) =>\n              handleItemClick({ data, context, idx }, 'DropdownItem', childItem),\n          });\n        })}\n      </div>\n    );\n  };\n\n  const dropdownItems = (options: Array<DropdownOption | React.ReactChild>, pathPrefix = '') => {\n    const columns = [];\n    // 获取当前活跃状态item\n    const activeItem = options.find((item) => isActive(item, pathPrefix, false));\n    columns.push(renderDropdownColumn(options, !!activeItem, pathPrefix));\n\n    if (isValidElement(activeItem)) {\n      const activeItemChildren = getActiveItemChild(activeItem.props.children);\n      if (activeItemChildren.length > 0) {\n        columns.push(...dropdownItems(activeItemChildren, `${pathPrefix}/${activeItem.props.value}`));\n      }\n    } else if ((activeItem as DropdownOption)?.children?.length) {\n      columns.push(\n        ...dropdownItems(\n          (activeItem as DropdownOption).children,\n          `${pathPrefix}/${(activeItem as DropdownOption).value}`,\n        ),\n      );\n    }\n    return columns;\n  };\n\n  const itemContent = getActiveItemChild(props?.children);\n\n  const renderDropdownItems = dropdownItems(itemContent.length > 0 ? itemContent : options);\n  return <div className={dropdownMenuClass}>{renderDropdownItems}</div>;\n};\n\nDropdownMenu.displayName = 'DropdownMenu';\n\nexport default DropdownMenu;\n"],"names":["DropdownMenu","props","options","maxHeight","maxColumnWidth","minColumnWidth","useState","_slicedToArray","path","setPath","useConfig","classPrefix","dropdownMenuClass","isActive","item","pathPrefix","excludeSelf","itemPath","isValidElement","value","indexOf","isDropdownItem","child","type","DropdownItem","getActiveItemChild","children","activeItemChildren","React","Children","toArray","filter","e","handleHoverItem","path2","handleItemClick","options2","data","context","idx","onClick","renderDropdownColumn","showSubmenu","menuClass","submenu__visible","createElement","key","className","classNames","style","map","optionItem","disabled","active","content","divider","hasChildren","length","onHover","childItem","cloneElement","dropdownItems","columns","activeItem","find","push","_toConsumableArray","itemContent","renderDropdownItems","displayName"],"mappings":"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"}